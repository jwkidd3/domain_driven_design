<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Domain Driven Design</title><meta name="author" content="John Kidd"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/css/reset.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/css/reveal.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/css/theme/white.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* listing block */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}
</style><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/v4-shims.min.css"><!--Printing and PDF exports--><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/css/print/pdf.css" : "https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script><link rel="stylesheet" href="custom.css"></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Domain Driven Design</h1><p class="author"><small>John Kidd</small></p></section><section><section id="_domain_driven_design"><h2>Domain Driven Design</h2></section><section id="_what_is_it"><h2>What is it?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Domain Driven Design (DDD) is a set of tools that assist you in designing and implementing software that delivers high value, both <em>strategically</em> and <em>tactically</em></p></li><li><p>DDD focus your attention on what your company or your team should be focused on</p></li><li><p>DDD has a strategic value in about mapping business domain concepts into software artifacts.</p></li><li><p>DDD is about organizing code artifacts in alignment with business problems, using the same common, ubiquitous language</p></li><li><p>DDD is about taking this business language, the ubiquitous language and creating models that represent the language and used to solve problems</p></li></ul></div></div></section><section id="_what_is_it_not"><h2>What is it not?</h2><div class="slide-content"><div class="ulist"><ul><li><p>DDD isn’t a methodology, it’s more about the software’s architectural design, providing a structure of practices to take design decisions that help in software projects that have complicated domains.</p></li></ul></div></div></section><section id="_wait_isnt_this_waterfall"><h2>Wait, isn&#8217;t this Waterfall?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Domain-Driven Design encourages incremental development, not waterfall one.</p></li><li><p>DDD is about the understanding of the complex domain, and it simply cannot be fully discovered at one go.</p></li><li><p>DDD is incremental, learned, and adjusted over time</p></li></ul></div></div></section><section id="_advantages_disadvantages"><h2>Advantages, Disadvantages</h2><div class="slide-content"><div class="ulist"><ul><li><p>Advantages</p><div class="ulist"><ul><li><p>Incremental &amp; Flexibile</p></li><li><p>Organized: In code and teams</p></li><li><p>Focuses on the Domain</p></li></ul></div></li><li><p>Disadvantages</p><div class="ulist"><ul><li><p>Learning Curve</p></li><li><p>Time and Effort</p></li></ul></div></li></ul></div></div></section><section id="_two_parts_of_ddd"><h2>Two Parts of DDD</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Strategic design</dt><dd><p>Answering the questions of “what?” and “why?”—what software we are building and why we are building it.</p></dd><dt class="hdlist1">Tactical design</dt><dd><p>About the “how”—how each component is implemented.</p></dd></dl></div></div></section><section id="_are_there_times_when_i_cannot_use_ddd"><h2>Are there times when I cannot use DDD?</h2><div class="slide-content"><div class="ulist"><ul><li><p>This is a difficult question, and in the end it will be up to you and your team</p></li><li><p>Some things to consider:</p><div class="ulist"><ul><li><p>Very simple projects where the domain is one to maybe ten different models.
It might be overkill to use DDD (Opinion)</p></li><li><p>Regardless, thinking about domains and models is essential even if you and your team are not going through the entire DDD process</p></li><li><p>If you are in a large company, with many business roles, then DDD will give benefit and clarity</p></li><li><p>In the end, it depends, but you will find many aspects of DDD helpful in the large</p></li></ul></div></li></ul></div></div></section><section id="_free_reference"><h2>Free Reference</h2><div class="slide-content"><div class="paragraph"><p>Download a free DDD Reference from the <a href="https://www.domainlanguage.com/wp-content/uploads/2016/05/DDD_Reference_2015-03.pdf" target="_blank">DomainLanguage.com website</a></p></div></div></section><section id="_domain_driven_design_crew"><h2>Domain Driven Design Crew</h2><div class="slide-content"><div class="paragraph"><p>Visit the <a href="https://github.com/ddd-crew" target="_blank">Domain Driven Design Crew&#8217;s</a> website for starter kits and templates</p></div></div></section></section>
<section id="_strategic"><h2>Strategic</h2></section>
<section><section id="_analyzing_business_domains_strategic"><h2>Analyzing Business Domains [Strategic]</h2></section><section id="_understanding_the_problem"><h2>Understanding the Problem</h2><div class="slide-content"><div class="ulist"><ul><li><p>"Do we need to know this material? We are writing software, not running businesses.”</p></li><li><p>The answer to their question is a resounding “yes.”</p></li><li><p>To design and build an effective solution, you have to understand the problem.</p></li><li><p>The problem, in our context, is the software system we have to build.</p></li><li><p>To understand the problem, you have to understand the context within which it exists:</p><div class="ulist"><ul><li><p>The organization’s business strategy</p></li><li><p>What value it seeks to gain by building the software.</p></li></ul></div></li></ul></div></div></section><section id="_business_domain"><h2>Business Domain</h2><div class="slide-content"><div class="ulist"><ul><li><p>Defines a company’s main area of activity, it&#8217;s <em>primary business</em>.</p></li><li><p>Generally speaking, it’s the service the company provides to its clients.</p></li><li><p>Examples include:</p><div class="ulist"><ul><li><p>FedEx provides courier delivery.</p></li><li><p>Starbucks is best known for its coffee.</p></li><li><p>Walmart is one of the most widely recognized retail establishments</p></li></ul></div></li></ul></div></div></section><section id="_ancillary_domains"><h2>Ancillary Domains</h2><div class="slide-content"><div class="ulist"><ul><li><p>A company can operate in multiple business domains.</p></li><li><p>For example:</p><div class="ulist"><ul><li><p>Amazon provides both retail and cloud computing services.</p></li><li><p>Uber is a rideshare company that also provides food delivery and bicycle-sharing services.</p></li></ul></div></li><li><p><strong>It’s important to note that companies may change their business domains often!</strong></p></li><li><p>Some examples:</p><div class="ulist"><ul><li><p>Nokia - started off as a paper mill</p></li><li><p>Nintendo - stared off as a playing card service</p></li><li><p>Sony - Radio repair shop</p></li><li><p>McDonalds - Sold hot dogs</p></li></ul></div></li></ul></div></div></section><section id="_subdomains"><h2>Subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>For a business domain’s goals and targets, a company has to operate in <em>multiple subdomains</em></p></li><li><p>A <em>subdomain</em> is a fine-grained area of business activity</p></li><li><p>All of a company’s subdomains form its business domain: the service it provides to its customers</p></li><li><p>The subdomains have to interact with each other to achieve the company’s goals in its business domain</p></li></ul></div></div></section><section id="_real_world_subdomains"><h2>Real World Subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>Starbucks may be most recognized for its coffee</p></li><li><p>The successful coffeehouse chain requires more than just knowing how to make great coffee.</p></li><li><p>It also includes:</p><div class="ulist"><ul><li><p>How to buy or rent real estate at effective locations</p></li><li><p>Hire personnel</p></li><li><p>Manage finances</p></li><li><p>Other activities</p></li></ul></div></li><li><p>All subdomains are necessary for the complete business</p></li></ul></div></div></section><section id="_types_of_subdomains"><h2>Types of subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>Core</p></li><li><p>Generic</p></li><li><p>Supporting</p></li></ul></div></div></section><section id="_core_subdomain"><h2>Core Subdomain</h2><div class="slide-content"><div class="ulist"><ul><li><p>A core subdomain is what a company does differently from its competitors</p><div class="ulist"><ul><li><p>"Inventing new products or services"</p></li><li><p>"Reducing costs by optimizing existing processes"</p></li><li><p>"Ship products to hard-to-reach locations"</p></li></ul></div></li></ul></div></div></section><section id="_core_subdomain_complexity"><h2>Core Subdomain Complexity</h2><div class="slide-content"><div class="ulist"><ul><li><p>"A simple core subdomain is short-lived competitive advantage"</p></li><li><p>Core subdomains are:</p><div class="ulist"><ul><li><p>Naturally complex</p></li><li><p>Hard for competitors to copy or imitate</p></li></ul></div></li><li><p>Although core subdomains are complex, they don&#8217;t necessarily need to be technical</p></li></ul></div></div></section><section id="_generic_subdomains"><h2>Generic Subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>Generic subdomains are business activities that all companies are performing in the same way.</p></li><li><p>Like core subdomains, generic subdomains are generally complex and hard to implement.</p></li><li><p>However, generic subdomains do not provide any competitive edge for the company.</p></li><li><p>There is no need for innovation or optimization here: battle-tested implementations are widely available, and all companies use them.</p></li></ul></div></div></section><section id="_generic_subdomain_distilled"><h2>Generic Subdomain Distilled</h2><div class="slide-content"><div class="ulist"><ul><li><p>For example, most systems need to authenticate and authorize their users.</p></li><li><p>Instead of inventing a proprietary authentication mechanism, it makes more sense to use an existing solution.</p></li><li><p>Such a solution is likely to be more reliable and secure since it has already been tested by many other companies that have the same needs.</p></li></ul></div></div></section><section id="_supporting_subdomain"><h2>Supporting Subdomain</h2><div class="slide-content"><div class="ulist"><ul><li><p>Supporting subdomains support the company’s business.</p></li><li><p>However, contrary to core subdomains, supporting subdomains do not provide any competitive advantage.</p></li></ul></div></div></section><section id="_supporting_subdomain_distilled"><h2>Supporting Subdomain Distilled</h2><div class="slide-content"><div class="ulist"><ul><li><p>Supporting subdomains are simple.</p></li><li><p>Their business logic resembles mostly data entry screens and ETL (extract, transform, load) operations; that is, the so-called CRUD (create, read, update, and delete) interfaces.</p></li><li><p>These activity areas do not provide any competitive advantage for the company, and therefore do not require high entry barriers.</p></li></ul></div></div></section><section id="_subdomain_differentiation"><h2>Subdomain Differentiation</h2><div class="slide-content"><div class="imageblock"><img src="./images/business_complexity_vs_diff.png" alt="business complexity vs diff"></div>
<div class="openblock listingblock"><div class="content"><div class="paragraph"><p>Source: Learning Domain-Driven Design by Vlad Khononov</p></div></div></div></div></section><section id="_volatility_in_subdomains"><h2>Volatility in Subdomains</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Core Subdomains</dt><dd><p>Change is often. If it can be solved in the first attempt it is not competitive. <em>Evolution is constant</em>.</p></dd><dt class="hdlist1">Supporting Subdomains</dt><dd><p>Do not change often. Does not provide any advantage. <em>Evolution is minuscule</em>.</p></dd><dt class="hdlist1">Generic Subdomains</dt><dd><p>The changes can come in the form of security patches, bug fixes, or entirely new solutions to the generic problems.</p></dd></dl></div></div></section><section id="_implementation_in_subdomains"><h2>Implementation in Subdomains</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Core Subdomains</dt><dd><p>Core subdomains have to be implemented in-house. They cannot be bought or adopted; that would undermine the notion of competitive advantage. They cannot also be outsourced. They cannot be done by cutting corners. The most skilled talent works on the core subdomain. Should be easy to evolve.</p></dd><dt class="hdlist1">Supporting Subdomains</dt><dd><p>Rarely any supporting solutions are available but are often in-house. Supporting subdomains do not require highly skilled technical aptitude and provide a great opportunity to train up-and-coming talent.</p></dd><dt class="hdlist1">Generic Subdomains</dt><dd><p>Buy an off-the-shelf product or adopt an open source solution</p></dd></dl></div></div></section><section id="_table_comparing_the_domains"><h2>Table Comparing the Domains</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:16.6666%"><col style="width:16.6666%"><col style="width:16.6666%"><col style="width:16.6666%"><col style="width:16.6666%"><col style="width:16.667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Subdomain type</th><th class="tableblock halign-left valign-top">Competitive advantage</th><th class="tableblock halign-left valign-top">Complexity</th><th class="tableblock halign-left valign-top">Volatility</th><th class="tableblock halign-left valign-top">Implementation</th><th class="tableblock halign-left valign-top">Problem</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Core</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">High</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">High</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">In-house</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Interesting</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Generic</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">High</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Low</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Buy/adopt</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Solved</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Supporting</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Low</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Low</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">In-house/outsource</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Obvious</p></td></tr></table></div></section><section id="_identifying_subdomains_and_boundaries"><h2>Identifying Subdomains and Boundaries</h2><div class="slide-content"><div class="ulist"><ul><li><p>Next we answer the question, how do we identify the subdomains and their boundaries?</p></li><li><p>Determine or ask a domain expert what "divisions" the company may have, that may or may not provide enough information</p></li><li><p>Look towards company’s departments and other organizational units.</p></li></ul></div></div></section><section id="_distilling_subdomains"><h2>Distilling Subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>There could be finer-grained components that you may miss</p></li><li><p>If you find that "customer-service" is a subdomain, that subdomain can have other</p></li><li><p>For example, an online retail shop might include warehouse, customer service, picking, shipping, quality control, and channel management departments, among others.</p></li></ul></div></div></section><section id="_breaking_down_the_customer_service_subdomain"><h2>Breaking down the "Customer-Service" Subdomain</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">When viewed as individual subdomains, these activities can be of different types</dt><dd><div class="ulist"><ul><li><p>Help desk and telephone systems can be generic subdomains</p></li><li><p>Shift management is a supporting one</p></li><li><p>Meanwhile, a company may develop its ingenious algorithm for routing incidents to agents having success with similar cases in the past..since this ends up competitive advantage this can be a core.</p></li></ul></div></dd></dl></div></div></section><section id="_so_we_break_things_down_when_do_we_stop"><h2>So we break things down. When do we stop?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Use cases are tightly bound by the data that they are using with the involved actors</p></li><li><p>“subdomains as a set of coherent use cases” - drill down until you have cohesive units and cohesive actors</p></li><li><p>The distillation can be somewhat relaxed for supporting and generic subdomains. If drilling down further doesn’t unveil any new insights that can help you make software design decisions, it can be a good place to stop</p></li></ul></div></div></section><section id="_do_we_even_need_the_subdomains"><h2>Do we even need the subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>After drilling through all the subdomains, do you really need them</p></li><li><p>It could be a great opportunity to determine if they are useful or may be going away</p></li></ul></div></div></section><section id="_focusing_on_the_essentials"><h2>Focusing on the essentials</h2><div class="slide-content"><div class="ulist"><ul><li><p>Subdomains are a tool that alleviates the process of making software design decisions</p></li><li><p>All organizations likely have quite a few business functionalities that drive their competitive advantage but have nothing to do with software</p></li><li><p>When looking for subdomains, it’s important to identify business functions that are not related to software, acknowledge them as such, and focus on aspects of the business that are relevant to the software system you are working on.</p></li></ul></div></div></section><section id="_domain_analysis_examples"><h2>Domain Analysis Examples</h2></section><section id="_identifying_domain_experts"><h2>Identifying Domain Experts</h2><div class="slide-content"><div class="ulist"><ul><li><p><em>Domain experts</em> <strong>are</strong>:</p><div class="ulist"><ul><li><p>Subject-matter experts who know all the intricacies of the business that we are going to model and implement in code.</p></li><li><p>Knowledge authorities in the software’s business domain</p></li></ul></div></li><li><p><em>Domain experts</em> <strong>are not</strong>:</p><div class="ulist"><ul><li><p>The analysts gathering the requirements</p></li><li><p>The engineers designing the system</p></li></ul></div></li></ul></div></div></section><section id="_domain_experts_distilled"><h2>Domain Experts Distilled</h2><div class="slide-content"><div class="ulist"><ul><li><p>Domain experts are either the people coming up with requirements or the software’s end users</p></li><li><p>The software is supposed to solve <em>their problems</em></p></li></ul></div></div></section><section id="_domain_experts_and_scope"><h2>Domain Experts and Scope</h2><div class="slide-content"><div class="ulist"><ul><li><p>The domain experts’ expertise can have different scopes:</p><div class="ulist"><ul><li><p>Some subject-matter experts will have a detailed understanding of how the entire business domain operates</p></li><li><p>Others will specialize in particular subdomains.</p></li></ul></div></li><li><p>For example, in an online advertising agency, the domain experts would be:</p><div class="ulist"><ul><li><p>Campaign managers</p></li><li><p>Media buyers</p></li><li><p>Analysts</p></li><li><p>Other business stakeholders</p></li></ul></div></li></ul></div></div></section></section>
<section id="_lab_analyzing_business_domains"><h2>Lab: Analyzing Business Domains</h2></section>
<section><section id="_discovering_domain_knowledge_strategic"><h2>Discovering Domain Knowledge [Strategic]</h2></section><section id="_grasping_knowledge_of_the_business_domain"><h2>Grasping Knowledge of the Business Domain</h2><div class="slide-content"><div class="ulist"><ul><li><p>We are perhaps not experts in the domain that we are designing for</p></li><li><p>We have to mimic the way that the experts perform their jobs</p></li><li><p>We have to understand the problem in order to solve it</p></li></ul></div></div></section><section id="_communication"><h2>Communication</h2><div class="slide-content"><div class="ulist"><ul><li><p>Success depends on collaboration of stakeholders:</p><div class="ulist"><ul><li><p>Product Owners</p></li><li><p>Domain Experts</p></li><li><p>Engineers</p></li><li><p>UI and UX Designers</p></li><li><p>Project Managers</p></li><li><p>etc.</p></li></ul></div></li></ul></div></div></section><section id="_issues_that_arise_with_communication"><h2>Issues that arise with communication</h2><div class="slide-content"><div class="ulist"><ul><li><p>Do all stakeholders agree on what problem is being solved?</p></li><li><p>Do they hold any conflicting assumptions about its functional and nonfunctional requirements?</p></li></ul></div></div></section><section id="_mediators_in_communication"><h2>Mediators in Communication</h2><div class="slide-content"><div class="ulist"><ul><li><p>Communication is essential for success, but it is rarely observed</p></li><li><p>Business people and software engineers have no direct interaction with one another</p></li><li><p>Unfortunately communication from domain experts is filtered by "mediators and translators"</p></li></ul></div></div></section><section id="_who_are_the_translators"><h2>Who are the translators?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Systems/business analysts</p></li><li><p>Product owners</p></li><li><p>Project managers</p></li></ul></div></div></section><section id="_analysis_model"><h2>Analysis Model</h2><div class="slide-content"><div class="ulist"><ul><li><p>Taking <em>domain knowledge</em> and translating it into engineering friendly <em>analysis model</em></p></li><li><p>The analysis model is the description of the system&#8217;s requirements rather than understanding the business domain</p></li><li><p>Mediation can be hazardous, domain knowledge that is essential for solving business problems gets lost on its way to the software engineers</p></li><li><p>Information can be distorted</p></li></ul></div></div></section><section id="_ubiquitous_language"><h2>Ubiquitous Language</h2><div class="slide-content"><div class="ulist"><ul><li><p>Cornerstone of Domain Driven Design</p></li><li><p>A dictionary of the same language</p></li><li><p>A language for describing your business domain</p></li><li><p>Represents both the business domain and the domain experts’ mental models.</p></li></ul></div></div></section><section id="_ubiquitous_language_goals"><h2>Ubiquitous Language Goals</h2><div class="slide-content"><div class="ulist"><ul><li><p>Represent the companies terms only</p></li><li><p>No technical jargon (e.g. RestFUL, Patterns, Kubernetes)</p></li><li><p>Frame the domain experts' understanding and mental model</p></li><li><p>Make it easy to understand and eliminate assumptions</p></li></ul></div></div></section><section id="_example_of_ubiquitous_language"><h2>Example of Ubiquitous Language</h2><div class="slide-content"><div class="ulist"><ul><li><p>"An advertising campaign can display different creative materials."</p></li><li><p>"A campaign can be published only if at least one of its placements is active."</p></li><li><p>"Sales commissions are accounted for after transactions are approved."</p></li></ul></div></div></section><section id="_example_of_poor_understanding_of_ubiquitous_language"><h2>Example of Poor Understanding of Ubiquitous Language</h2><div class="slide-content"><div class="ulist"><ul><li><p>"The advertisement iframe displays an HTML file."</p></li><li><p>"A campaign can be published only if it has at least one associated record in the active-placements table."</p></li><li><p>"Sales commissions are based on correlated records from the transactions and approved-sales tables."</p></li></ul></div></div></section><section id="_consistency"><h2>Consistency</h2><div class="slide-content"><div class="ulist"><ul><li><p>Each term of the Ubiquitous Language should have only <em>one meaning</em></p></li><li><p>If it doesn&#8217;t it may fall into one of the following categories:</p><div class="ulist"><ul><li><p>Ambiguous Terms</p></li><li><p>Synonymous Terms</p></li></ul></div></li></ul></div></div></section><section id="_ambiguous_terms"><h2>Ambiguous Terms</h2><div class="slide-content"><div class="ulist"><ul><li><p>Example: In business domain, the term policy has multiple meanings:</p><div class="ulist"><ul><li><p>A regulatory rule</p></li><li><p>An insurance contract</p></li></ul></div></li><li><p>Ubiquitous language demands a single meaning for each term</p></li><li><p>“policy” should be modeled explicitly using the two terms <em>regulatory rule</em> and <em>insurance contract</em></p></li></ul></div></div></section><section id="_synonymous_terms"><h2>Synonymous Terms</h2><div class="slide-content"><div class="ulist"><ul><li><p>Two terms cannot be used interchangeably in a ubiquitous language</p></li><li><p>Example: <em>user</em></p></li><li><p>User may be used interchangeably: user, visitor, administrator, account, etc.</p></li></ul></div></div></section><section id="_what_is_a_user"><h2>What is a user?</h2><div class="slide-content"><div class="ulist"><ul><li><p>One term can denote different concepts</p></li><li><p><em>visitor</em>, <em>account</em> can refer to system users</p></li><li><p>uregistered and registered users represent different roles and different behaviors</p></li><li><p>Visitors are for analysis; Accounts are use the systems</p></li></ul></div></div></section><section id="_specific_contexts"><h2>Specific contexts</h2><div class="slide-content"><div class="ulist"><ul><li><p>In the case of synonymous terms, it is preferrable to use the terms in it&#8217;s specific <em>context</em></p></li><li><p>Understanding the differences between the terms depending on context allows for simpler and clearer models</p></li></ul></div></div></section><section id="_modeling"><h2>Modeling</h2><div class="slide-content"><div class="ulist"><ul><li><p>An effective model contains only the details needed to fulfill its purpose</p></li><li><p>The model is supposed to capture:</p><div class="ulist"><ul><li><p>The domain experts’ mental models</p></li><li><p>Their thought processes about how the business works to implement its function</p></li><li><p>The involved business entities</p></li></ul></div></li></ul></div></div></section><section id="_modeling_focus"><h2>Modeling Focus</h2><div class="slide-content"><div class="ulist"><ul><li><p>Models are used to solve a problem, but are an abstraction</p></li><li><p>A world map will not show the subways</p></li><li><p>A subway map will not show the continents of the globe</p></li><li><p>“All models are wrong, but some are useful.”&#8201;&#8212;&#8201;George Box</p></li><li><p>"The purpose of abstracting is not to be vague but to create a new semantic level in which one can be absolutely precise."&#8201;&#8212;&#8201;Edsger W. Dijkstra</p></li></ul></div></div></section><section id="_modeling_the_business_domain"><h2>Modeling the Business Domain</h2><div class="slide-content"><div class="ulist"><ul><li><p>The ubiquitous language we use is not supposed to cover every possible detail of the domain.</p></li><li><p>The model is supposed to include just enough aspects of the business domain to make it possible to implement the required system</p></li><li><p>To address the specific problem the software is intended to solve.</p></li></ul></div></div></section><section id="_where_things_can_get_tough"><h2>Where things can get tough</h2><div class="slide-content"><div class="ulist"><ul><li><p>The larger the domain</p><div class="ulist"><ul><li><p>The more communication</p></li><li><p>The harder it is to model and implement as code</p></li><li><p>The likelihood of misunderstanding</p></li><li><p>The likelihood of severe bugs</p></li></ul></div></li></ul></div></div></section><section id="_continuous_effort"><h2>Continuous Effort</h2><div class="slide-content"><div class="ulist"><ul><li><p>The only reliable way to verify a business domain’s understanding is to converse with domain experts with the ubiquitous language</p></li><li><p>Talking with domain experts can uncover inaccuracies, wrong assumptions, flawed understandings of the domain</p></li><li><p>The Ubiquitous Language should <em>always be reinforced throughout the project</em></p></li><li><p>Everyday use of the language will reveal insights over time, and the language must <em>evolve</em></p></li></ul></div></div></section><section id="_ubiqituous_language_and_artifacts"><h2>Ubiqituous Language and Artifacts</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Ubiquitous Language should be used in</dt><dd><div class="ulist"><ul><li><p>Requirements</p></li><li><p>Tests</p></li><li><p>Documentation</p></li><li><p>Source Code</p></li></ul></div></dd></dl></div></div></section><section id="_ubiquitous_language_in_a_glossary"><h2>Ubiquitous Language in a Glossary</h2><div class="slide-content"><div class="ulist"><ul><li><p>A <em>wiki</em> to be used as a glossary to capture the ubiquitous language</p><div class="ulist"><ul><li><p>It makes it easy to onboard new members with terms</p></li><li><p>It is a shared resource</p></li><li><p>Include nouns: names of entities, processes, roles, etc.</p></li><li><p>Include verbs: processes and behaviour</p></li></ul></div></li></ul></div></div></section><section id="_using_gherkin_and_bdd_to_derive_testing"><h2>Using Gherkin and BDD to derive testing</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-gherkin hljs" data-noescape="true" data-lang="gherkin">Given the account has a balance of $23.95
When a message of "balance" comes in from a /known phone number/
Then a text is sent back: "Your balance is $23.95"

Given the account has a balance of $23.95
When any message comes in from a /UNKNOWN phone number/
Then log message and phone number, and do nothing

Given the account has a balance of $23.95
When any message other than "balance" comes in from a /known phone number/
Then send text back: "Didn't understand message, send BALANCE for current balance."</code></pre></div></div></div></section><section id="_challenges"><h2>Challenges</h2><div class="slide-content"><div class="ulist"><ul><li><p>Defining Ubiquitous Language is not easy</p></li><li><p>Most knowledge is tacit: In the minds of the domain experts. Ask Questions</p></li></ul></div></div></section><section id="_brownfield_projects"><h2>Brownfield Projects</h2><div class="slide-content"><div class="ulist"><ul><li><p>There likely is a quasi-defined ubiquitous language that the stakeholders already use</p></li><li><p>It may not reflect the actual domain accurately</p></li><li><p>It may use technical terms, like database names</p></li><li><p>It is not easy to change a language already in use, be patient</p></li><li><p>Control it first in documentation and source code</p></li></ul></div></div></section></section>
<section id="_lab_discovering_domain_knowledge"><h2>Lab: Discovering Domain Knowledge</h2></section>
<section><section id="_managing_domain_complexity_strategic"><h2>Managing Domain Complexity [Strategic]</h2></section><section id="_consistent_inconsistent_models"><h2>Consistent &amp; Inconsistent Models</h2><div class="slide-content"><div class="ulist"><ul><li><p>Ubiquitous Language should be consistent since it will drive decisions</p></li><li><p>As companies scale, the domain experts' mental models will be inconsistent</p></li></ul></div></div></section><section id="_inconsistent_models"><h2>Inconsistent Models</h2><div class="slide-content"><div class="paragraph"><p>What if after examing domain expert&#8217;s language, you find that in two context there is overloaded term: <em>lead</em>?</p></div>
<div class="dlist"><dl><dt class="hdlist1">Marketing Department</dt><dd><p>For the marketing people, a lead represents a notification that somebody is interested in one of the products. The event of receiving the prospective customer’s contact details is considered a lead</p></dd><dt class="hdlist1">Sales Department</dt><dd><p>In the context of the sales department, a lead is a much more complex entity. It represents the entire lifecycle of the sales process. It’s not a mere event, but a long-running process</p></dd></dl></div></div></section><section id="_dealing_with_ambiguity"><h2>Dealing with Ambiguity</h2><div class="slide-content"><div class="ulist"><ul><li><p>Uniquitous Language needs to be consistent - each term should have one meaning</p></li><li><p>Ubiquitous Language needs to map to domain experts' mental models</p></li><li><p>Having two <em>lead</em>s isn&#8217;t a problem <em>in communication</em>, but it is in software</p></li></ul></div></div></section><section id="_the_traditional_approach"><h2>The Traditional Approach</h2><div class="slide-content"><div class="ulist"><ul><li><p>The Traditional Approach for such modeling a single model</p></li><li><p>Typically defined by an enormous entity relationship (ERD)</p></li><li><p>"Suitable for everything but eventually are effective for nothing"</p></li></ul></div>
<div class="imageblock"><img src="./images/big-erd.png" alt="big erd"></div></div></section><section id="_what_about_prefixing"><h2>What about prefixing?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Can we do “marketing lead” and “sales lead"?</p></li><li><p>Allows for two different models of code</p></li><li><p>This has three main disadvantages:</p><div class="ulist"><ul><li><p>Creates cognitive load. When should each be used? The closer they are the likely a mistake</p></li><li><p>The implementation will not be aligned with the ubiquitous languages</p></li><li><p>Does anyone use the prefixed terms in everyday language?</p></li></ul></div></li></ul></div></div></section><section id="_introducing_the_bounded_context"><h2>Introducing the Bounded Context</h2><div class="slide-content"><div class="ulist"><ul><li><p>The solution:</p><div class="ulist"><ul><li><p><em>Divide the Ubiquitous Language into multiple smaller languages</em></p></li><li><p>Assign each team to the explicit context in which it can be applied: its <em>bounded context</em></p></li></ul></div></li></ul></div></div></section><section id="_bounded_context_by_example"><h2>Bounded Context by Example</h2><div class="slide-content"><div class="imageblock"><img src="./images/bounded_context_1.png" alt="bounded context 1"></div></div></section><section id="_model_boundaries"><h2>Model Boundaries</h2><div class="slide-content"><div class="ulist"><ul><li><p>A model is a construct that helps us makes sense of a complex system</p></li><li><p>It is supposed to solve an inherent part of a model - it&#8217;s purpose</p></li><li><p>A model cannot exist without a boundary</p></li></ul></div></div></section><section id="_purpose_for_boundaries"><h2>Purpose for boundaries</h2><div class="slide-content"><div class="ulist"><ul><li><p>Just like types of maps - aerial, nautical, terrain, subway, and so on</p></li><li><p>One bounded context can be completely irrelevant to the scope of another</p></li><li><p>They allow distinct models according to different problem domains</p></li><li><p>Bounded contexts are the consistency boundaries of ubiquitous language</p></li><li><p>An Ubiquitous Language is <em>not universal</em></p></li></ul></div></div></section><section id="_ubiquitous_within_a_context"><h2>Ubiquitous within a context</h2><div class="slide-content"><div class="ulist"><ul><li><p>An ubiquitous language is ubiquitous only in the boundaries of its bounded context</p></li><li><p>The language is focused on describing only the model that is encompassed by the bounded context</p></li><li><p>An ubiquitous language cannot be defined or used without an explicit context of its applicability</p></li></ul></div></div></section><section id="_we_can_narrow_the_scope_of_a_bounded_context"><h2>We can narrow the scope of a bounded context</h2><div class="slide-content"><div class="ulist"><ul><li><p>You can decompose bounded contexts into small based on language and relevancy</p></li><li><p>Defining bounded contexts is a strategic design decisions</p></li><li><p>Boundaries can be:</p><div class="ulist"><ul><li><p>Wide - Following the business domain’s inherent contexts</p></li><li><p>Narrow - Further dividing the business domain into smaller problem domains</p></li></ul></div></li></ul></div></div></section><section id="_models_need_to_be_useful"><div class="slide-content"><div class="quoteblock"><blockquote><div class="paragraph"><p>"Models shouldn’t necessarily be big or small. Models need to be useful."</p></div></blockquote></div></div></section><section id="_so_what_is_it_small_or_large_bounded_context"><h2>So what is it? Small or Large Bounded Context?</h2><div class="slide-content"><div class="ulist"><ul><li><p>The wider the boundary of the ubiquitous language is, the harder it is to keep it consistent.</p></li><li><p>It may be beneficial to divide a large ubiquitous language into smaller, more manageable problem domains</p></li><li><p>But, striving for small bounded contexts can backfire too.</p></li><li><p>The smaller they are, the more integration overhead the design induces</p></li><li><p>The decision, is based on your problem domain</p></li></ul></div></div></section><section id="_more_reasons_for_fine_grained_bounded_contexts"><h2>More Reasons for Fine-Grained Bounded Contexts</h2><div class="slide-content"><div class="ulist"><ul><li><p>Creating new software engineering teams or addressing some of the system’s nonfunctional requirements; for example, when you need to separate the development lifecycles of some of the components originally residing in a single bounded context</p></li><li><p>Ability to scale it independently from the rest of the bounded context’s functionalities</p></li></ul></div></div></section><section id="_more_reasons_for_coarse_grained_bounded_contexts"><h2>More Reasons for Coarse-Grained Bounded Contexts</h2><div class="slide-content"><div class="ulist"><ul><li><p>Division will hinder the ability to evolve each context independently.</p></li><li><p>Instead, the same business requirements and changes will simultaneously affect the bounded contexts and require simultaneous deployment of the changes.</p></li><li><p>Identify sets of coherent use cases that operate on the same data and avoid decomposing them into multiple bounded contexts.</p></li></ul></div></div></section><section id="_bounded_contexts_vs_subdomains"><h2>Bounded Contexts vs Subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>Subdomains</p><div class="ulist"><ul><li><p>Recall identification of different subdomains: core, supporting, generic</p></li><li><p>Subdomains are interrelated use-cases and defined by the business domain and system requirements</p></li></ul></div></li><li><p>Bounded Contexts</p><div class="ulist"><ul><li><p>Designed - A strategic designed decision</p></li><li><p>We decide how to divide the business domain into smaller, manageable problem domains</p></li></ul></div></li></ul></div></div></section><section id="_boundaries"><h2>Boundaries</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">The bounded context pattern is the domain-driven design tool for defining boundaries</dt><dd><div class="ulist"><ul><li><p>Physical</p></li><li><p>Ownership</p></li></ul></div></dd></dl></div></div></section><section id="_physical_boundaries"><h2>Physical Boundaries</h2><div class="slide-content"><div class="ulist"><ul><li><p>Each bounded context should be implemented as an individual service/project</p><div class="ulist"><ul><li><p>It is implemented, evolved, and versioned independently of other bounded contexts</p></li></ul></div></li><li><p>Clear physical boundaries between bounded contexts allow us to implement each bounded context with the technology stack that best fits its needs</p></li><li><p>A bounded context can contain multiple subdomains. In such a case, the bounded context is a <em>physical boundary</em>, ach of its subdomains is a <em>logical boundary</em></p></li><li><p>Logical boundaries bear different names in different programming languages: namespaces, modules, or packages.</p></li></ul></div></div></section><section id="_ownership_boundaries"><h2>Ownership Boundaries</h2><div class="slide-content"><div class="ulist"><ul><li><p><em>A bounded context should be implemented, evolved, and maintained by one team only</em></p></li><li><p>No two teams can work on the same bounded context</p></li><li><p>Segregation eliminates implicit assumptions that teams might make about one another’s models</p></li></ul></div></div></section><section id="_unidirectional_relationship_of_bounded_contexts"><h2>Unidirectional Relationship of Bounded Contexts</h2><div class="slide-content"><div class="ulist"><ul><li><p>A bounded context should be owned by only one team.</p></li><li><p>However, a single team can own multiple bounded contexts</p></li></ul></div>
<div class="imageblock"><img src="./images/multiple_contexts.png" alt="multiple contexts" width="50%" height="50%"></div></div></section><section id="_semantic_domains"><h2>Semantic Domains</h2><div class="slide-content"><div class="ulist"><ul><li><p>How you and your team perceive domains is for you to decide.</p></li><li><p>Domains are semantic</p></li><li><p>e.g. a tomato</p><div class="ulist"><ul><li><p>In botany - the tomato is a fruit</p></li><li><p>In culinary -  the tomato is a vegetable</p></li><li><p>In taxation - In 1883 the United States established a 10% tax on imported vegetables, but not fruits, for taxation purposes, <em>the tomato is a vegetable</em></p></li><li><p>In theatre - the tomato is a feedback mechanism</p></li></ul></div></li></ul></div></div></section></section>
<section><section id="_event_storming_strategic"><h2>Event Storming [Strategic]</h2></section><section id="_what_is_event_storming"><h2>What is Event Storming?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Low-tech activity for a group of people to brainstorm and rapidly model a business process.</p></li><li><p>In a sense, EventStorming is a tactical tool for sharing business domain knowledge.</p></li><li><p>An EventStorming session has a scope: the business process that the group is interested in exploring.</p></li><li><p>The participants are exploring the process as a series of domain events, represented by sticky notes, over a timeline. Step by step, the model is enhanced with additional concepts—actors, commands, external systems, and others—until all of its elements tell the story of how the business process works.</p></li></ul></div></div></section><section id="_alberto_brandolini"><div class="slide-content"><div class="quoteblock"><blockquote>Just keep in mind that the goal of the workshop is to learn as much as possible in the shortest time possible. We invite key people to the workshop, and we don’t want to waste their valuable time.</blockquote><div class="attribution">&#8212; Alberto Brandolini: Creator of the EventStorming workshop</div></div></div></section><section id="_why"><h2>Why?</h2><div class="slide-content"><div class="ulist"><ul><li><p>When new domain knowledge is discovered, it should be leveraged to evolve the design and make it more resilient.</p></li><li><p>Unfortunately, changes in domain knowledge are not always positive: domain knowledge can be lost. As time goes by, documentation often becomes stale, people who were working on the original design leave the company, and new functionality is added in an ad hoc manner until, at one point, the codebase gains the dubious status of a legacy system.</p></li><li><p>It’s vital to prevent such degradation of domain knowledge proactively.</p></li><li><p>An effective tool for recovering domain knowledge is the EventStorming workshop</p></li></ul></div></div></section><section id="_people"><h2>People</h2><div class="slide-content"><div class="ulist"><ul><li><p>A diverse group of people should participate in the workshop.</p></li><li><p>Anyone related to the business domain in question can participate: engineers, domain experts, product owners, testers, UI/UX designers, support personnel, and so on.</p></li><li><p>As more people with different backgrounds are involved, more knowledge will be discovered.</p></li><li><p>Take care not to make the group too big, however.</p></li><li><p>Every participant should be able to contribute to the process, but this can be challenging for groups of more than 10 participants.</p></li></ul></div></div></section><section id="_requirements"><h2>Requirements</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Modeling space</dt><dd><p>First, you need a large modeling space. A whole wall covered with butcher paper makes the best modeling space A large whiteboard can fit the purpose as well, but it has to be as big as possible—you will need all the modeling space you can get.</p></dd><dt class="hdlist1">Sticky notes</dt><dd><p>Next, you need lots of sticky notes of different colors. The notes will be used to represent different concepts of the business domain, and every participant should be able to add them freely, so make sure you have enough colors and enough for everyone. The colors that are traditionally used for EventStorming are described in the next section. It’s best to stick to these conventions, if possible, to be consistent with all of the currently available EventStorming books and trainings.</p></dd></dl></div></div></section><section id="_requirements_2"><h2>Requirements</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Markers</dt><dd><p>You’ll also need markers that you can use to write on the sticky notes. Again, supplies shouldn’t be a bottleneck for knowledge sharing—there should be enough markers for all participants.</p></dd><dt class="hdlist1">Snacks</dt><dd><p>A typical EventStorming session lasts about two to four hours, so bring some healthy snacks for energy replenishment.</p></dd><dt class="hdlist1">Room</dt><dd><p>Finally, you need a spacious room. Ensure there isn’t a huge table in the middle that will prevent participants from moving freely and observing the modeling space. Also, chairs are a big no-no for EventStorming sessions. You want people to participate and share knowledge, not sit in a corner and zone out. Therefore, if possible, take the chairs out of the room.</p></dd></dl></div></div></section><section id="_step_1_unstructured_exploration"><h2>Step 1: Unstructured Exploration</h2><div class="slide-content"><div class="ulist"><ul><li><p>EventStorming starts with a brainstorm of the domain events related to the business domain being explored.</p></li><li><p>A domain event is something interesting that has happened in the business.</p></li><li><p>It’s important to formulate domain events in the <em>past tense</em> —they are describing things that have already happened.</p></li></ul></div></div></section><section id="_step_1_unstructured_exploration_continued"><h2>Step 1: Unstructured Exploration (Continued)</h2><div class="slide-content"><div class="ulist"><ul><li><p>All participants are grabbing a bunch of orange sticky notes, writing down whatever domain events come to mind, and sticking them to the modeling surface.</p></li><li><p>There is no need to worry about ordering events, or even about redundancy</p></li><li><p>This step is all about brainstorming the possible things that can happen in the business domain</p></li><li><p>The group should continue generating domain events until the rate of adding new ones slows significantly.</p></li></ul></div></div></section><section id="_step_1_unstructured_exploration_continued_2"><h2>Step 1: Unstructured Exploration (Continued)</h2><div class="slide-content"><div class="imageblock"><img src="./images/eventstorm_events.png" alt="eventstorm events"></div></div></section><section id="_step_2_timelines"><h2>Step 2: Timelines</h2><div class="slide-content"><div class="ulist"><ul><li><p>Next, the participants go over the generated domain events and organize them in the order in which they occur in the business domain.</p></li><li><p>The events should start with the “happy path scenario”: the flow that describes a successful business scenario.</p></li><li><p>Once the “happy path” is done, alternative scenarios can be added—for example, paths where errors are encountered or different business decisions are taken.</p></li><li><p>The flow branching can be expressed as two flows coming from the preceding event or with arrows drawn on the modeling surface</p></li><li><p>This step is also the time to fix incorrect events, remove duplicates, and of course, add missing events if necessary.</p></li></ul></div></div></section><section id="_step_2_timelines_continued"><h2>Step 2: Timelines (Continued)</h2><div class="slide-content"><div class="imageblock"><img src="./images/eventstorm_timeline.png" alt="eventstorm timeline"></div></div></section><section id="_step_3_pain_points"><h2>Step 3: Pain Points</h2><div class="slide-content"><div class="ulist"><ul><li><p>Once you have the events organized in a timeline, use this broad view to identify points in the process that require attention.</p></li><li><p>These can be bottlenecks, manual steps that require automation, missing documentation, or missing domain knowledge.</p></li><li><p>It’s important to make these inefficiencies explicit so that it will be easy to return to them as the EventStorming session progresses, or to address them afterward.</p></li><li><p>The pain points are marked with rotated (diamond) pink sticky notes</p></li><li><p>As a facilitator, be aware of the participants’ comments throughout the process. When an issue or a concern is raised, document it as a pain point</p></li></ul></div></div></section><section id="_step_3_pain_points_continued"><h2>Step 3: Pain Points (Continued)</h2><div class="slide-content"><div class="imageblock"><img src="./images/eventstorm_painpoints.png" alt="eventstorm painpoints"></div></div></section><section id="_step_4_pivotal_events"><h2>Step 4: Pivotal Events</h2><div class="slide-content"><div class="ulist"><ul><li><p>Once you have a timeline of events augmented with pain points, look for significant business events indicating a change in context or phase.</p></li><li><p>These are called pivotal events and are marked with a vertical bar dividing the events before and after the pivotal event.</p></li><li><p>For example, “shopping cart initialized,” “order initialized,” “order shipped,” “order delivered,” and “order returned” represent significant changes in the process of making an order</p></li><li><p><strong>Pivotal events are an indicator of potential bounded context boundaries</strong></p></li></ul></div>
<div class="imageblock"><img src="./images/eventstorm_pivotal_events.png" alt="eventstorm pivotal events"></div></div></section><section id="_step_5_commands"><h2>Step 5: Commands</h2><div class="slide-content"><div class="ulist"><ul><li><p>Whereas a domain event describes something that has already happened, a command describes what triggered the event or flow of events.</p></li><li><p>Commands describe the system’s operations and, contrary to domain events, are formulated in the imperative.</p><div class="ulist"><ul><li><p>Publish campaign</p></li><li><p>Roll back transaction</p></li><li><p>Submit order</p></li></ul></div></li></ul></div></div></section><section id="_step_5_commands_continued"><h2>Step 5: Commands (Continued)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Commands are written on light blue sticky notes and placed on the modeling space before the events they can produce.</p></li><li><p>If a particular command is executed by an actor in a specific role, the actor information is added to the command on a small yellow sticky note</p></li><li><p>The actor represents a user persona within the business domain, such as customer, administrator, or editor.</p></li><li><p>Naturally, not all commands will have an associated actor.</p></li><li><p>Therefore, add the actor information only where it’s obvious</p></li></ul></div></div></section><section id="_step_5_commands_continued_2"><h2>Step 5: Commands (Continued)</h2><div class="slide-content"><div class="imageblock"><img src="./images/eventstorm_commands.png" alt="eventstorm commands"></div></div></section><section id="_step_6_policies"><h2>Step 6: Policies</h2><div class="slide-content"><div class="ulist"><ul><li><p>Some commands are added to the model but have no specific actor associated with them.</p></li><li><p>During this step, you look for automation policies that might execute those commands.</p></li><li><p>An <em>automation policy</em> is a scenario in which an event triggers the execution of a command</p></li><li><p>Policies are represented as purple sticky notes connecting events to commands</p></li><li><p>Example: You need to trigger the escalate command after the “complaint received” event, but only if the complaint was received from a VIP customer, you can explicitly state the “only for VIP customers” condition on the policy sticky</p></li></ul></div></div></section><section id="_step_6_policies_continued"><h2>Step 6: Policies (Continued)</h2><div class="slide-content"><div class="imageblock"><img src="./images/eventstorm_policy.png" alt="eventstorm policy"></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">If the events and commands are far apart, you can draw an arrow on the modeling surface to connect them.</td></tr></table></div></div></section><section id="_step_7_read_models"><h2>Step 7: Read Models</h2><div class="slide-content"><div class="ulist"><ul><li><p>A read model is the view of data within the domain that the actor uses to make a decision to execute a command.</p></li><li><p>This can be one of the system’s screens, a report, a notification, and so on.</p></li><li><p>The read models are represented by green sticky notes with a short description of the source of information needed to support the actor’s decision</p></li><li><p>Since a command is executed after the actor has viewed the read model, on the modeling surface the read models are positioned before the commands</p></li></ul></div></div></section><section id="_step_7_read_models_continued"><h2>Step 7: Read Models (Continued)</h2><div class="slide-content"><div class="imageblock"><img src="./images/eventstorm_readmodels.png" alt="eventstorm readmodels"></div></div></section><section id="_step_8_external_systems"><h2>Step 8: External Systems</h2><div class="slide-content"><div class="ulist"><ul><li><p>This step is about augmenting the model with external systems.</p></li><li><p>An external system is defined as any system that is not a part of the domain being explored.</p></li><li><p>It can execute commands (input) or can be notified about events (output).</p></li><li><p>The external systems are represented by pink sticky notes.</p></li><li><p><strong>By the end of this step, all commands should either be executed by actors, triggered by policies, or called by external systems</strong></p></li></ul></div></div></section><section id="_step_8_external_systems_continued"><h2>Step 8: External Systems (Continued)</h2><div class="slide-content"><div class="imageblock"><img src="./images/eventstorm_externalsystems.png" alt="eventstorm externalsystems"></div></div></section><section id="_step_9_aggregates"><h2>Step 9: Aggregates</h2><div class="slide-content"><div class="ulist"><ul><li><p>Once all the events and commands are represented, the participants can start thinking about organizing related concepts in aggregates.</p></li><li><p>An aggregate receives commands and produces events.</p></li><li><p>Aggregates are represented as large yellow sticky notes, with commands on the left and events on the right</p></li></ul></div>
<div class="imageblock"><img src="./images/eventstorm_aggregates.png" alt="eventstorm aggregates"></div></div></section><section id="_step_10_bounded_contexts"><h2>Step 10: Bounded Contexts</h2><div class="slide-content"><div class="ulist"><ul><li><p>The last step of an EventStorming session is to look for aggregates that are related to each other, either because they represent closely related functionality or because they’re coupled through policies</p></li><li><p>The groups of aggregates form natural candidates for bounded contexts’ boundaries</p></li></ul></div></div></section><section id="_step_10_bounded_contexts_continued"><h2>Step 10: Bounded Contexts (Continued)</h2><div class="slide-content"><div class="imageblock"><img src="./images/eventstorm_boundedcontext.png" alt="eventstorm boundedcontext"></div></div></section><section id="_variations"><h2>Variations</h2><div class="slide-content"><div class="ulist"><ul><li><p>Alberto Brandolini, the creator of the EventStorming workshop, defines the EventStorming process as guidance, not hard rules.</p></li><li><p>You are free to experiment with the process to find the “recipe” that works best for you.</p></li><li><p>The real value of an EventStorming session is the process itself—the sharing of knowledge among different stakeholders, alignment of their mental models of the business, discovery of conflicting models, and, last but not least, formulation of the ubiquitous language.</p></li></ul></div></div></section><section id="_keep_a_legend_around"><h2>Keep a legend around</h2><div class="slide-content"><div class="imageblock"><img src="./images/eventstorm_legend.png" alt="eventstorm legend"></div></div></section><section id="_watch_the_dynamics"><h2>Watch the dynamics</h2><div class="slide-content"><div class="ulist"><ul><li><p>Watch the energy. If there is slowdown reignite with questions or move to the next stage</p></li><li><p>Ensure that the <em>entire group</em> is present. Involve even those that are reluctant to participate</p></li><li><p>Ensure that you take breaks and ready for collaboration</p></li><li><p>Five (Preferable) to Ten participants is optimal, if more needed break up into teams and compare notes</p></li></ul></div></div></section></section>
<section id="_lab_event_storming"><h2>Lab: Event Storming</h2></section>
<section><section id="_integrating_bounded_contexts_strategic"><h2>Integrating Bounded Contexts [Strategic]</h2></section><section id="_contracts"><h2>Contracts</h2><div class="slide-content"><div class="ulist"><ul><li><p>A system cannot be built out of independent components, the components have to interact with one another to achieve the system’s overarching goals</p></li><li><p>The same goes for implementations in bounded contexts.</p></li><li><p>Although they can evolve independently, they have to integrate with one another</p></li><li><p>These are called <em>contracts</em></p></li></ul></div></div></section><section id="_contract_between_contracts"><h2>Contract Between Contracts</h2><div class="slide-content"><div class="ulist"><ul><li><p>By definition, two bounded contexts are using different ubiquitous languages.</p></li><li><p>Which language will be used for integration purposes?</p></li><li><p>These integration concerns should be evaluated and addressed</p></li></ul></div></div></section><section id="_cooperation"><h2>Cooperation</h2><div class="slide-content"><div class="ulist"><ul><li><p>Cooperation patterns relate to bounded contexts implemented by teams with well-established communication.</p></li><li><p>They are either:</p><div class="ulist"><ul><li><p>The same team</p></li><li><p>Two teams very tightly coordinated</p></li></ul></div></li></ul></div></div></section><section id="_partnership"><h2>Partnership</h2><div class="slide-content"><div class="ulist"><ul><li><p>Integration between bounded contexts is coordinated in an ad hoc manner</p></li><li><p>One team can notify a second team about a change in the API, and the second team will cooperate and adapt—no drama or conflicts</p></li></ul></div>
<div class="imageblock"><img src="./images/partnership.png" alt="partnership"></div></div></section><section id="_partnership_coordination"><h2>Partnership Coordination</h2><div class="slide-content"><div class="ulist"><ul><li><p>Coordination is two-way</p></li><li><p>No one team dictates the language that is used for defining the contracts</p></li><li><p>Teams work out the differences and choose the most appropriate solution</p></li><li><p>Both cooperate, and neither is interest in blocking another</p></li></ul></div></div></section><section id="_partnership_requirements"><h2>Partnership Requirements</h2><div class="slide-content"><div class="ulist"><ul><li><p>Commitment</p></li><li><p>Constant Communication</p></li><li><p>Continuous Integration to minimize the integration feedback loop</p></li><li><p>Both teams should highly likely be geographically in the same location</p></li></ul></div></div></section><section id="_shared_kernelmodel"><h2>Shared Kernel/Model</h2><div class="slide-content"><div class="ulist"><ul><li><p>Same model of a subdomain, or a part of it, implemented in multiple bounded contexts</p></li><li><p>Designed according to the needs of all of the bounded contexts</p></li><li><p>Consistent across all of the bounded contexts that are using it</p></li></ul></div>
<div class="imageblock"><img src="./images/share_kernel.png" alt="share kernel"></div></div></section><section id="_shared_kernelmodel_2"><h2>Shared Kernel/Model</h2><div class="slide-content"><div class="ulist"><ul><li><p>Example: Custom Authentication/Authorization module used by separate bounded contexts</p></li><li><p>Each bounded context can modify the authorization model, and the changes each bounded context applies have to affect all the other bounded contexts using the model</p></li><li><p>To minimize the cascading effects of changes, the overlapping model should expose only that part of the model <em>that has to be</em> implemented by both bounded contexts</p></li><li><p>Consist only of integration contracts and data structures that are intended to be passed across the bounded contexts’ boundaries</p></li></ul></div></div></section><section id="_implementation_of_shared_kernel"><h2>Implementation of Shared Kernel</h2><div class="slide-content"><div class="ulist"><ul><li><p>In a mono-repo: these can be the same source files referenced by multiple bounded contexts</p></li><li><p>In a dedicated-repo: shared kernel can be extracted into a dedicated project and referenced in the bounded contexts as a linked library</p></li></ul></div></div></section><section id="_shared_kernel_and_continuous_integration"><h2>Shared Kernel and Continuous Integration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Continuous Integration of changes is <strong>required</strong> because the shared kernel belongs to multiple bounded contexts</p></li><li><p>Not doing so will cause stale implementations leading to data corruption or runtime issues</p></li></ul></div></div></section><section id="_when_to_use_shared_kernel"><h2>When to use shared kernel?</h2><div class="slide-content"><div class="ulist"><ul><li><p>It should be applied only when the <em>cost of duplication is higher than the cost of coordination</em></p></li><li><p>In other words, only when integrating changes applied to the shared model by both bounded contexts will require more effort than coordinating the changes in the shared codebase</p></li><li><p>Using a shared kernel violates the independence rule of bounded context, and therefore, should be justified</p></li><li><p>Shared Kernel can be used as a temporary measure to migrate one legacy application into multiple bounded-contexts</p></li><li><p>Shared Kernel can be used as a temporary measure to integrate multiple bounded contexts owned by the same team</p></li><li><p>If a lot of model code ends up in the shared kernel, it may be a sign that the contexts should, in fact, be merged into one big context</p></li></ul></div></div></section><section id="_customer_supplier"><h2>Customer-Supplier</h2><div class="slide-content"><div class="ulist"><ul><li><p>The service provider is “upstream” and the customer or consumer is “downstream.”</p></li><li><p>Both teams (upstream and downstream) can succeed independently</p></li><li><p>Imbalance of power: either the upstream or the downstream team can dictate the integration contract</p></li><li><p>This is where a decision should be made about the relationship</p></li></ul></div>
<div class="imageblock"><img src="./images/upstream-downstream.png" alt="upstream downstream"></div></div></section><section id="_conformist"><h2>Conformist</h2><div class="slide-content"><div class="ulist"><ul><li><p>Balance of power favors the upstream team, no real motivation to support the client</p></li><li><p>Upstream provides the integration contract, defined according to its own model—take it or leave it</p></li><li><p>Caused by integration with service providers that are external to the organization or simply by organizational politics</p></li><li><p>The contract exposed by the upstream team may be an industry-standard, well-established model, or it may just be good enough for the downstream team’s needs.</p></li></ul></div>
<div class="imageblock"><img src="./images/conformist.png" alt="conformist"></div></div></section><section id="_anti_corruption_layer"><h2>Anti-Corruption Layer</h2><div class="slide-content"><div class="ulist"><ul><li><p>The balance of power in this relationship is still skewed toward the upstream service.</p></li><li><p>In this case, the downstream bounded context is not willing to conform.</p></li><li><p>Instead, it translates the upstream bounded context’s model into a model tailored to its own needs via an anticorruption layer</p></li></ul></div>
<div class="imageblock"><img src="./images/anticorruption_layer.png" alt="anticorruption layer"></div></div></section><section id="_reasons_for_anti_corruption_layer"><h2>Reasons for Anti-Corruption Layer</h2><div class="slide-content"><div class="ulist"><ul><li><p>A core subdomain’s model requires extra attention, and adhering to the supplier’s model might impede the modeling of the problem domain.</p></li><li><p>When the upstream model is inefficient or inconvenient for the consumer’s needs</p></li><li><p>If a bounded context conforms to a mess, it risks becoming a mess itself (legacy systems)</p></li><li><p>When the supplier’s contract changes often, the consumer wants to protect its model from frequent changes</p></li></ul></div></div></section><section id="_open_host_service"><h2>Open Host Service</h2><div class="slide-content"><div class="ulist"><ul><li><p>Power is toward the consumers</p></li><li><p>Supplier is interested in protecting its consumers and providing the best service possible.</p></li><li><p>Upstream supplier decouples the implementation model from the public interface.</p></li><li><p>Allows the supplier to evolve its implementation and public models at different rates</p></li><li><p>The supplier exposes a protocol convenient for the consumers</p></li></ul></div>
<div class="imageblock"><img src="./images/ohs1.png" alt="ohs1"></div></div></section><section id="_published_language"><h2>Published Language</h2><div class="slide-content"><div class="ulist"><ul><li><p>Publicly used to communicate and integrate between different Bounded Contexts.</p></li><li><p>They also have an agreed-meaning across Bounded Contexts.</p></li><li><p>Mainly used by engineers working in different Bounded Contexts to agree on integration approach (open-host, client-server, pub-sub, etc.).</p></li><li><p>Mainly expressed via technical format (API, JSON, XML, Protocol Buffer, etc.)</p></li></ul></div></div></section><section id="_open_host_service_2"><h2>Open Host Service</h2><div class="slide-content"><div class="ulist"><ul><li><p>Upstream bounded context the freedom to evolve its implementation without affecting the downstream contexts</p></li><li><p>Possible if the modified implementation model can be translated into the published language the consumers are already using</p></li></ul></div></div></section><section id="_open_host_service_multiple_protocols"><h2>Open Host Service Multiple Protocols</h2><div class="slide-content"><div class="ulist"><ul><li><p>Integration model’s decoupling allows the upstream bounded context to simultaneously expose multiple versions of the published language</p></li><li><p>Allowing the consumer to migrate to the new version gradually</p></li></ul></div>
<div class="imageblock"><img src="./images/ohs2.png" alt="ohs2"></div></div></section><section id="_separate_ways_free"><h2>Separate Ways / Free</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Last option or pattern is not to collaborate at all for the following reasons</dt><dd><div class="ulist"><ul><li><p>Communication Issues</p></li><li><p>Generic Subdomains</p></li><li><p>Model Differences</p></li></ul></div></dd></dl></div>
<div class="imageblock"><img src="./images/free.png" alt="free"></div></div></section><section id="_communication_issues"><h2>Communication Issues</h2><div class="slide-content"><div class="ulist"><ul><li><p>Organization Size and Politics hinders collaboration</p></li><li><p>Teams may have a hard time collaborating</p></li><li><p>It may be more cost-effective to go their separate ways and duplicate functionality in multiple bounded contexts</p></li></ul></div></div></section><section id="_generic_subdomains_2"><h2>Generic Subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>When the subdomain in question is generic, and if the generic solution is easy to integrate, it may be more cost-effective to integrate it locally in each bounded context.</p></li><li><p>An example is a logging framework; it would make little sense for one of the bounded contexts to expose it as a service.</p></li><li><p>Duplicating the functionality would be less expensive than collaborating.</p></li></ul></div></div></section><section id="_model_differences"><h2>Model Differences</h2><div class="slide-content"><div class="ulist"><ul><li><p>The models may be so different that a conformist relationship is impossible</p></li><li><p>Implementing an anticorruption layer would be more expensive than duplicating the functionality</p></li></ul></div></div></section><section id="_creating_a_context_map"><h2>Creating a Context Map</h2><div class="slide-content"><div class="paragraph"><p>Context map is a visual representation of the system’s bounded contexts and the integrations between them</p></div>
<div class="imageblock"><img src="./images/context_map.png" alt="context map"></div></div></section><section id="_benefits_to_a_context_map"><h2>Benefits to a Context Map</h2><div class="slide-content"><div class="ulist"><ul><li><p>Provides an overview of the system&#8217;s components and the models they impelment</p></li><li><p>Exhibits the communication patterns among teams and which teams are tight</p></li><li><p>Gives insight to organizational issues, forces questions and thought</p></li></ul></div></div></section><section id="_maintenance"><h2>Maintenance</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Context Maps should be</dt><dd><div class="ulist"><ul><li><p>Introduced from the beginning</p></li><li><p>Updated to reflect additions and changes</p></li><li><p>A shared effort where each team updates its own integrations</p></li></ul></div></dd></dl></div></div></section><section id="_context_mapper"><h2>Context Mapper</h2><div class="slide-content"><div class="paragraph"><p>A context map can be managed and maintained as code, using a tool like <a href="https://contextmapper.org/">Context Mapper</a></p></div></div></section><section id="_limitations"><h2>Limitations</h2><div class="slide-content"><div class="ulist"><ul><li><p>Context Maps can be challenging</p></li><li><p>When bounded contexts encompass multiple subdomains, there can be multiple integration patterns at play</p></li><li><p>Also,  if bounded contexts are limited to a single subdomain, there still can be multiple integration patterns at play</p></li><li><p>For example, if the subdomains’ modules require different integration strategies.</p></li></ul></div>
<div class="imageblock"><img src="./images/complicated_map.png" alt="complicated map"></div></div></section></section>
<section id="_lab_integrating_bounded_contexts"><h2>Lab: Integrating Bounded Contexts</h2></section>
<section id="_tactical"><h2>Tactical</h2></section>
<section><section id="_simple_business_logic_tactical"><h2>Simple Business Logic [Tactical]</h2></section><section id="_business_logic"><h2>Business Logic</h2><div class="slide-content"><div class="ulist"><ul><li><p>Business logic is the most important part of software</p></li><li><p>You can have the most amazing UI and fast database but if the software is not useful it is a failure</p></li><li><p>We will visit two simplic business logic patterns:</p><div class="ulist"><ul><li><p>Transaction Script</p></li><li><p>Active Record</p></li></ul></div></li></ul></div></div></section><section id="_transaction_script"><h2>Transaction Script</h2><div class="slide-content"><div class="ulist"><ul><li><p>Organizes business logic by procedures where each procedure handles a single request from the presentation</p></li><li><p>A system’s public interface can be seen as a collection of business transactions that consumers can execute</p></li><li><p>Transactions can retrieve information managed by the system, modify it, or both</p></li><li><p>Pattern organizes the system’s business logic based on procedures</p></li><li><p>Each procedure implements an operation that is executed by the system’s consumer via its public interface</p></li><li><p><strong>Public operations are used as encapsulation boundaries</strong></p></li></ul></div></div></section><section id="_example_of_public_transaction_script_interface"><h2>Example of Public Transaction Script Interface</h2><div class="slide-content"><div class="imageblock"><img src="./images/transaction_script_interface.png" alt="transaction script interface"></div></div></section><section id="_implementation_of_transaction_script"><h2>Implementation of Transaction Script</h2><div class="slide-content"><div class="ulist"><ul><li><p>Each procedure is implemented as a simple, straightforward procedural script</p></li><li><p>It can use a thin abstraction layer for integrating with storage mechanisms, but it is also free to access the databases directly</p></li><li><p><em>Each operation should either succeed or fail but can never result in an invalid state</em></p></li><li><p>During failure: System should remain consistent—either by rolling back any changes it has made up until the failure or by executing compensating actions</p></li></ul></div></div></section><section id="_example_of_transaction_script"><h2>Example of Transaction Script</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">db.startTransaction();

var job = db.loadNextJob();
var json = loadFile(job.source);
var xml = convertJsonToXml(json);
writeFile(job.Destination, xml.ToString();
dd.markJobAsCompleted(job);

dd.commit()</code></pre></div></div></div></section><section id="_three_cause_of_data_corruption_with_transaction_script"><h2>Three Cause of Data Corruption with Transaction Script</h2><div class="slide-content"><div class="ulist"><ul><li><p>There are three causes of data corruption with Transaction Script</p><div class="ulist"><ul><li><p>Lack of transactional behavior</p></li><li><p>Distributed transactions</p></li><li><p>Implicit distributed transactions</p></li></ul></div></li></ul></div></div></section><section id="_lack_of_transactional_behavior"><h2>Lack of Transactional Behavior</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class LogVisit {
    public void execute(Guid userId, DataTime visitedOn)
    {
        db.executeStatement("UPDATE Users SET last_visit= ? WHERE user_id= ?",
            visitedOn, userId);
        db.executeInsert("INSERT INTO VisitsLog(user_id, visit_date) VALUES(?, ?)", userId, visitedOn);
    }
}</code></pre></div></div></div></section><section id="_issues_of_not_including_transactions"><h2>Issues of Not including Transactions</h2><div class="slide-content"><div class="ulist"><ul><li><p>If any issue occurs after the record in the <code>Users</code> table was updated but before appending the log record on line succeeds, the system will end up in an inconsistent state.</p></li><li><p>The <code>Users</code> table will be updated but no corresponding record will be written to the <code>VisitsLog</code> table.</p></li><li><p>The issue can be due to anything from a network outage to a database timeout or deadlock, or even a crash of the server executing the process.</p></li></ul></div></div></section><section id="_including_transactions"><h2>Including Transactions</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class LogVisit {
    public void execute(Guid userId, DataTime visitedOn) {
        try
        {
            db.startTransaction();
            db.execute("UPDATE Users SET last_visit=? WHERE user_id=?",
                       visitedOn, userId);
            db.execute("INSERT INTO VisitsLog(user_id, visit_date) VALUES(?, ?)",
                       userId, visitedOn);
            db.commit();
        } catch {
            db.rollback();
            throw new RuntimeException("Transaction Unsuccessful");
        }
    }
}</code></pre></div></div></div></section><section id="_distributed_transactions"><h2>Distributed Transactions</h2><div class="slide-content"><div class="ulist"><ul><li><p>It’s a common practice to make changes to the data in a database and then notify other components of the system about the changes by publishing messages into a message bus.</p></li><li><p>Instead of logging a visit in a table, we have to publish it to a message bus or pub/sub</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class LogVisit {
     public void execute(Guid userId, DataTime visitedOn)
     {
         db.execute("UPDATE Users SET last_visit=? WHERE user_id=?",
                    visitedOn, userId);
         messageBus.Publish("VISITS_TOPIC",
                            new VisitRecord(userId, visitedOn));
     }
 }</code></pre></div></div></div></section><section id="_distributed_transaction_are_difficult"><h2>Distributed Transaction are difficult</h2><div class="slide-content"><div class="ulist"><ul><li><p>Distributed transactions spanning multiple storage mechanisms are complex, hard to scale, error prone, and therefore are usually avoided</p></li><li><p>Some Patterns to use:</p><div class="ulist"><ul><li><p>Outbox Pattern</p></li><li><p>CQRS (Command Query Responsibility Separation)</p></li></ul></div></li></ul></div></div></section><section id="_implicit_distributed_transactions"><h2>Implicit Distributed Transactions</h2><div class="slide-content"><div class="ulist"><ul><li><p>The following is an implicit transaction and can lead to inconsistent state</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class LogVisit {
    public void execute(Guid userId) {
        db.execute("UPDATE Users SET visits=visits+1 WHERE user_id=?",
                    userId);
    }
}</code></pre></div></div></li><li><p>It is a distributed transaction because it communicates information to the databases and the external process that called the method</p></li></ul></div>
<div class="imageblock"><img src="./images/implicit_transactions.png" alt="implicit transactions"></div></div></section><section id="_what_could_go_wrong"><h2>What could go wrong?</h2><div class="slide-content"><div class="imageblock"><img src="./images/implicit_transactions.png" alt="implicit transactions"></div>
<div class="ulist"><ul><li><p>Any of the above links/arrows can fail</p></li><li><p><code>LogVisit</code> is part of a REST service and there is a network outage</p></li><li><p>Both <code>LogVisit</code> and the caller are running in the same process, but the process fails before the caller gets to track successful execution of the <code>LogVisit</code> action</p></li><li><p>The consumer will assume failure and try calling LogVisit again.</p></li><li><p>Executing the <code>LogVisit</code> logic again will result in an incorrect increase of the counter’s value</p></li></ul></div></div></section><section id="_attempting_to_fix_the_issue_with_idempotency"><h2>Attempting to fix the issue with idempotency</h2><div class="slide-content"><div class="ulist"><ul><li><p>Make the call <em>idempotent</em>, no matter how many times it&#8217;s called, you get the same <em>effect</em></p></li><li><p>In the following attempt, we are submitting the execute method with the value that is required</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class LogVisit {
    public void execute(Guid userId, long visits)
    {
        db.execute("UPDATE Users SET visits = ? WHERE user_id=?",
                   visits, userId);
    }
}</code></pre></div></div></div></section><section id="_attempting_to_fix_the_issue_with_optimisitic_concurrency"><h2>Attempting to fix the issue with optimisitic concurrency</h2><div class="slide-content"><div class="ulist"><ul><li><p>Prior to calling the LogVisit operation, the caller has read the counter’s current value and passed it to <code>LogVisit</code> as a parameter.</p></li><li><p><code>LogVisit</code> will update the counter’s value only if it equals the one initially read by the caller</p></li><li><p>Known in Java, as <code>compareAndSet</code> (CAS)</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class LogVisit {
   public void execute(Guid userId, long expectedVisits) {
        db.execute("UPDATE Users SET visits=visits+1 WHERE user_id = ? and visits = ?",
                      userId, visits);
    }
}</code></pre></div></div></div></section><section id="_when_to_use_transaction_script"><h2>When to use Transaction Script</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">The transaction script pattern is well adapted for</dt><dd><div class="ulist"><ul><li><p>Business logic resembles simple procedural operations</p></li><li><p>Used as an adapter for integration with external systems—for example, generic subdomains, or as a part of an anticorruption layer</p></li></ul></div></dd><dt class="hdlist1">The transaction script pattern is not well adapted for</dt><dd><div class="ulist"><ul><li><p>Complexity- The more complex the business logic gets, the more it’s prone to duplicate business logic across transactions, and consequently, to result in inconsistent behavior</p></li><li><p>Core Subdomains - Won’t cope with the high complexity of a core subdomain’s business logic</p></li></ul></div></dd></dl></div></div></section><section id="_active_record"><h2>Active Record</h2><div class="slide-content"><div class="ulist"><ul><li><p>An object that wraps a row in a database table or view, encapsulates the database access, and adds domain logic on that data</p></li><li><p>Active record supports cases where the business logic is simple</p></li><li><p>Business logic may operate on more complex data structures which is different than transaction script</p></li><li><p>Active record also supports complicated trees and hierarchies</p></li><li><p>Doing something like the following diagram would make it so complicated for something like a transaction script which leads to repetitive code</p></li></ul></div></div></section><section id="_example_of_a_complex_active_record_structure"><h2>Example of a Complex Active Record Structure</h2><div class="slide-content"><div class="imageblock"><img src="./images/many_to_many.png" alt="many to many"></div></div></section><section id="_implmentation_of_active_record"><h2>Implmentation of Active Record</h2><div class="slide-content"><div class="ulist"><ul><li><p>Active Record uses dedicated objects, known as active records, to represent complicated data structures</p></li><li><p>Active Record objects also implement data access methods for creating, reading, updating, and deleting records—the so-called CRUD operations</p></li><li><p>Active record objects are coupled to an object-relational mapping (ORM) or some other data access framework</p></li></ul></div></div></section><section id="_example_of_active_record"><h2>Example of Active Record</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class CreateUser {
    public void execute(UserDetails userDetails) {
        try {
            db.startTransaction();
            var user = new User();
            user.setName(userDetails.getName());
            user.setEmail(userDetails.getEmail());
            user.save();
            db.commit();
        } catch {
            db.rollback();
            throw new RuntimeException("Unable to persist the Users");
        }
    }
}</code></pre></div></div></div></section><section id="_advantages_and_disadvantage_to_active_record"><h2>Advantages and Disadvantage to Active Record</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Advantage</dt><dd><div class="ulist"><ul><li><p>Active record is essentially a transaction script that optimizes access to databases</p></li><li><p>Can only support relatively simple business logic, such as CRUD operations, which, at most, validate the user’s input</p></li></ul></div></dd><dt class="hdlist1">Disadvantage</dt><dd><div class="ulist"><ul><li><p>It can potentially introduce more harm than good when applied in the wrong context</p></li><li><p>It can be considered an anti-pattern, since it mixes two concerns, domain and repository</p></li></ul></div></dd></dl></div></div></section></section>
<section id="_lab_simple_business_logic"><h2>Lab: Simple Business Logic</h2></section>
<section><section id="_complex_business_logic_tactical"><h2>Complex Business Logic [Tactical]</h2></section><section id="_history"><h2>History</h2><div class="slide-content"><div class="ulist"><ul><li><p>Transaction script and active record patterns, the domain model pattern was introduced initially in Martin Fowler’s book <em>Patterns of Enterprise Application Architecture</em></p></li><li><p>Fowler mentioned that “Eric Evans is currently writing a book on building Domain Models” referring to Domain Driven Design that we talk about today</p></li><li><p>Eric Evans talked about other patterns: Aggregates, Entities, Value Objects etc. This takes off from Martin Fowler left off.</p></li></ul></div></div></section><section id="_domain_model"><h2>Domain Model</h2><div class="slide-content"><div class="ulist"><ul><li><p>The domain model pattern is intended to cope with cases of complex business logic.</p></li><li><p>Instead of CRUD, we deal with complex state transitions, business rules, and invariants</p></li></ul></div></div></section><section id="_example_complexity"><h2>Example Complexity</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Customers open support tickets describing issues they are facing.</p></li><li><p>Both the customer and the support agent append messages, and all the correspondence is tracked by the support ticket.</p></li><li><p>Each ticket has a priority: low, medium, high, or urgent.</p></li><li><p>An agent should offer a solution within a set time limit (SLA) that is based on the ticket’s priority</p></li><li><p>If the agent doesn’t reply within the SLA, the customer can escalate the ticket to the agent’s manager.</p></li><li><p>Escalation reduces the agent’s response time limit by 33%.</p></li></ol></div></div></section><section id="_example_complexity_2"><h2>Example Complexity</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic" start="7"><li><p>If the agent didn’t open an escalated ticket within 50% of the response time limit, it is automatically reassigned to a different agent.</p></li><li><p>Tickets are automatically closed if the customer doesn’t reply to the agent’s questions within seven days.</p></li><li><p>Escalated tickets cannot be closed automatically or by the agent, only by the customer or the agent’s manager.</p></li><li><p>A customer can reopen a closed ticket only if it was closed in the past seven days.</p></li></ol></div></div></section><section id="_review_the_list"><h2>Review the list</h2><div class="slide-content"><div class="ulist"><ul><li><p>We see that there is a complex list of invariants</p></li><li><p>Using Active Records will make this unwieldly and include many duplicates</p></li></ul></div></div></section><section id="_implementation_of_the_domain_model"><h2>Implementation of the Domain Model</h2><div class="slide-content"><div class="ulist"><ul><li><p>A domain model is an object model of the domain that incorporates both behavior and data</p></li><li><p>DDD’s tactical patterns — aggregates, value objects, domain events, and domain services— are the building blocks of such an object model.</p></li><li><p>All of these patterns share a common theme: they put the business logic first</p></li></ul></div></div></section><section id="_dont_add_more_complexity"><h2>Don&#8217;t Add More Complexity</h2><div class="slide-content"><div class="ulist"><ul><li><p>The Domain Objects are already going to model a business process that&#8217;s already complex, so it shouldn&#8217;t introduce more complexity</p></li><li><p>When defining the domain: <strong>The model should be devoid of any infrastructural or technological concerns, such as implementing calls to databases or other external components of the system. They should not incorporate frameworks or infrastructure</strong></p></li><li><p>They should be <em>Plain Old Objects</em></p></li></ul></div></div></section><section id="_ubiquitous_language_2"><h2>Ubiquitous Language</h2><div class="slide-content"><div class="ulist"><ul><li><p>It is important to <strong>follow the terminology of the bounded context’s ubiquitous language</strong></p></li><li><p>Domain Model allows the code to “speak” the ubiquitous language and to follow the domain experts’ mental models</p></li></ul></div></div></section><section id="_value_objects"><h2>Value Objects</h2><div class="slide-content"><div class="ulist"><ul><li><p>A value object is an object that can be identified by the composition of its values</p></li><li><p>No identifier is necessary, like <code>id = 10</code> which would lead to confusion</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Color {
    private int red;
    private int green;
    private int blue;
}</code></pre></div></div></div></section><section id="_identifiers_doesnt_go_into_value_objects"><h2>Identifiers doesn&#8217;t go into Value Objects</h2><div class="slide-content"><div class="ulist"><ul><li><p>Note that because identifier were introduced: <code>3</code>, and <code>4</code> are the same color</p></li><li><p>This would not be considered a value object</p></li></ul></div>
<div class="imageblock"><img src="./images/no_identifiers.png" alt="no identifiers"></div></div></section><section id="_value_objects_as_java_records"><h2>Value Objects as Java Records</h2><div class="slide-content"><div class="ulist"><ul><li><p>In Java, value objects can be simple one-liners.</p></li><li><p>They are immutable, and readily have <code>toString</code>, <code>equals</code>, <code>hashCode</code></p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public record Color(int red, int green, int blue) {}</code></pre></div></div></div></section><section id="_primitive_obsession"><h2>Primitive Obsession</h2><div class="slide-content"><div class="paragraph"><p>Relying exclusively on the language’s standard library’s primitive data types—such as strings, integers, lists, or dictionaries — to represent concepts of the business domain is known as the primitive obsession code smell</p></div></div></section><section id="_example_primitive_obsession_code_smell"><h2>Example Primitive Obsession Code Smell</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">class Person {
    private int    id;
    private String firstName;
    private String lastName;
    private String landlinePhone;
    private String mobilePhone;
    private String email;
    private int    heightMetric;
    private String countryCode;

    public Person(...) {...}
}</code></pre></div></div></div></section><section id="_whats_wrong_with_primitive_obsession"><h2>What&#8217;s wrong with primitive obsession?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consider <code>landLine</code> and <code>countryCode</code>, what are the valid numbers?</p></li><li><p>How are you protecting those values?</p></li><li><p>If there are multiple phone number types each validation may be duplicated.</p></li></ul></div></div></section><section id="_without_primitive_obsession"><h2>Without Primitive Obsession</h2><div class="slide-content"><div class="ulist"><ul><li><p>The benefit is that any validation is done at the value object level</p></li><li><p>Another benefit is that any method that is related belongs to the value object</p></li><li><p>It adheres to the ubiquitous language</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">class Person {
    private PersonId     id;
    private Name         name;
    private PhoneNumber  landline;
    private PhoneNumber  mobile;
    private EmailAddress email;
    private Height       height;
    private CountryCode  country;

    public Person(...) { ... }
}</code></pre></div></div></div></section><section id="_value_objects_creates_rich_intuitive_methods"><h2>Value Objects creates Rich Intuitive Methods</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">var heightMetric = Height.metric(180);
var heightImperial = Height.imperial(5, 3);

var string1 = heightMetric.toString()               // "180cm"
var string2 = heightImperial.toString();            // "5 feet 3 inches"
var string3 = heightMetric.toImperial().toString(); // "5 feet 11 inches"

var firstIsHigher = heightMetric.isGreaterThan(heightImperial); // true</code></pre></div></div></div></section><section id="_value_object_as_mixing_colors"><h2>Value Object as Mixing Colors</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">var red = Color.fromRGB(255, 0, 0);
var green = Color.Green;
var yellow = red.mixWith(green);
var yellowString = yellow.toString();</code></pre></div></div></div></section><section id="_implementation_and_immutability"><h2>Implementation and Immutability</h2><div class="slide-content"><div class="ulist"><ul><li><p>Value objects are <em>immutable</em></p></li><li><p>When a change is made to a value object, it typically should return <em>another object</em> with that change</p></li></ul></div></div></section><section id="_example_of_immutability_with_color"><h2>Example of Immutability with Color</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public record Color(int red, int green, int blue) {
    public Color {
        // Validate the input
    }

    public Color mixedWith(Color other) {
        return new Color(
            Math.min(this.red + other.red, 255),
            Math.min(this.green + other.green, 255),
            Math.min(this.blue + other.blue, 255)
        );
    }
}</code></pre></div></div></div></section><section id="_when_to_use_value_objects"><h2>When to use Value Objects</h2><div class="slide-content"><div class="ulist"><ul><li><p>Whenever you can</p></li><li><p>Benefit is that they are free of side-effects and are thread safe</p></li><li><p>Consider value objects for the domain’s elements that describe properties of other objects</p></li><li><p>Consider value objects for <code>firstName</code>, <code>lastName</code>, <code>expirationDate</code>, passwords, temperature, and (especially) money</p></li><li><p>Look for libraries that have that pre-developed, for example the <a href="https://github.com/typelevel/squants" target="_blank">Squants project</a> in Scala</p></li></ul></div></div></section><section id="_language_are_optimizing_for_value_objects"><h2>Language are optimizing for value objects</h2><div class="slide-content"><div class="ulist"><ul><li><p>Language have or planning to optimize for having and using value objects</p></li><li><p>Consider some of the advancements <a href="https://openjdk.org/jeps/8277163" target="_blank">planned for Java</a></p></li></ul></div></div></section><section id="_entities"><h2>Entities</h2><div class="slide-content"><div class="ulist"><ul><li><p>An entity is the opposite of a value object.</p></li><li><p>It requires an explicit identification field to distinguish between the different instances of the entity.</p></li></ul></div></div></section><section id="_values_objects_dont_have_identity"><h2>Values Objects don&#8217;t have identity</h2><div class="slide-content"><div class="ulist"><ul><li><p>In the following example, this is just a standard value object containing another value object</p></li><li><p>As we all know people can have the same name, so how do we distinguish between two of these objects?</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Person {
    private Name name;
    public Person(Name name) {
        this.name = name;
    }
}</code></pre></div></div></li></ul></div></div></section><section id="_adding_an_identity"><h2>Adding an identity</h2><div class="slide-content"><div class="ulist"><ul><li><p>To distinguish between people we need an identifier: <code>EmployeeID</code>, <code>SocialSecurityNumber</code>, etc.</p></li><li><p>The identifier field should be immutable since a person&#8217;s identifier should remain constant, eventhough their name can change</p></li><li><p>Identifiers must be unique</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Person {
    private final PersonId id;
    private Name name;
    public Person(PersonId id, Name name) {
        this.name = name;
    }
}</code></pre></div></div></div></section><section id="_example_of_two_distinct_people"><h2>Example of two distinct people</h2><div class="slide-content"><div class="imageblock"><img src="./images/explicit_id.png" alt="explicit id"></div></div></section><section id="_entities_are_not_immutable"><h2>Entities are not immutable</h2><div class="slide-content"><div class="ulist"><ul><li><p>Entities are not immutable, they are expected to change</p></li><li><p>The value objects that constitute the entities are immutable</p></li><li><p>Entities are not formally a part of the domain model, because they are building block for creating <em>aggregates</em></p></li></ul></div></div></section><section id="_aggregates"><h2>Aggregates</h2><div class="slide-content"><div class="ulist"><ul><li><p>Aggregates are entities</p></li><li><p>It requires explicit identification</p></li><li><p>Draws a clear boundary between aggregate and it&#8217;s outer scope</p></li><li><p>Aggregate’s logic has to validate all incoming modifications and ensure that the changes do not contradict its business rules</p></li></ul></div></div></section><section id="_aggregates_protect_the_data"><h2>Aggregates protect the data</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consistency of the data is enforced by the aggregate</p></li><li><p>Processes or objects external to the aggregate are only allowed to read the aggregate’s state</p></li><li><p>State can only be mutated by executing corresponding methods of the aggregate’s public interface</p></li></ul></div></div></section><section id="_commanding_the_aggregate"><h2>Commanding the Aggregate</h2><div class="slide-content"><div class="ulist"><ul><li><p>State modifying methods exposed as the aggregate&#8217;s public interface are referred to as <em>commands</em></p></li><li><p>You can implement commands by:</p><div class="ulist"><ul><li><p>Using a public method</p></li><li><p>As a parameter object</p></li><li><p>Using the command pattern</p></li></ul></div></li></ul></div></div></section><section id="_using_a_public_method"><h2>Using a public method</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Ticket
{
    public void addMessage(UserId from, String body)
    {
        var message = new Message(from, body);
        this.messages.append(message);
    }
}</code></pre></div></div></div></section><section id="_using_it_as_a_parameter_object"><h2>Using it as a parameter object</h2><div class="slide-content"><div class="ulist"><ul><li><p>A parameter object is a collection of other attributes</p></li><li><p>This is used to keep parameters nice and light</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Ticket
{
    public void execute(AddMessage cmd)
    {
        var message = new Message(cmd.from, cmd.body);
        _messages.append(message);
    }
}</code></pre></div></div></div></section><section id="_using_the_command_pattern"><h2>Using the Command Pattern</h2><div class="slide-content"><div class="ulist"><ul><li><p>Command Pattern is from the classic <a href="https://martinfowler.com/bliki/GangOfFour.html" target="_blank">Gang of Four</a> design pattern</p></li><li><p>This allows for flexible use of commands where those commands are in a hash table</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Ticket {
    private HashSet&lt;Action, Command&gt; table;

    public void execute(Action action) {
        Optional.fromNullable(table.get(action))
                .ifPresentOrElse(a -&gt; a.perform(),
                                 () -&gt; throw new RuntimeException(...));
    }
}</code></pre></div></div></div></section><section id="_enforcement_of_aggregates"><h2>Enforcement of Aggregates</h2><div class="slide-content"><div class="ulist"><ul><li><p>An aggregate’s public interface is responsible for validating the input and enforcing all of the relevant business rules and invariants</p></li><li><p>Strict boundary also ensures that all business logic related to the aggregate is implemented in one place: the aggregate itself</p></li></ul></div></div></section><section id="_integration_with_the_application_layer"><h2>Integration with the application layer</h2><div class="slide-content"><div class="ulist"><ul><li><p>Integrating aggregates can then be done in the <em>application layer</em></p></li><li><p>In the following example, a repository represents the storage facility</p></li><li><p>The consistency of the aggregate must be protected, transactionally, and concurrently</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public ExecutionResult Escalate(TicketId id, EscalationReason reason) {
  try {
      var ticket = ticketRepository.load(id);
      var cmd = new Escalate(reason);
      ticket.execute(cmd);
      ticketRepository.save(ticket);
      return ExecutionResult.Success();
  } catch (TransactionException ex) {
      return ExecutionResult.Error(ex);
  }
}</code></pre></div></div></div></section><section id="_compare_and_set_database_versions_for_consistency"><h2>Compare and Set Database Versions for consistency</h2><div class="slide-content"><div class="ulist"><ul><li><p>When using databases consider using versions for consistency</p></li><li><p>Multiple processes are concurrently updating the same aggregate, we have to prevent the latter transaction from overwriting the changes committed by the first one</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">class Ticket {
    TicketId id;
    int      version; //Database version
}</code></pre></div></div></li><li><p>Integrating the a SQL style database</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-sql hljs" data-noescape="true" data-lang="sql">UPDATE tickets
SET ticket_status = ?,
agg_version = agg_version + 1
WHERE ticket_id=? and agg_version=?;</code></pre></div></div></li></ul></div></div></section><section id="_transaction_boundary"><h2>Transaction Boundary</h2><div class="slide-content"><div class="ulist"><ul><li><p>The aggregate also acts as a transactional boundary</p></li><li><p>Aggregate’s state can only be modified by its own business logic, the aggregate also acts as a transactional boundary</p></li><li><p>All changes to the aggregate’s state should be committed transactionally as one atomic operation</p></li><li><p>If an aggregate’s state is modified, either all the changes are committed or none of them is</p></li></ul></div></div></section><section id="_no_multi_aggregate_transactions"><h2>No multi-aggregate transactions</h2><div class="slide-content"><div class="ulist"><ul><li><p>No system operation can assume a multi-aggregate transaction.</p></li><li><p>A change to an aggregate’s state can only be committed individually, one aggregate per database transaction.</p></li></ul></div></div></section><section id="_what_if_we_need_to_handle_multiple_entities"><h2>What if we need to handle multiple entities?</h2><div class="slide-content"><div class="ulist"><ul><li><p>The one aggregate instance per transaction forces us to carefully design an aggregate’s boundaries, ensuring that the design addresses the business domain’s invariants and rules.</p></li><li><p>The need to commit changes in multiple aggregates signals a wrong transaction boundary, and hence, wrong aggregate boundaries.</p></li><li><p>What if we need to modify multiple objects in the same transaction?</p></li></ul></div></div></section><section id="_hierarchy_of_entities"><h2>Hierarchy of Entities</h2><div class="slide-content"><div class="ulist"><ul><li><p>DDD prescribes that a system’s design should be driven by its business domain</p></li><li><p>To support changes to multiple objects that have to be applied in one atomic transaction, the aggregate pattern resembles a hierarchy of entities, all sharing transactional consistency</p></li></ul></div>
<div class="imageblock"><img src="./images/aggregate.png" alt="aggregate" width="40%" height="40%"></div>
<div class="ulist"><ul><li><p>The hierarchy contains both entities and value objects, and all of them belong to the same aggregate if they are bound by the domain’s business logic</p></li></ul></div></div></section><section id="_example_of_hierarchy_of_entities"><h2>Example of Hierarchy of Entities</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Ticket {
    private List&lt;Message&gt; messages;

    public void execute(evaluateAutomaticActions cmd) {
        if (this.isEscalated &amp;&amp; this.remainingTimePercentage &lt; 0.5 &amp;&amp;
            getUnreadMessagesCount(assignedAgent) &gt; 0) {
            agent = AssignNewAgent();
        }
    }

    public int getUnreadMessagesCount(UserId id) {
        return messages.filter(x -&gt; x.to == id &amp;&amp; !x.wasRead).toList().size();
    }
}</code></pre></div></div></div></section><section id="_example_of_hierarchy_of_entities_2"><h2>Example of Hierarchy of Entities</h2><div class="slide-content"><div class="ulist"><ul><li><p>The method in the previous slide, checks the ticket’s values to see whether it is escalated and whether the remaining processing time is less than the defined threshold of 50%</p></li><li><p>It checks for messages that were not yet read by the current agent</p></li><li><p>If all conditions are met, the ticket is requested to be reassigned to a different agent</p></li><li><p>The aggregate ensures that all the conditions are checked against strongly consistent data</p></li></ul></div></div></section><section id="_referencing_other_aggregates"><h2>Referencing other aggregates</h2><div class="slide-content"><div class="ulist"><ul><li><p>Since all objects contained by an aggregate share the same transactional boundary, performance and scalability issues may arise if an aggregate grows too large.</p></li><li><p>The consistency of the data can be a convenient guiding principle for designing an aggregate’s boundaries.</p></li><li><p><strong>Only the information that is required by the aggregate’s business logic to be strongly consistent should be a part of the aggregate</strong></p></li></ul></div></div></section><section id="_aggregate_as_consistency_boundary"><h2>Aggregate as Consistency Boundary</h2><div class="slide-content"><div class="imageblock"><img src="./images/aggregate_consistency.png" alt="aggregate consistency"></div></div></section><section id="_keep_aggregates_small"><h2>Keep Aggregates Small</h2><div class="slide-content"><div class="ulist"><ul><li><p>Keep the aggregates as small as possible and include only objects that are required to be in a strongly consistent state by the aggregate’s business logic</p></li><li><p>In the following code example, notice that we are not interested in the entire <code>Product</code> nor the entire <code>User</code>, just their identifiers (entities)</p><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Ticket {
    private UserId          customer;
    private List&lt;ProductId&gt; products;
    private UserId          assignedAgent;
    private List&lt;Message&gt;   messages;
}</code></pre></div></div></li><li><p><strong>Reasoning behind referencing external aggregates by ID is to reify that these objects do not belong to the aggregate’s boundary, and to ensure that each aggregate has its own transactional boundary.</strong></p></li></ul></div></div></section><section id="_deciding_what_to_aggregate"><h2>Deciding What to Aggregate</h2><div class="slide-content"><div class="paragraph"><p>To decide whether an entity belongs to an aggregate or not, examine whether the aggregate contains business logic that can lead to an invalid system state if <em>it will work on eventually consistent data</em></p></div>
<div class="imageblock"><img src="./images/aggregate_consistency.png" alt="aggregate consistency"></div></div></section><section id="_aggregate_root"><h2>Aggregate Root</h2><div class="slide-content"><div class="ulist"><ul><li><p>An aggregate’s state can only be modified by executing one of its commands.</p></li><li><p>Since an aggregate represents a hierarchy of entities, only one of them should be designated as the aggregate’s public interface—<em>the aggregate root</em></p></li></ul></div>
<div class="imageblock"><img src="./images/aggregate_root.png" alt="aggregate root"></div></div></section><section id="_example_of_an_aggregate_root"><h2>Example of an Aggregate Root</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Ticket {
   private List&lt;Message&gt; _messages;

   public void execute(AcknowledgeMessage cmd) {
      var message =
        messages.stream().filter(x -&gt; x.id == cmd.id)
        .findFirst().ifPresent(m -&gt; m.wasRead = true);
   }
}</code></pre></div></div></div></section><section id="_domain_events"><h2>Domain Events</h2><div class="slide-content"><div class="ulist"><ul><li><p>A domain event is a message describing a significant event that has occurred in the business domain, for example:</p><div class="ulist"><ul><li><p>Ticket assigned</p></li><li><p>Ticket escalated</p></li><li><p>Message received</p></li></ul></div></li><li><p>Domain events are <em>past tense</em></p></li></ul></div></div></section><section id="_domain_event_example"><h2>Domain Event Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
    "ticket-id": "c9d286ff-3bca-4f57-94d4-4d4e490867d1",
    "event-id": 146,
    "event-type": "ticket-escalated",
    "escalation-reason": "missed-sla",
    "escalation-time": 1628970815
}</code></pre></div></div>
<div class="admonitionblock caution"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Ensure that domain events succinctly reflect exactly what has happened in the business domain</td></tr></table></div></div></section><section id="_domain_events_public_interface"><h2>Domain Events Public Interface</h2><div class="slide-content"><div class="ulist"><ul><li><p>Domain Events are part of the aggregate&#8217;s public interface</p></li><li><p>An aggregate publishes its domain events</p></li><li><p>Other processes, aggregates, or even external systems can subscribe to and execute their own logic in response to the domain events</p></li></ul></div>
<div class="imageblock"><img src="./images/domain_event_interface.png" alt="domain event interface"></div></div></section><section id="_domain_event_example_2"><h2>Domain Event Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Ticket {
    private List&lt;DomainEvent&gt; domainEvents;

    public void execute(RequestEscalation cmd)
    {
        if (!this.isEscalated &amp;&amp; this.remainingTimePercentage &lt;= 0) {
            this.isEscalated = true;
            var escalatedEvent = new TicketEscalated(id, cmd.Reason);
            domainEvents.append(escalatedEvent);
        }
    }
}</code></pre></div></div>
<div class="admonitionblock note"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">We will see how we can use communication software to manage those events</td></tr></table></div></div></section><section id="_aggregates_must_reflect_the_ubiquitous_language"><h2>Aggregates must reflect the ubiquitous language</h2><div class="slide-content"><div class="ulist"><ul><li><p>Aggregates should reflect the ubiquitous language.</p></li><li><p>The terminology that is used for the aggregate’s name, its data members, its actions, and its domain events all should be formulated in the bounded context’s ubiquitous language.</p></li><li><p>As Eric Evans put it, the code must be based on the same language the developers use when they speak with one another and with domain experts. This is especially important for implementing complex business logic</p></li></ul></div></div></section><section id="_domain_services"><h2>Domain Services</h2><div class="slide-content"><div class="ulist"><ul><li><p>Business logic that doesn’t belong to any aggregate or value object, or that seems to be relevant to multiple aggregates</p></li><li><p>Stateless object that orchestrates calls to various components of the system to perform some calculation or analysis</p></li></ul></div></div></section><section id="_domain_service_example"><h2>Domain Service Example</h2><div class="slide-content"><div class="paragraph"><p>In the following example, calculation logic requires information from multiple sources</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class ResponseTimeFrameCalculationService {
    public ResponseTimeframe calculateAgentResponseDeadline(UserId agentId,
        Priority priority, bool escalated, DateTime startTime) {
        var policy = departmentRepository.getDepartmentPolicy(agentId); <i class="conum" data-value="1"></i><b>(1)</b>
        var maxProcTime = policy.getMaxResponseTimeFor(priority); <i class="conum" data-value="2"></i><b>(2)</b>
        if (escalated) {
            maxProcTime = maxProcTime * policy.escalationFactor;
        }
        var shifts = departmentRepository.getUpcomingShifts(agentId,
            startTime, startTime.Add(policy.MaxAgentResponseTime)); <i class="conum" data-value="1"></i><b>(1)</b>
        return CalculateTargetTime(maxProcTime, shifts);
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>The assigned agent’s department</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>The policy calculator</td></tr></table></div></div></section><section id="_domain_services_are_not_microservice"><h2>Domain Services are not Microservice</h2><div class="slide-content"><div class="ulist"><ul><li><p>Domain services have nothing to do with microservices, service-oriented architecture, or almost any other use of the word service in software engineering.</p></li><li><p>It is just a stateless object used to host business logic.</p></li></ul></div></div></section><section id="_factories"><h2>Factories</h2><div class="slide-content"><div class="paragraph"><p>An object or method that implements object creation logic that’s too complex to be done directly by a constructor. It can also hide the concrete classes that are instantiated. A factory might be implemented as a static method of a class.</p></div></div></section><section id="_repositories"><h2>Repositories</h2><div class="slide-content"><div class="paragraph"><p>An object that provides access to persistent entities and encapsulates the mechanism for accessing the database.</p></div></div></section></section>
<section id="_lab_complex_business_logic"><h2>Lab: Complex Business Logic</h2></section>
<section><section id="_modeling_time_tactical"><h2>Modeling Time [Tactical]</h2></section><section id="_analyzing_tabular_data"><h2>Analyzing Tabular Data</h2><div class="slide-content"><div class="ulist"><ul><li><p>One can analyze data and get a feel for any process by looking at a table</p></li><li><p>Table representations only capture one moment in time, not the data that lead up to it</p></li><li><p>For example, your checking account. You know your balance, but how did it get there?</p></li></ul></div></div></section><section id="_view_the_data"><h2>View the Data</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:12.5%"><col style="width:12.5%"><col style="width:12.5%"><col style="width:12.5%"><col style="width:12.5%"><col style="width:12.5%"><col style="width:12.5%"><col style="width:12.5%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">lead-id</th><th class="tableblock halign-left valign-top">first-name</th><th class="tableblock halign-left valign-top">last-name</th><th class="tableblock halign-left valign-top">status</th><th class="tableblock halign-left valign-top">phone-number</th><th class="tableblock halign-left valign-top">followup-on</th><th class="tableblock halign-left valign-top">created-on</th><th class="tableblock halign-left valign-top">updated-on</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sean</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Callahan</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>CONVERTED</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>555-1246</code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-01-31T10:02:40.32Z</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-01-31T10:02:40.32Z</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sarah</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Estrada</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEW_LEAD</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>555-4395</code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-03-29T22:01:41.44Z</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-03-29T22:01:41.44Z</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stephanie</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Brown</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLOSED</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>555-1176</code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-04-15T23:08:45.59Z</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-04-15T23:08:45.59Z</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sami</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Calhoun</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>PENDING_PAYMENT</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>555-1850</code></p></td><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-04-25T05:42:17.07Z</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-04-25T05:42:17.07Z</code></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sian</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>Espinoza</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>FOLLOWUP_SET</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>555-6461</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-12-04T01:49:08.05Z</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-12-04T01:49:08.05Z</code></p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><code>2019-12-04T01:49:08.05Z</code></p></td></tr></table></div></section><section id="_what_we_understood"><h2>What we understood</h2><div class="slide-content"><div class="ulist"><ul><li><p>The sales flow starts with the potential customer in the <code>NEW_LEAD</code> status.</p></li><li><p>A sales call can end with the person not being interested in the offer (the lead is <code>CLOSED</code>), scheduling a follow-up call (<code>FOLLOWUP_SET</code>), or accepting the offer (<code>PENDING_PAYMENT</code>).</p></li><li><p>If the payment is successful, the lead is <code>CONVERTED</code> into a customer. Conversely, the payment can fail—<code>PAYMENT_FAILED</code></p></li></ul></div></div></section><section id="_missing_information"><h2>Missing Information</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Since we don&#8217;t have the information that lead to this point, we might be missing valuable information!</dt><dd><div class="ulist"><ul><li><p>Was there a purchase made right away?</p></li><li><p>Was there a lengthy sales journey?</p></li><li><p>Is it worth trying to contact a person after multiple follow-ups, or is it more efficient to close the lead and move to a more promising prospect?</p></li><li><p>None of that information is there. All we know are the leads’ current states.</p></li></ul></div></dd></dl></div></div></section><section id="_event_sourcing"><h2>Event Sourcing</h2><div class="slide-content"><div class="ulist"><ul><li><p>The event sourcing pattern introduces the dimension of time into the data model.</p></li><li><p>Instead of the schema reflecting the aggregates’ current state, an event sourcing–based system persists events documenting every change in an aggregate’s lifecycle</p></li></ul></div></div></section><section id="_viewing_the_history"><h2>Viewing the History</h2><div class="slide-content"><div class="ulist"><ul><li><p>Note that all the data are of the same <code>lead-id</code></p></li><li><p>We can build a history of how we got to our current point, review this and build a mental picture of it&#8217;s history</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
    "lead-id": 12,
    "event-id": 0,
    "event-type": "lead-initialized",
    "first-name": "Casey",
    "last-name": "David",
    "phone-number": "555-2951",
    "timestamp": "2020-05-20T09:52:55.95Z"
},
{
    "lead-id": 12,
    "event-id": 1,
    "event-type": "contacted",
    "timestamp": "2020-05-20T12:32:08.24Z"
},
{
    "lead-id": 12,
    "event-id": 2,
    "event-type": "followup-set",
    "followup-on": "2020-05-27T12:00:00.00Z",
    "timestamp": "2020-05-20T12:32:08.24Z"
},
{
    "lead-id": 12,
    "event-id": 3,
    "event-type": "contact-details-updated",
    "first-name": "Casey",
    "last-name": "Davis",
    "phone-number": "555-8101",
    "timestamp": "2020-05-20T12:32:08.24Z"
},
{
    "lead-id": 12,
    "event-id": 4,
    "event-type": "contacted",
    "timestamp": "2020-05-27T12:02:12.51Z"
},
{
    "lead-id": 12,
    "event-id": 5,
    "event-type": "order-submitted",
    "payment-deadline": "2020-05-30T12:02:12.51Z",
    "timestamp": "2020-05-27T12:02:12.51Z"
},
{
    "lead-id": 12,
    "event-id": 6,
    "event-type": "payment-confirmed",
    "status": "converted",
    "timestamp": "2020-05-27T12:38:44.12Z"
}</code></pre></div></div></div></section><section id="_projecting_from_the_events"><h2>Projecting from the events</h2><div class="slide-content"><div class="ulist"><ul><li><p>Aggregating from the Domain events can be projected</p></li><li><p>That can be done by applying all the events in one construct</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class LeadModelProjection {
    private long leadId;
    private String firstNames;
    private String lastNames;
    private PhoneNumber phoneNumber;
    private int version;

    public void apply(LeadInitialized event) {
        leadId = event.leadId;
        firstName = event.firstName;
        lastName = event.lastName;
        phoneNumber = event.PhoneNumber;
        version = 0;
    }

    public void apply(ContactDetailsChanged event) {
        firstName = event.firstName;
        lastName = event.lastName;
        phoneNumber = event.PhoneNumber;
        version += 1;
    }

    public void apply(Contacted event) {
        version += 1;
    }

    public void apply(FollowupSet event) {
        version += 1;
    }

    public void apply(OrderSubmitted event) {
        version += 1;
    }

    public void apply(PaymentConfirmed event) {
        version += 1;
    }
}</code></pre></div></div></div></section><section id="_searching_and_aggregating"><h2>Searching and Aggregating</h2><div class="slide-content"><div class="paragraph"><p>We can take the above and reaggregate by collecting the different values over time, for example knowing previous phone numbers would be useful</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class LeadSearchModelProjection {
    private long leadId;
    private HashSet&lt;String&gt; firstNames;
    private HashSet&lt;String&gt; lastNames;
    private HashSet&lt;PhoneNumber&gt; phoneNumbers;
    private int version;

    public void apply(LeadInitialized event) {
        leadId = event.LeadId;
        firstNames = new HashSet&lt;String&gt;();
        lastNames = new HashSet&lt;String&gt;();
        phoneNumbers = new HashSet&lt;PhoneNumber&gt;();
        firstNames.add(event.firstName);
        lastNames.add(event.lastName);
        phoneNumbers.add(event.PhoneNumber);
        version = 0;
    }

    public void apply(ContactDetailsChanged event) {
        firstNames.add(event.firstName);
        lastNames.add(event.lastName);
        phoneNumbers.add(event.phoneNumber);
        version += 1;
    }

    public void apply(Contacted event) {
        version += 1;
    }

    public void apply(FollowupSet event) {
        version += 1;
    }

    public void apply(OrderSubmitted event) {
        version += 1;
    }

    public void apply(PaymentConfirmed event) {
        version += 1;
    }
}</code></pre></div></div></div></section><section id="_analysis"><h2>Analysis</h2><div class="slide-content"><div class="ulist"><ul><li><p>Projects over events can also provide analysis over time</p></li><li><p>You may want to get the number of follow-up calls scheduled for different leads.</p></li><li><p>Later they will filter the converted and closed leads data and use the model to optimize the sales process.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class AnalysisModelProjection {
    private long leadId;
    private int followups;
    private LeadStatus status;
    private int version;

    public void apply(LeadInitialized event) {
        leadId = event.leadId;
        followups = 0;
        status = LeadStatus.NEW_LEAD;
        version = 0;
    }

    public void apply(Contacted event) {
        version += 1;
    }

    public void apply(FollowupSet event) {
        status = LeadStatus.FOLLOWUP_SET;
        followups += 1;
        version += 1;
    }

    public void apply(ContactDetailsChanged event) {
        version += 1;
    }

    public void apply(OrderSubmitted event) {
        status = LeadStatus.PENDING_PAYMENT;
        version += 1;
    }

    public void apply(PaymentConfirmed event) {
        status = LeadStatus.CONVERTED;
        version += 1;
    }
}</code></pre></div></div></div></section><section id="_source_of_truth"><h2>Source of Truth</h2><div class="slide-content"><div class="ulist"><ul><li><p>For event sourcing pattern to work, all changes to an object’s state should be represented and persisted as events</p></li><li><p>The database that stores the system’s events is the only strongly consistent storage: the system’s source of truth.</p></li><li><p>The accepted name for the database that is used for persisting events is event store</p></li></ul></div>
<div class="imageblock"><img src="./images/source_truth.png" alt="source truth"></div></div></section><section id="_event_store"><h2>Event Store</h2><div class="slide-content"><div class="ulist"><ul><li><p>The event store should not allow modifying or deleting the events since it’s append-only storage.</p></li><li><p>To support implementation of the event sourcing pattern, at a minimum the event store has to support the following functionality:</p><div class="ulist"><ul><li><p>Fetch all events belonging to a specific business entity</p></li><li><p>Append the events.</p></li></ul></div></li></ul></div></div></section><section id="_event_store_interface"><h2>Event Store <code>interface</code></h2><div class="slide-content"><div class="paragraph"><p><code>append</code> method is needed to implement optimistic concurrency management: when you append new events, you also specify the version of the entity on which you are basing your decisions</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">interface EventStore {
    List&lt;Event&gt; fetch(Guid instanceId);
    void append(Guid instanceId, Event[] newEvents, int expectedVersion);
}</code></pre></div></div></div></section><section id="_event_sourced_domain_model"><h2>Event Sourced Domain Model</h2><div class="slide-content"><div class="ulist"><ul><li><p>Original domain model maintains a state representation of its aggregates and emits select domain events</p></li><li><p>The event-sourced domain model uses domain events exclusively for modeling the aggregates’ lifecycles.</p></li><li><p>All changes to an aggregate’s state have to be expressed as domain events.</p></li></ul></div></div></section><section id="_event_model_script"><h2>Event Model Script</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Each operation on an event-sourced aggregate follows this script</dt><dd><div class="ulist"><ul><li><p>Load the aggregate’s domain events.</p></li><li><p>Reconstitute a state representation—project the events into a state representation that can be used to make business decisions.</p></li><li><p>Execute the aggregate’s command to execute the business logic, and consequently, produce new domain events.</p></li><li><p>Commit the new domain events to the event store.</p></li></ul></div></dd></dl></div></div></section><section id="_event_sourced_ticket"><h2>Event Sourced <code>Ticket</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class TicketAPI {
    private TicketsRepository ticketsRepository;

    public void requestEscalation(TicketId id, EscalationReason reason) {
        var events = ticketsRepository.loadEvents(id); <i class="conum" data-value="1"></i><b>(1)</b>
        var ticket = new Ticket(events);
        var originalVersion = ticket.version;
        var cmd = new RequestEscalation(reason); <i class="conum" data-value="2"></i><b>(2)</b>
        ticket.execute(cmd);
        ticketsRepository.commitChanges(ticket, originalVersion); <i class="conum" data-value="3"></i><b>(3)</b>
    }
}</code></pre></div></div>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Load events from data store</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Create a new event</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Commit changes assuming the previous version stayed the same</td></tr></table></div></div></section><section id="_advantages"><h2>Advantages</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Time Traveling - Event sourcing reconstitutes an aggregate’s current state, they can also be used to restore all past states of the aggregate or revert to a point in time</p></li><li><p>Deep Insight - Historic insight, interpreting why things are the way they are</p></li><li><p>Auditing - Events are a strongly consistent audit log of everything that has happened to the aggregates’ state</p></li><li><p>Optimistic - The classic optimistic concurrency model raises an exception when the read data becomes stale—overwritten by another process—while it is being written</p></li></ol></div></div></section><section id="_disadvantages"><h2>Disadvantages</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Learning Curve - The obvious disadvantage of the pattern is its sharp difference from the traditional techniques of managing data. Successful implementation of the pattern demands training of the team and time to get used to the new way of thinking</p></li><li><p>Evolving the model - Evolving an event-sourced model can be challenging. The strict definition of event sourcing says that events are immutable. But what if you need to adjust the event’s schema?</p></li><li><p>Architectural Complexity - Implementation of event sources introduces numerous architectural “moving parts,” making the overall design more complicated</p></li></ol></div></div></section><section id="_is_this_performant"><h2>Is this performant?</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Reconstituting an aggregate’s state from events will negatively affect the system’s performance. It will degrade as events are added. How can this even work?</dt><dd><div class="ulist"><ul><li><p>Given many records, there could be a performance hit, but will only be noticeable after 10000 records</p></li><li><p>An average aggregate lifespan shouldn&#8217;t exceed 100 events</p></li></ul></div></dd></dl></div></div></section><section id="_snapshot_pattern"><h2>Snapshot Pattern</h2><div class="slide-content"><div class="ulist"><ul><li><p>In cases that you need performance there is the snapshot pattern</p></li><li><p>Continuously iterates new events in the event store and generates a caches</p></li><li><p>The process fetches the events that came after the cache event and include it in the cache</p></li></ul></div>
<div class="imageblock"><img src="./images/snapshot_pattern.png" alt="snapshot pattern" width="60%" height="60%"></div></div></section><section id="_scaling_data"><h2>Scaling Data</h2><div class="slide-content"><div class="ulist"><ul><li><p>Using this kind of storage can also scale.</p></li><li><p>Storage can be distributed by select key and sharded</p></li><li><p>You can use digest algorithms to determine where data should reside</p></li></ul></div>
<div class="imageblock"><img src="./images/event_shard.png" alt="event shard"></div></div></section><section id="_deleting_data"><h2>Deleting Data</h2><div class="slide-content"><div class="ulist"><ul><li><p>If there is absolute requirement to "be forgotten", data can be deleted</p></li><li><p>In the case of sharding, events are stored by key, therefore, you can find the key and delete it</p></li></ul></div></div></section><section id="_can_i_just_write_logs_to_a_text_file_and_use_it_as_an_audit_log"><h2>Can I just write logs to a text file and use it as an audit log?</h2><div class="slide-content"><div class="ulist"><ul><li><p>It’s a transaction against two storage mechanisms: the database and the file</p></li><li><p>If the first one fails, the second needs to be rolled back</p></li><li><p>If a database transaction fails is that reflect in the log file?</p></li></ul></div></div></section><section id="_can_i_do_state_based_models_and_appends_logs_to_log_table"><h2>Can I do state based models and appends logs to log table?</h2><div class="slide-content"><div class="ulist"><ul><li><p>It is consistent synchronization, but what if an engineer forgets to append to a log</p></li><li><p>The state based model becomes the source of truth, and the log file becomes the burden and hard to manage</p></li></ul></div></div></section></section>
<section id="_lab_modeling_time"><h2>Lab: Modeling Time</h2></section>
<section><section id="_oltp_vs_olap_tactical"><h2>OLTP vs OLAP [Tactical]</h2></section><section id="_oltp_vs_olap"><h2>OLTP vs OLAP</h2><div class="slide-content"><div class="ulist"><ul><li><p>Online analytical processing (OLAP) and online transaction processing (OLTP) are data processing systems that help you store and analyze business data.</p></li><li><p>OLAP combines and groups the data so you can analyze it from different points of view</p></li><li><p>OLTP stores and updates transactional data reliably and efficiently in high volumes</p></li><li><p>OLTP databases can be one among several data sources for an OLAP system.</p></li></ul></div>
<div class="openblock listingblock"><div class="content"><div class="paragraph"><p><a href="https://aws.amazon.com/compare/the-difference-between-olap-and-oltp/#:~:text=OLTP-,Online%20analytical%20processing%20(OLAP)%20and%20online%20transaction%20processing%20(OLTP,processing%20and%20real%2Dtime%20updates" target="_blank">What&#8217;s the difference between OLAP and OLTP</a></p></div></div></div></div></section><section id="_oltp_vs_olap_comparison"><h2>OLTP vs OLAP Comparison</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:33.3333%"><col style="width:33.3334%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Criteria</th><th class="tableblock halign-left valign-top">OLAP</th><th class="tableblock halign-left valign-top">OLTP</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Purpose</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLAP helps you analyze large volumes of data to support decision-making.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLTP helps you manage and process real-time transactions.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Data source</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLAP uses historical and aggregated data from multiple sources.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLTP uses real-time and transactional data from a single source.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Data structure</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLAP uses multidimensional (cubes) or relational databases.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLTP uses relational databases.</p></td></tr></table></div></section><section id="_oltp_vs_olap_comparison_2"><h2>OLTP vs OLAP Comparison</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:33.3333%"><col style="width:33.3334%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Data model</th><th class="tableblock halign-left valign-top">OLAP uses star schema, snowflake schema, or other analytical models.</th><th class="tableblock halign-left valign-top">OLTP uses normalized or denormalized models.</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Volume of data</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLAP has large storage requirements. Think terabytes (TB) and petabytes (PB).</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLTP has comparatively smaller storage requirements. Think gigabytes (GB).</p></td></tr></table>
<div class="openblock listingblock"><div class="content"><div class="paragraph"><p><a href="https://aws.amazon.com/compare/the-difference-between-olap-and-oltp/#:~:text=OLTP-,Online%20analytical%20processing%20(OLAP)%20and%20online%20transaction%20processing%20(OLTP,processing%20and%20real%2Dtime%20updates" target="_blank">What&#8217;s the difference between OLAP and OLTP</a></p></div></div></div></div></section><section id="_oltp_vs_olap_comparison_continued"><h2>OLTP vs OLAP Comparison (Continued)</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:33.3333%"><col style="width:33.3334%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Criteria</th><th class="tableblock halign-left valign-top">OLAP</th><th class="tableblock halign-left valign-top">OLTP</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Response time</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLAP has longer response times, typically in seconds or minutes.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLTP has shorter response times, typically in milliseconds</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Example applications</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLAP is good for analyzing trends, predicting customer behavior, and identifying profitability.</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">OLTP is good for processing payments, customer data management, and order processing.</p></td></tr></table>
<div class="openblock listingblock"><div class="content"><div class="paragraph"><p><a href="https://aws.amazon.com/compare/the-difference-between-olap-and-oltp/#:~:text=OLTP-,Online%20analytical%20processing%20(OLAP)%20and%20online%20transaction%20processing%20(OLTP,processing%20and%20real%2Dtime%20updates" target="_blank">What&#8217;s the difference between OLAP and OLTP</a></p></div></div></div></div></section></section>
<section><section id="_architectural_patterns_tactical"><h2>Architectural Patterns [Tactical]</h2></section><section id="_choosing_the_appropriate_architecture"><h2>Choosing the appropriate architecture</h2><div class="slide-content"><div class="ulist"><ul><li><p>When the business logic has to change, it may not be evident what parts of the codebase have to be affected by the change.</p></li><li><p>The change may have unexpected effects on seemingly unrelated parts of the system. Conversely, it may be easy to miss code that has to be modified.</p></li><li><p>All of these issues dramatically increase the cost of maintaining the codebase.</p></li><li><p>Architectural patterns introduce organizational principles for the different aspects of a codebase and present clear boundaries between them: how the business logic is wired to the system’s input, output, and other infrastructural components</p></li><li><p>Choosing the appropriate way to organize the codebase, or the correct architectural pattern, is crucial to support implementation of the business logic in the short term and alleviate maintenance in the long term</p></li></ul></div></div></section><section id="_layered_architecture"><h2>Layered Architecture</h2><div class="slide-content"><div class="imageblock"><img src="./images/layered_architecture.png" alt="layered architecture"></div></div></section><section id="_layered_architecture_2"><h2>Layered Architecture</h2><div class="slide-content"><div class="ulist"><ul><li><p>One of the most common architectural pattersnm</p></li><li><p>It organizes the codebase into horizontal layers, with each layer addressing one of the following technical concerns:</p><div class="ulist"><ul><li><p>Interaction with the consumers (Presentation Layer - PL)</p></li><li><p>Implementing business logic (Business Layer - BL)</p></li><li><p>Persisting the data (Data Access Layer - DAL)</p></li></ul></div></li></ul></div></div></section><section id="_presentation_layer"><h2>Presentation Layer</h2><div class="slide-content"><div class="ulist"><ul><li><p>program’s user interface for interactions with its consumers</p></li><li><p>layer denotes a graphical interface, such as a web interface or a desktop application</p></li><li><p>All means for triggering behavior</p><div class="ulist"><ul><li><p>Graphical user interface (GUI)</p></li><li><p>Command-line interface (CLI)</p></li><li><p>API for programmatic integration with other systems</p></li><li><p>Subscription to events in a message broker</p></li><li><p>Message topics for publishing outgoing events</p></li></ul></div></li></ul></div>
<div class="imageblock"><img src="./images/presentation_layer.png" alt="presentation layer"></div></div></section><section id="_business_logic_layer"><h2>Business Logic Layer</h2><div class="slide-content"><div class="ulist"><ul><li><p>Layer is responsible for implementing and encapsulating the program’s business logic.</p></li><li><p>This is the place where business decisions are implemented.</p></li><li><p>"This layer is the heart of software"&#8201;&#8212;&#8201;Eric Evans</p></li><li><p>Where business logic patterns are implemented—for example, active records or a domain model</p></li></ul></div>
<div class="imageblock"><img src="./images/business_layer.png" alt="business layer"></div></div></section><section id="_data_access_layer"><h2>Data Access Layer</h2><div class="slide-content"><div class="ulist"><ul><li><p>Persistence Mechanisms</p></li><li><p>This include SQL datastores but so much more:</p><div class="ulist"><ul><li><p>NoSQL</p></li><li><p>Cloud based storage</p></li><li><p>Messaging systems</p></li><li><p>External APIs (language translation, stock price services, etc)</p></li></ul></div></li></ul></div>
<div class="imageblock"><img src="./images/data_access_layer.png" alt="data access layer"></div></div></section><section id="_communication_between_layers"><h2>Communication Between Layers</h2><div class="slide-content"><div class="ulist"><ul><li><p>Each layer can hold a dependency only on the layer directly beneath it</p></li><li><p>This enforces decoupling of implementation concerns and reduces the knowledge shared between the layers</p></li></ul></div>
<div class="imageblock"><img src="./images/communication_between_layers.png" alt="communication between layers"></div></div></section><section id="_added_a_service_layer"><h2>Added a Service Layer</h2><div class="slide-content"><div class="ulist"><ul><li><p>It’s common to see the layered architecture pattern extended with an additional layer: the service layer</p></li><li><p>The service layer acts as an intermediary between the program’s presentation and business logic layers.</p></li></ul></div></div></section><section id="_layered_architecture_with_service_layer"><h2>Layered Architecture with Service Layer</h2><div class="slide-content"><div class="imageblock"><img src="./images/full_layers_with_service.png" alt="full layers with service"></div></div></section><section id="_when_to_use_layered_architecture"><h2>When to use Layered Architecture</h2><div class="slide-content"><div class="ulist"><ul><li><p>Good fit for a system with its business logic implemented using the transaction script or active record pattern</p></li><li><p>Bad fit to implement a domain model. In a domain model, the business entities (aggregates and value objects) should have no dependency and no knowledge of the underlying infrastructure</p></li></ul></div></div></section><section id="_tiers_vs_layers"><h2>Tiers vs Layers</h2><div class="slide-content"><div class="ulist"><ul><li><p>The layers architecture is often confused with the N-Tier architecture, and vice versa</p></li><li><p>They are different: A layer is a logical boundary, whereas a tier is a physical boundary</p></li><li><p>Layers are bound by the same lifecycle: they are implemented, evolved, and deployed as one single unit</p></li><li><p>Tiers is an independently deployable service, server, or system.</p></li></ul></div>
<div class="imageblock"><img src="./images/tiers.png" alt="tiers"></div></div></section><section id="_ports_adapters"><h2>Ports &amp; Adapters</h2><div class="slide-content"><div class="ulist"><ul><li><p>Architecture that addresses the shortcomings of the layered architecture and is a better fit for implementation of more complex business logic</p></li><li><p>The dependency inversion principle (DIP) states that high-level modules, which implement the business logic, should not depend on low-level modules</p></li><li><p>Notice the arrows for dependencies. The business logic is used and doesn&#8217;t have any idea about the application it is housed in, nor the infrastructure</p></li></ul></div></div></section><section id="_ports_adapters_2"><h2>Ports &amp; Adapters</h2><div class="slide-content"><div class="imageblock"><img src="./images/ports_adapters.png" alt="ports adapters"></div></div></section><section id="_integration_with_ports_and_adapters"><h2>Integration with Ports and Adapters</h2><div class="slide-content"><div class="ulist"><ul><li><p>Instead of referencing and calling the infrastructural components directly, the business logic layer defines “ports” that have to be implemented by the infrastructure layer.</p></li><li><p>The infrastructure layer implements “adapters”: concrete implementations of the ports’ interfaces for working with different technologies</p></li></ul></div></div></section><section id="_ports_and_adapters_architecture"><h2>Ports and Adapters Architecture</h2><div class="slide-content"><div class="imageblock"><img src="./images/hexagonal_architecture.png" alt="hexagonal architecture"></div></div></section><section id="_when_to_use_ports_adapters"><h2>When to use ports &amp; Adapters?</h2><div class="slide-content"><div class="paragraph"><p>The decoupling of the business logic from all technological concerns makes the ports &amp; adapters architecture a perfect fit for business logic implemented with the domain model pattern</p></div></div></section><section id="_materialized_views"><h2>Materialized Views</h2><div class="slide-content"><div class="ulist"><ul><li><p>Currently much of the data revolves on how it is stored, not how it is read</p></li><li><p>Data when read needs to transformed and prepared</p></li><li><p>Each entity typically has too much information for it to be queryable and usable</p></li><li><p>For example, one data entry in a document style database can have other aggregates that are not absolutely necessary</p></li><li><p>Data may also need to be joined, cleansed, or engineered for a particular purpose, like machine learning</p></li></ul></div></div></section><section id="_materialized_view"><h2>Materialized View</h2><div class="slide-content"><div class="imageblock"><img src="./images/materialized_view.png" alt="materialized view"></div></div></section><section id="_cqrs_command_query_responsibility_segregation"><h2>CQRS (Command Query Responsibility Segregation)</h2><div class="slide-content"><div class="ulist"><ul><li><p>Provides the possibility of materializing projected models into physical databases that can be used for flexible querying options</p></li><li><p>Pattern segregates the responsibilities of the system’s models.</p></li><li><p>There are two types of models:</p><div class="ulist"><ul><li><p>The command execution model</p></li><li><p>The read models</p></li></ul></div></li></ul></div></div></section><section id="_command_execution_model"><h2>Command execution model</h2><div class="slide-content"><div class="ulist"><ul><li><p>CQRS devotes a single model to executing operations that modify the system’s state (system commands).</p></li><li><p>This model is used to implement the business logic, validate rules, and enforce invariants.</p></li><li><p>The command execution model is also the only model representing strongly consistent data—the system’s source of truth.</p></li><li><p>It should be possible to read the strongly consistent state of a business entity and have optimistic concurrency support when updating it.</p></li></ul></div></div></section><section id="_read_models_projections"><h2>Read models (projections)</h2><div class="slide-content"><div class="ulist"><ul><li><p>The system can define as many models as needed to present data to users or supply information to other systems.</p></li><li><p>A read model is a precached projection.</p></li><li><p>It can reside in a durable database, flat file, or in-memory cache. Proper implementation of CQRS allows for wiping out all data of a projection and regenerating it from scratch.</p></li><li><p>This also enables extending the system with additional projections in the future—models that couldn’t have been foreseen originally.</p></li><li><p>Finally, read models are read-only./</p></li><li><p><strong>None of the system’s operations can directly modify the read models’ data.</strong></p></li></ul></div></div></section><section id="_projecting_read_models"><h2>Projecting Read Models</h2><div class="slide-content"><div class="ulist"><ul><li><p>For the read models to work, the system has to project changes from the command execution model to all its read models.</p></li><li><p>The projection of read models is similar to the notion of a materialized view in relational databases: whenever source tables are updated, the changes have to be reflected in the precached views.</p></li></ul></div>
<div class="imageblock"><img src="./images/projecting_reads.png" alt="projecting reads"></div></div></section><section id="_generating_projections"><h2>Generating Projections</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">There are two ways of generating projections</dt><dd><div class="ulist"><ul><li><p>Synchronous</p></li><li><p>Asynchronous</p></li></ul></div></dd></dl></div></div></section><section id="_synchronous_projections"><h2>Synchronous Projections</h2><div class="slide-content"><div class="ulist"><ul><li><p>Synchronous projections fetch changes to the OLTP (online transaction processing) data through the catch-up subscription model:</p></li><li><p>The projection engine queries the OLTP database for added or updated records after the last processed checkpoint.</p></li><li><p>The projection engine uses the updated data to regenerate/update the system’s read models.</p></li><li><p>The projection engine stores the checkpoint of the last processed record. This value will be used during the next iteration for getting records added or modified after the last processed record.</p></li></ul></div></div></section><section id="_synchronous_read_projection"><h2>Synchronous Read Projection</h2><div class="slide-content"><div class="imageblock"><img src="./images/synchronous_read_projection.png" alt="synchronous read projection"></div></div></section><section id="_using_checkpoints"><h2>Using Checkpoints</h2><div class="slide-content"><div class="ulist"><ul><li><p>For the catch-up subscription to work, the command execution model has to checkpoint all the appended or updated database records.</p></li><li><p>The storage mechanism should also support the querying of records based on the checkpoint.</p></li></ul></div>
<div class="imageblock"><img src="./images/read_projection_checkpoint.png" alt="read projection checkpoint"></div></div></section><section id="_asynchronous_projects"><h2>Asynchronous Projects</h2><div class="slide-content"><div class="ulist"><ul><li><p>In the asynchronous projection scenario, the command execution model publishes all committed changes to a message bus</p></li><li><p>The system’s projection engines can subscribe to the published messages and use them to update the read models</p></li></ul></div>
<div class="imageblock"><img src="./images/asynchronous_read_projection.png" alt="asynchronous read projection"></div></div></section><section id="_challenges_2"><h2>Challenges</h2><div class="slide-content"><div class="ulist"><ul><li><p>Despite the apparent scaling and performance advantages of the asynchronous projection method, it is more prone to the challenges of distributed computing.</p></li><li><p>If the messages are processed out of order or duplicated, inconsistent data will be projected into the read models.</p></li></ul></div></div></section><section id="_model_segregation_and_communication"><h2>Model Segregation and Communication</h2><div class="slide-content"><div class="ulist"><ul><li><p>In the CQRS architecture, the responsibilities of the system’s models are segregated according to their type.</p></li><li><p>A command can only operate on the strongly consistent command execution model.</p></li><li><p>A query cannot directly modify any of the system’s persisted state—neither the read models nor the command execution model.</p></li><li><p><em>But</em>, the command model <strong>should communicate to the caller</strong> when something has failed.</p></li><li><p>We cannot expect any message to appear on the read model, because it will be eventually consistent</p></li></ul></div></div></section><section id="_patterns_and_boundaries"><h2>Patterns and Boundaries</h2><div class="slide-content"><div class="ulist"><ul><li><p>The patterns we’ve discussed—layered architecture, ports &amp; adapters architecture, and CQRS—should not be treated as systemwide organizational principles.</p></li><li><p>These are not necessarily high-level architecture patterns for a whole bounded context either</p></li></ul></div></div></section><section id="_one_architecture_does_not_fit_all"><h2>One Architecture does not fit all</h2><div class="slide-content"><div class="ulist"><ul><li><p>Consider a bounded context encompassing multiple subdomains</p></li><li><p>The subdomains can be of different types: core, supporting, or generic. Even subdomains of the same type may require different business logic and architectural patterns.</p></li><li><p>Enforcing a single, bounded, context wide architecture will inadvertently lead to accidental complexity</p></li></ul></div>
<div class="imageblock"><img src="./images/bounded_context_architecture.png" alt="bounded context architecture"></div></div></section><section id="_vertical_partitioning"><h2>Vertical Partitioning</h2><div class="slide-content"><div class="ulist"><ul><li><p>In addition to the layers that partition the system horizontally, we can introduce additional vertical partitioning.</p></li><li><p>It’s crucial to define logical boundaries for modules encapsulating distinct business subdomains and use the appropriate tools for each</p></li><li><p>Appropriate vertical boundaries make a monolithic bounded context a modular one and help to prevent it from becoming a big ball of mud.</p></li><li><p>These logical boundaries can be refactored later into physical boundaries of finer-grained bounded contexts</p></li></ul></div></div></section><section id="_vertical_partitioning_2"><h2>Vertical Partitioning</h2><div class="slide-content"><div class="imageblock"><img src="./images/verticle_slices.png" alt="verticle slices"></div></div></section><section id="_a_note_about_java_modules"><h2>A Note about Java Modules</h2><div class="slide-content"><div class="ulist"><ul><li><p>Using modules in java for contexts or dividing layers is a strong possibility</p></li><li><p>One of the benefits for doing so is that you can define strictly what can be accessed and what can&#8217;t</p></li><li><p>You can also define who has access to what java packages/modules</p></li></ul></div>
<div class="paragraph"><p><a href="https://www.baeldung.com/java-modules-ddd-bounded-contexts" class="bare">https://www.baeldung.com/java-modules-ddd-bounded-contexts</a></p></div></div></section></section>
<section id="_lab_architectural_patterns"><h2>Lab: Architectural Patterns</h2></section>
<section><section id="_communication_patterns_tactical"><h2>Communication Patterns [Tactical]</h2></section><section id="_model_translations"><h2>Model Translations</h2></section><section id="_stateless_model_translation"><h2>Stateless Model Translation</h2><div class="slide-content"><div class="ulist"><ul><li><p>For stateless model translation, the bounded context that owns the translation (OHS for upstream, ACL for downstream) implements the proxy design pattern to interject the incoming and outgoing requests and map the source model to the bounded context’s target model</p></li><li><p>Implementation of the proxy depends on whether the bounded contexts are communicating <em>synchronously</em> or <em>asynchronously</em></p></li></ul></div>
<div class="imageblock"><img src="./images/model_translation_proxy.png" alt="model translation proxy"></div></div></section><section id="_synchronous"><h2>Synchronous</h2><div class="slide-content"><div class="ulist"><ul><li><p>The typical way to translate models used in synchronous communication is to embed the transformation logic in the bounded context’s codebase</p></li><li><p>In an open-host service, translation to the public language takes place when processing incoming request</p></li><li><p>In an anticorruption layer, it occurs when calling the upstream bounded context</p></li></ul></div>
<div class="imageblock"><img src="./images/synchronous_communication.png" alt="synchronous communication"></div></div></section><section id="_outsourcing_synchronous_patterns"><h2>Outsourcing Synchronous Patterns</h2><div class="slide-content"><div class="ulist"><ul><li><p>In some cases, it can be more cost-effective and convenient to offload the translation logic to an external component such as an API gateway pattern.</p></li><li><p>The API gateway component can be an open source software-based solution such as Kong or KrakenD</p></li><li><p>it can be a cloud vendor’s managed service such as AWS API Gateway, Google Apigee, or Azure API Management.</p></li></ul></div></div></section><section id="_bounded_contexts_implementing_open_host_patterns"><h2>Bounded Contexts Implementing Open Host Patterns</h2><div class="slide-content"><div class="ulist"><ul><li><p>For bounded contexts implementing the open-host pattern, the API gateway is responsible for converting the internal model into the integration-optimized published language</p></li><li><p>Moreover, having an explicit API gateway can alleviate the process of managing and serving multiple versions of the bounded context’s API</p></li></ul></div>
<div class="imageblock"><img src="./images/ohs_version_language.png" alt="ohs version language"></div></div></section><section id="_anticorruption_layers"><h2>Anticorruption Layers</h2><div class="slide-content"><div class="ulist"><ul><li><p>Anticorruption layers implemented using an API gateway can be consumed by multiple downstream bounded contexts.</p></li><li><p>In such cases, the anticorruption layer acts as an integration-specific bounded context</p></li><li><p>Such bounded contexts, which are mainly in charge of transforming models for more convenient consumption by other components, are often referred to as interchange contexts</p></li></ul></div>
<div class="imageblock"><img src="./images/anti-corruption-layer-language.png" alt="anti corruption layer language"></div></div></section><section id="_asynchronous"><h2>Asynchronous</h2><div class="slide-content"><div class="ulist"><ul><li><p>To translate models used in asynchronous communication you can implement a message proxy: an intermediary component subscribing to messages coming from the source bounded context.</p></li><li><p>The proxy will apply the required model transformations and forward the resultant messages to the target subscriber</p></li><li><p>In addition to translating the messages’ model, the intercepting component can also reduce the noise on the target bounded context by filtering out irrelevant messages</p></li></ul></div>
<div class="imageblock"><img src="./images/async_model_translate.png" alt="async model translate"></div></div></section><section id="_asynchronous_model_translation"><h2>Asynchronous Model Translation</h2><div class="slide-content"><div class="ulist"><ul><li><p>Asynchronous model translation is essential when implementing an open host service.</p></li><li><p>It’s a common mistake to design and expose a published language for the model’s objects and allow domain events to be published as they are, thereby exposing the bounded context’s implementation model.</p></li><li><p>Asynchronous translation can be used to intercept the domain events and convert them into a published language, thus providing better encapsulation of the bounded context’s implementation details</p></li><li><p>Translating messages to the published language enables differentiating between private events that are intended for the bounded context’s internal needs and public events that are designed for integration with other bounded contexts.</p></li></ul></div>
<div class="imageblock"><img src="./images/domain_language_events.png" alt="domain language events"></div></div></section><section id="_stateful_model_translation"><h2>Stateful Model Translation</h2><div class="slide-content"><div class="ulist"><ul><li><p>Discrete Events would need to be aggregated and often from other sources</p></li><li><p>This will require stateful model translation</p></li></ul></div></div></section><section id="_aggregating_incoming_data"><h2>Aggregating Incoming Data</h2><div class="slide-content"><div class="ulist"><ul><li><p>Let’s say a bounded context is interested in aggregating incoming requests and processing them in batches for performance optimization.</p></li><li><p>In this case, aggregation may be required both for synchronous and asynchronous requests</p></li></ul></div>
<div class="imageblock"><img src="./images/batching_requests.png" alt="batching requests"></div></div></section><section id="_combining_multiple_fine_grained_messages"><h2>Combining multiple fine grained messages</h2><div class="slide-content"><div class="paragraph"><p>Another common use case for aggregation of source data is combining multiple fine-grained messages into a single message containing the unified data</p></div>
<div class="imageblock"><img src="./images/unifying_data.png" alt="unifying data"></div></div></section><section id="_persistent_storage_for_aggregates"><h2>Persistent Storage for Aggregates</h2><div class="slide-content"><div class="ulist"><ul><li><p>Model transformation that aggregates incoming data cannot be implemented using an API gateway, and thus requires more elaborate, stateful processing.</p></li><li><p>To track the incoming data and process it accordingly, the translation logic requires its own persistent storage</p></li><li><p>You can avoid implementing a custom solution for a stateful translation by using off-the-shelf products; for example, a stream-process platform (Kafka, AWS Kinesis, etc.), or a batching solution (Apache NiFi, AWS Glue, Spark, etc.).</p></li></ul></div>
<div class="imageblock"><img src="./images/stateful_model_transforms.png" alt="stateful model transforms"></div></div></section><section id="_unifying_multiple_sources"><h2>Unifying Multiple Sources</h2><div class="slide-content"><div class="ulist"><ul><li><p>A bounded context may need to process data aggregates from multiple sources, including other bounded contexts.</p></li><li><p>A typical example for this is the backend-for-frontend pattern in which the user interface has to combine data originating from multiple services</p></li><li><p>Another example is a bounded context that must process data from multiple other contexts and implement complex business logic to process all the data.</p></li><li><p>In this case, it can be beneficial to decouple the integration and business logic complexities by fronting the bounded context with an anticorruption layer that aggregates data from all other bounded context</p></li></ul></div></div></section><section id="_unifying_multiple_sources_2"><h2>Unifying Multiple Sources</h2><div class="slide-content"><div class="imageblock"><img src="./images/integration_acl.png" alt="integration acl"></div></div></section><section id="_event_publishing_example"><h2>Event Publishing Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class Campaign {
    private List&lt;DomainEvent&gt; events; // In the aggregate?
    private MessageBus messageBus; // In the aggregate?
    private List&lt;Location&gt; locations;

    public void deactivate(string reason) {
        for (Location loc : locations) {
            loc.deactivate();
        }

        isActive = false;

        var newEvent = new CampaignDeactivated(id, reason);
        events.append(newEvent);   //Where will this fail? Here?
        messageBus.publish(newEvent); //Or Here?
    }
}</code></pre></div></div></div></section><section id="_issues_with_the_code"><h2>Issues with the code</h2><div class="slide-content"><div class="ulist"><ul><li><p>First, the event will be dispatched before the aggregate’s new state is committed to the database.</p></li><li><p>A subscriber may receive the notification that the campaign was deactivated, but it would contradict the campaign’s state.</p></li><li><p>Second, what if the database transaction fails to commit because of a race condition, subsequent aggregate logic rendering the operation invalid, or simply a technical issue in the database?</p></li><li><p>Even though the database transaction is rolled back, the event is already published and pushed to subscribers, and there is no way to retract it.</p></li></ul></div></div></section><section id="_shifting_to_the_application_layer"><h2>Shifting to the Application Layer</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class ManagementAPI {
     private final MessageBus messageBus;
     private final CampaignRepository repository;

     public Result deactivateCampaign(CampaignId id, string reason) {
         try {
             var campaign = repository.load(id);
             campaign.deactivate(reason);
             repository.commitChanges(campaign);

             var events = campaign.getUnpublishedEvents();
             for (DomainEvent e : events) {
                 messageBus.publish(e);
             }
             campaign.clearUnpublishedEvents();
             return Success();
         }
         catch(Exception ex) {
             return Failed();
         }
     }
 }</code></pre></div></div></div></section><section id="_issues_with_the_previous_code"><h2>Issues with the Previous Code</h2><div class="slide-content"><div class="ulist"><ul><li><p>process running the logic for some reason fails to publish the domain events.</p></li><li><p>Perhaps the message bus is down.</p></li><li><p>Or the server running the code fails right after committing the database transaction, but before publishing the events the system will still end in an inconsistent state, which means that the database transaction is committed, but the domain events will never be published.</p></li></ul></div></div></section><section id="_fixing_with_the_outbox_pattern"><h2>Fixing with the Outbox Pattern</h2><div class="slide-content"><div class="ulist"><ul><li><p>Both the updated aggregate’s state and the new domain events are committed in the same atomic transaction.</p></li><li><p>A message relay fetches newly committed domain events from the database.</p></li><li><p>The relay publishes the domain events to the message bus.</p></li><li><p>Upon successful publishing, the relay either marks the events as published in the database or deletes them completely</p></li></ul></div>
<div class="imageblock"><img src="./images/outbox_pattern.png" alt="outbox pattern"></div></div></section><section id="_outbox_with_relational_databases"><h2>Outbox with relational databases</h2><div class="slide-content"><div class="paragraph"><p>When using a relational database, it’s convenient to leverage the database’s ability to commit to two tables atomically and use a dedicated table for storing the messages</p></div>
<div class="imageblock"><img src="./images/relational_outbox.png" alt="relational outbox"></div></div></section><section id="_nosql_style_outbox"><h2>NoSQL-style outbox</h2><div class="slide-content"><div class="ulist"><ul><li><p>When using a NoSQL database that doesn’t support multi-document transactions,
the outgoing domain events have to be embedded in the aggregate’s record.</p></li><li><p>In the following, you can see the JSON document’s additional property, outbox, containing a list of domain events that have to be published.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
    "campaign-id": "364b33c3-2171-446d-b652-8e5a7b2be1af",
    "state": {
        "name": "Autumn 2017",
        "publishing-state": "DEACTIVATED",
        "ad-locations": [
            ...
        ]
        ...
    },
    "outbox": [
        {
            "campaign-id": "364b33c3-2171-446d-b652-8e5a7b2be1af",
            "type": "campaign-deactivated",
            "reason": "Goals met",
            "published": false
        }
    ]
}</code></pre></div></div></div></section><section id="_fetching_unpublished_events"><h2>Fetching Unpublished Events</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">The publishing relay can fetch the new domain events in either a pull-based or push-based manner</dt><dd><div class="ulist"><ul><li><p>Pull as a polling publisher</p></li><li><p>Push using transaction log tailing</p></li></ul></div></dd></dl></div></div></section><section id="_pull_as_a_polling_publisher"><h2>Pull as a polling publisher</h2><div class="slide-content"><div class="ulist"><ul><li><p>The relay can continuously query the database for unpublished events.</p></li><li><p>Proper indexes have to be in place to minimize the load on the database induced by the constant polling</p></li></ul></div></div></section><section id="_push_using_transaction_log_tailing"><h2>Push using transaction log tailing</h2><div class="slide-content"><div class="ulist"><ul><li><p>Here we can leverage the database’s feature set to proactively call the publishing relay when new events are appended.</p></li><li><p>For example, some relational databases enable getting notifications about updated/inserted records by tailing the database’s transaction log.</p></li><li><p>Some NoSQL databases expose committed changes as streams of events (e.g., AWS DynamoDB Streams)</p></li></ul></div></div></section><section id="_delivery_semantics"><h2>Delivery Semantics</h2><div class="slide-content"><div class="ulist"><ul><li><p>The outbox pattern guarantees delivery of the messages at least once</p></li><li><p>If the relay fails right after publishing a message but before marking it as published in the database, the same message will be published again in the next iteration</p></li></ul></div></div></section><section id="_saga"><h2>Saga</h2><div class="slide-content"><div class="ulist"><ul><li><p>A saga is a long-running business process.</p></li><li><p>It’s long-running not necessarily in terms of time, as sagas can run from seconds to years, but rather in terms of transactions: a business process that spans multiple transactions</p></li><li><p>Transactions can be handled not only by aggregates but by any component emitting domain events and responding to commands</p></li><li><p>Saga listens to the events emitted by the relevant components and issues subsequent commands to the other components. If one of the execution steps fails, the saga is in charge of issuing relevant compensating actions to ensure the system state remains consistent</p></li></ul></div></div></section><section id="_saga_2"><h2>Saga</h2><div class="slide-content"><div class="imageblock"><img src="./images/saga.png" alt="saga"></div></div></section><section id="_stateless_saga_example"><h2>Stateless Saga Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class CampaignPublishingSaga
{
    private final CampaignRepository repository;
    private final PublishingServiceClient publishingService;

    public void process(CampaignActivated event)
    {
        var campaign = repository.load(event.campaignId);
        var advertisingMaterials = campaign.generateAdvertisingMaterials();
        publishingService.submitAdvertisement(event.campaignId,
                                              advertisingMaterials);
    }

    public void process(PublishingConfirmed event)
    {
        var campaign = repository.load(event.campaignId);
        campaign.trackPublishingConfirmation(event.confirmationId);
        repository.commitChanges(campaign);
    }

    public void process(PublishingRejected event)
    {
        var campaign = repository.load(event.campaignId);
        campaign.trackPublishingRejection(event.rejectionReason);
        repository.commitChanges(campaign);
    }
}</code></pre></div></div></div></section><section id="_stateful_saga"><h2>Stateful Saga</h2><div class="slide-content"><div class="ulist"><ul><li><p>You will encounter sagas that do require state management; for example, to track the executed operations so that relevant compensating actions can be issued in case of a failure.</p></li><li><p>In such a situation, the saga can be implemented as an event-sourced aggregate, persisting the complete history of received events and issued commands.</p></li><li><p>However, the command execution logic should be moved out of the saga itself and executed asynchronously, similar to the way domain events are dispatched in the outbox pattern:</p></li></ul></div></div></section><section id="_stateful_saga_example"><h2>Stateful Saga Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-noescape="true" data-lang="java">public class CampaignPublishingSaga
{
    private final CampaignRepository repository;
    private final List&lt;DomainEvent&gt; events;

    public void process(CampaignActivated activated) {
        var campaign = repository.Load(activated.CampaignId);
        var advertisingMaterials = campaign.generateAdvertisingMaterials();
        var commandIssuedEvent = new CommandIssuedEvent(
            target.publishingService,
            new SubmitAdvertisementCommand(activated.campaignId, advertisingMaterials));

        events.append(activated);
        events.append(commandIssuedEvent);
    }

    public void process(PublishingConfirmed confirmed) {
        var commandIssuedEvent = new CommandIssuedEvent(
            target.campaignAggregate,
             new TrackConfirmation(confirmed.campaignId,
                                   confirmed.confirmationId));

        events.append(confirmed);
        events.append(commandIssuedEvent);
    }

    public void process(PublishingRejected rejected) {
        var commandIssuedEvent = new CommandIssuedEvent(
            target.campaignAggregate,
            new TrackRejection(rejected.campaignId,
                                        rejected.rejectionReason));

        events.append(rejected);
        events.append(commandIssuedEvent);
    }
}</code></pre></div></div></div></section><section id="_consistency_2"><h2>Consistency</h2><div class="slide-content"><div class="ulist"><ul><li><p>Although the saga pattern orchestrates a multicomponent transaction, the states of the involved components are eventually consistent. And although the saga will eventually execute the relevant commands, no two transactions can be considered atomic</p></li><li><p><strong>Only the data within an aggregate’s boundaries can be considered strongly consistent.
Everything outside is eventually consistent</strong></p></li><li><p>Use this as a guiding principle to make sure you are not abusing sagas to compensate for improper aggregate boundaries.</p></li><li><p>Business operations that have to belong to the same aggregate require strongly consistent data.</p></li></ul></div></div></section><section id="_process_manager"><h2>Process Manager</h2><div class="slide-content"><div class="ulist"><ul><li><p>The process manager pattern is intended to implement a business-logic-based process</p></li><li><p>It is defined as a central processing unit that maintains the state of the sequence and determines the next processing step</p></li><li><p>If a saga contains if-else statements to choose the correct course of action, it is probably a process manager</p></li><li><p>Process Manager can be called a Saga Orchestrator where the Orchestrator is the Process Manager</p></li></ul></div>
<div class="imageblock"><img src="./images/process_manager.png" alt="process manager"></div></div></section></section>
<section id="_lab_communication_patterns_outbox"><h2>Lab: Communication Patterns (Outbox)</h2></section>
<section id="_lab_communication_patterns_saga"><h2>Lab: Communication Patterns (Saga)</h2></section>
<section id="_application"><h2>Application</h2></section>
<section><section id="_design_heuristics_application"><h2>Design Heuristics [Application]</h2></section><section id="_heuristics"><h2>Heuristics</h2><div class="slide-content"><div class="ulist"><ul><li><p>A heuristic is not a hard rule that is guaranteed and mathematically proven to be correct in 100% of cases</p></li><li><p>Rather, it’s a rule of thumb: not guaranteed to be perfect, yet sufficient for one’s immediate goals.</p></li><li><p>In other words, using heuristics is an effective problem-solving approach that ignores the noise inherent in many cues, focusing instead on the “swamping forces” reflected in the most important cues.</p></li></ul></div></div></section><section id="_what_should_be_the_size_of_a_bounded_context"><h2>What should be the size of a bounded context?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Rather than making the model a function of the desired size—optimizing for small bounded contexts—it’s much more effective to do the opposite: treat the bounded context’s size as a function of the model it encompasses.</p></li><li><p>Software changes affecting multiple bounded contexts are expensive and require lots of coordination, especially if the affected bounded contexts are implemented by different teams</p></li><li><p>Such changes that are not encapsulated in a single bounded context signal ineffective design of the contexts’ boundaries.</p></li><li><p>Unfortunately, refactoring bounded context boundaries is an expensive undertaking, and in many cases, the ineffective boundaries remain unattended and end up accumulating technical debt</p></li></ul></div></div></section><section id="_updating_new_requirements"><h2>Updating New Requirements</h2><div class="slide-content"><div class="ulist"><ul><li><p>Changes that invalidate the bounded contexts’ boundaries typically occur when the business domain is not well known or the business requirements change frequently.</p></li><li><p>Both volatility and uncertainty are the properties of core subdomains, especially at the early stages of implementation. We can use it as a heuristic for designing bounded context boundaries</p></li></ul></div>
<div class="imageblock"><img src="./images/new_requirement.png" alt="new requirement"></div></div></section><section id="_from_broad_boundaries_to_small_boundaries"><h2>From Broad Boundaries to Small Boundaries</h2><div class="slide-content"><div class="ulist"><ul><li><p>Broad bounded context boundaries, or those that encompass multiple subdomains, make it safer to be wrong about the boundaries or the models of the included subdomains.</p></li><li><p>Refactoring logical boundaries is considerably less expensive than refactoring physical boundaries.</p></li><li><p>Hence, when designing bounded contexts, start with wider boundaries.</p></li><li><p>If required, decompose the wide boundaries into smaller ones as you gain domain knowledge.</p></li></ul></div></div></section><section id="_broad_boundaries"><h2>Broad Boundaries</h2><div class="slide-content"><div class="ulist"><ul><li><p>This heuristic applies mainly to bounded contexts encompassing core subdomains, as both generic and supporting subdomains are more formularized and much less volatile.</p></li><li><p>When creating a bounded context that contains a core subdomain, you can protect yourself against unforeseen changes by including other subdomains that the core subdomain interacts with most often.</p></li><li><p>This can be other core subdomains, or even supporting and generic subdomains</p></li></ul></div>
<div class="imageblock"><img src="./images/wide_bounded_context.png" alt="wide bounded context" width="50%" height="50%"></div></div></section><section id="_business_logic_implementation_patterns"><h2>Business Logic Implementation Patterns</h2><div class="slide-content"><div class="imageblock"><img src="./images/business_logic_decision_tree.png" alt="business logic decision tree"></div></div></section><section id="_supporting_or_generic_subdomains"><h2>Supporting or Generic Subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>Both the transaction script and active record patterns are better suited for subdomains with simple business logic: supporting subdomains or integrating a third-party solution for a generic subdomain, for example</p></li><li><p>The transaction script pattern can be used for simple data structures, while the active record pattern helps to encapsulate the mapping of complex data structures to the underlying database.</p></li></ul></div></div></section><section id="_core_domains"><h2>Core Domains</h2><div class="slide-content"><div class="ulist"><ul><li><p>The domain model and its variant, the event-sourced domain model, lend themselves to subdomains that have complex business logic: core subdomains.</p></li><li><p>Core subdomains that deal with monetary transactions, are obligated by law to provide an audit log, or require deep analytics of the system’s behavior are better addressed by the event-sourced domain model.</p></li></ul></div></div></section><section id="_simple_vs_complex"><h2>Simple vs. Complex</h2><div class="slide-content"><div class="ulist"><ul><li><p>Complex business logic includes complicated business rules, invariants, and algorithms. A simple approach mainly revolves around validating the inputs.</p></li><li><p>Another heuristic for evaluating complexity concerns the complexity of the ubiquitous language itself. Is it mainly describing CRUD operations, or is it describing more complicated business processes and rules?</p></li></ul></div></div></section><section id="_choosing_architectural_patterns"><h2>Choosing Architectural Patterns</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Knowing the intended business logic implementation pattern makes choosing an architectural pattern straightforward</dt><dd><div class="ulist"><ul><li><p>The event-sourced domain model requires CQRS. Otherwise, the system will be extremely limited in its data querying options, fetching a single instance by its ID only.</p></li><li><p>The domain model requires the ports &amp; adapters architecture. Otherwise, the layered architecture makes it hard to make aggregates and value objects ignorant of persistence.</p></li><li><p>The Active record pattern is best accompanied by a layered architecture with the additional application (service) layer. This is for the logic controlling the active records.</p></li><li><p>The transaction script pattern can be implemented with a minimal layered architecture, consisting of only three layers.</p></li><li><p>CQRS can be beneficial not only for the event-sourced domain model</p></li></ul></div></dd></dl></div></div></section><section id="_choosing_architectural_patterns_2"><h2>Choosing Architectural Patterns</h2><div class="slide-content"><div class="imageblock"><img src="./images/architectural_pattern_tree.png" alt="architectural pattern tree"></div></div></section><section id="_testing_strategies"><h2>Testing Strategies</h2><div class="slide-content"><div class="imageblock"><img src="./images/testing_shapes.png" alt="testing shapes"></div></div></section><section id="_testing_pyramid"><h2>Testing Pyramid</h2><div class="slide-content"><div class="ulist"><ul><li><p>The classic testing pyramid emphasizes unit tests, fewer integration tests, and even fewer end-to-end tests.</p></li><li><p>Both variants of the domain model patterns are best addressed with the testing pyramid.</p></li><li><p>Aggregates and value objects make perfect units for effectively testing the business logic.</p></li></ul></div></div></section><section id="_testing_diamond"><h2>Testing Diamond</h2><div class="slide-content"><div class="ulist"><ul><li><p>The testing diamond focuses the most on integration tests.</p></li><li><p>When the active record pattern is used, the system’s business logic is, by definition, spread across both the service and business logic layers.</p></li><li><p>Therefore, to focus on integrating the two layers, the testing pyramid is the more effective choice.</p></li></ul></div></div></section><section id="_reverse_testing_pyramid"><h2>Reverse Testing Pyramid</h2><div class="slide-content"><div class="ulist"><ul><li><p>The reversed testing pyramid attributes the most attention to end-to-end tests: verifying the application’s workflow from beginning to end.</p></li><li><p>Such an approach best fits codebases implementing the transaction script pattern: the business logic is simple and the number of layers is minimal, making it more effective to verify the end-to-end flow of the system.</p></li></ul></div></div></section><section id="_business_logic_testing_decisions"><h2>Business Logic Testing Decisions</h2><div class="slide-content"><div class="imageblock"><img src="./images/business_logic_testing.png" alt="business logic testing"></div></div></section><section id="_unified_view"><h2>Unified View</h2><div class="slide-content"><div class="ulist"><ul><li><p>Identifying subdomains types and following the decision tree gives you a solid starting point for making the essential design decisions</p></li><li><p>There are many shops that implement the event-sourced domain model and use it for all their subdomains</p></li></ul></div></div></section><section id="_unified_view_2"><h2>Unified View</h2><div class="slide-content"><div class="imageblock"><img src="./images/unified_tactical_tree.png" alt="unified tactical tree" width="50%" height="50%"></div>
<div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">This is a heuristic not a law.</td></tr></table></div></div></section></section>
<section><section id="_evolving_design_decisions_application"><h2>Evolving Design Decisions [Application]</h2></section><section id="_evolving_design_decisions"><h2>Evolving Design Decisions</h2><div class="slide-content"><div class="ulist"><ul><li><p>We cannot ignore this fact when designing systems, especially if we intend to design software that’s well adapted to the requirements of its business domain.</p></li><li><p>When changes are not managed properly, even the most sophisticated and thoughtful design will eventually become a nightmare to maintain and evolve.</p></li></ul></div></div></section><section id="_review_of_the_three_domains"><h2>Review of the Three Domains</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Core</dt><dd><p>Activities the company is performing differently from its competitors to gain a competitive advantage</p></dd><dt class="hdlist1">Supporting</dt><dd><p>Things the company is doing differently from its competitors, but that do not provide a competitive edge</p></dd><dt class="hdlist1">Generic</dt><dd><p>Things all companies do in the same way</p></dd></dl></div></div></section><section id="_migration_from_core_to_generic"><h2>Migration from Core to Generic</h2><div class="slide-content"><div class="ulist"><ul><li><p>Your company has been developing it&#8217;s own solution to a hard problem and was able to optimize</p></li><li><p>Then another company has a better solution and better optimizations at a fraction of the cost</p></li><li><p>Once the competitor creates an off-the-shelf product, it becomes a <em>commodity</em> that you competitors can also buy</p></li></ul></div></div></section><section id="_migration_from_generic_to_core"><h2>Migration from Generic to Core</h2><div class="slide-content"><div class="ulist"><ul><li><p>Your company has been using off-the-shelf solution to manage inventory</p></li><li><p>Over time the off-the-shelf inventory system has not been meeting demand</p></li><li><p>Your company will then make the decision to design and build an in-house system to better fit your business</p></li><li><p>Generic subdomain into a core subdomain: successful implementation of the functionality will provide you additional competitive advantage over your competitors</p></li><li><p>Example: Amazon Bookstore to AWS</p></li></ul></div></div></section><section id="_migration_from_supporting_to_generic"><h2>Migration from Supporting to Generic</h2><div class="slide-content"><div class="ulist"><ul><li><p>Your company has a vendor tracking system</p></li><li><p>There is nothing special or complex about the system—it’s just some CRUD user interfaces for entering data</p></li><li><p>Another company has all the features in a software, including things that were in your company&#8217;s backlog</p></li><li><p>Company decides to ditch the in-house solution in favor of integrating the open source solution</p></li></ul></div></div></section><section id="_migration_from_supporting_to_core"><h2>Migration from Supporting to Core</h2><div class="slide-content"><div class="ulist"><ul><li><p>If your company finds a way to optimize the supporting logic in such a way that it either reduces costs or generates additional profits.</p></li><li><p>The typical symptom of such a transformation is the increasing complexity of the supporting subdomain’s business logic.</p></li><li><p>Supporting subdomains, by definition, are simple, mainly resembling CRUD interfaces or ETL processes</p></li><li><p>However, if the business logic becomes more complicated over time, there should be a reason for the additional complexity.</p></li><li><p>If it doesn’t affect the company’s profits, why would it become more complicated? That’s accidental business complexity.</p></li><li><p>On the other hand, if it enhances the company’s profitability, it’s a sign of a supporting subdomain becoming a core subdomain.</p></li></ul></div></div></section><section id="_migration_from_core_to_supporting"><h2>Migration from Core to Supporting</h2><div class="slide-content"><div class="ulist"><ul><li><p>A core subdomain can, over time, become a supporting subdomain.</p></li><li><p>This can happen when the subdomain’s complexity isn’t justified.</p></li><li><p>In other words, it’s not profitable.</p></li><li><p>In such cases, the organization may decide to cut the extraneous complexity, leaving the minimum logic needed to support implementation of other subdomains.</p></li></ul></div></div></section><section id="_migration_from_generic_to_supporting"><h2>Migration from Generic to Supporting</h2><div class="slide-content"><div class="ulist"><ul><li><p>For the same reason as a core subdomain, a generic subdomain can turn into a supporting one.</p></li><li><p>Assume your company has decided that the complexity of integrating the open source solution doesn’t justify the benefits and has resorted back to the in-house system.</p></li><li><p>As a result, the generic subdomain has turned into a supporting subdomain.</p></li></ul></div></div></section><section id="_evolving_strategies"><h2>Evolving Strategies</h2><div class="slide-content"><div class="imageblock"><img src="./images/evolving_strategies.png" alt="evolving strategies"></div></div></section><section id="_strategic_concerns_for_core_subdomains"><h2>Strategic Concerns for Core Subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>A change in a subdomain’s type directly affects its bounded context and, consequently, corresponding strategic design decisions</p></li><li><p>Different bounded context integration patterns accommodate the different subdomain types</p></li><li><p>The core subdomains have to protect their models by using anticorruption layers and have to protect consumers from frequent changes in the implementation models by using published languages</p></li></ul></div></div></section><section id="_strategic_concerns_for_supporting_and_generic_subdomains"><h2>Strategic Concerns for Supporting and Generic Subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>Teams can use the separate ways pattern for supporting and generic subdomains</p></li><li><p>If the subdomain morphs into a core subdomain, duplicating its functionality by multiple teams is no longer acceptable.</p></li><li><p>Teams must have no choice but to integrate their implementations</p></li><li><p>The customer–supplier relationship will make the most sense in this case</p></li></ul></div></div></section><section id="_how_subdomains_are_implemented"><h2>How Subdomains are Implemented</h2><div class="slide-content"><div class="ulist"><ul><li><p>Supporting subdomains can be outsourced or used as “training wheels” for new hires.</p></li><li><p>Core subdomains must be implemented in-house, as close as possible to the sources of domain knowledge.</p></li></ul></div></div></section><section id="_tactical_design_concerns"><h2>Tactical Design Concerns</h2><div class="slide-content"><div class="ulist"><ul><li><p>Supporting subdomains are implemented with relatively simple design patterns for modeling the business logic: namely, the transaction script or active record pattern</p></li><li><p>These patterns are not a good fit for business logic involving complex rules and invariants.</p></li><li><p>If complicated rules and invariants are added to the business logic over time, the codebase will become increasingly complex as well.</p></li><li><p>It will be painful to add the new functionality, as the design won’t support the new level of complexity.</p></li><li><p><strong> This “pain” is an important signal, and we need evolve as needed</strong></p></li></ul></div></div></section><section id="_transaction_script_to_active_record"><h2>Transaction Script to Active Record</h2><div class="slide-content"><div class="ulist"><ul><li><p>Both the transaction script and active record patterns are based on the same principle: the business logic is implemented as a procedural script.</p></li><li><p>The difference between them is how the data structures are modeled: the active record pattern introduces the data structures to encapsulate the complexity of mapping them to the storage mechanism.</p></li><li><p>As a result, when working with data becomes challenging in a transaction script, refactor it into the active record pattern. Look for complicated data structures and encapsulate them in active record objects.</p></li><li><p>Instead of accessing the database directly, use active records to abstract its model and structure.</p></li></ul></div></div></section><section id="_active_record_to_domain_model"><h2>Active Record to Domain Model</h2><div class="slide-content"><div class="ulist"><ul><li><p>If the business logic that manipulates active records becomes complex and you notice more and more cases of inconsistencies and duplications, refactor the implementation to the domain model pattern.</p></li><li><p>Start by identifying value objects. What data structures can be modeled as immutable objects? Look for the related business logic, and make it a part of the value objects as well.</p></li><li><p>Analyze the data structures and look for transactional boundaries.</p></li><li><p>Obviously, expect the compilation to fail; however, the compilation errors will make it clear where the state-modifying logic resides. Refactor it into the active record’s boundaries</p></li></ul></div></div></section><section id="_domain_model_to_event_sourced_domain_model"><h2>Domain Model to Event-Sourced Domain Model</h2><div class="slide-content"><div class="ulist"><ul><li><p>Once you have a domain model with properly designed aggregate boundaries, you can transition it to the event-sourced model.</p></li><li><p>Instead of modifying the aggregate’s data directly, model the domain events needed to represent the aggregate’s lifecycle.</p></li><li><p>The most challenging aspect of refactoring a domain model into an event-sourced domain model is the history of the existing aggregates: migrating the “timeless” state into the event-based model.</p></li><li><p>Since the fine-grained data representing all the past state changes is not there, you have to either generate past events on a best-effort basis or model migration events.</p></li></ul></div></div></section><section id="_generating_transitions"><h2>Generating Transitions</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Field</th><th class="tableblock halign-left valign-top">Value</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">lead-in</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">first-name</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Shauna</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">last-name</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Mercia</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">converted</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">last-contacted-on</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">2020-05-27T12:02:12.51Z</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">order-placed-on</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">2020-05-27T12:02:12.51Z</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">converted-on</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">2020-05-27T12:02:12.51Z</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">followup-on</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td></tr></table></div></section><section id="_can_we_surmise_the_history"><h2>Can we surmise the history?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Given the above can we surmise what created the final result?</p></li><li><p>The person has been contacted, an order has been placed, and finally, since the status was “converted,” the payment for the order has been confirmed</p></li><li><p>This approach is not perfect, for example, we don&#8217;t know how many times this person has been contacted</p></li></ul></div></div></section><section id="_surmising_the_history_result"><h2>Surmising the history result</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">[{
    "lead-id": 12,
    "event-id": 0,
    "event-type": "lead-initialized",
    "first-name": "Shauna",
    "last-name": "Mercia",
    "phone-number": "555-4753"
},
{
    "lead-id": 12,
    "event-id": 1,
    "event-type": "contacted",
    "timestamp": "2020-05-27T12:02:12.51Z"
},
{
    "lead-id": 12,
    "event-id": 2,
    "event-type": "order-submitted",
    "payment-deadline": "2020-05-30T12:02:12.51Z",
    "timestamp": "2020-05-27T12:02:12.51Z"
},
{
    "lead-id": 12,
    "event-id": 3,
    "event-type": "payment-confirmed",
    "status": "converted",
    "timestamp": "2020-05-27T12:38:44.12Z"
}]</code></pre></div></div></div></section><section id="_creating_a_migration_event"><h2>Creating a migration event</h2><div class="slide-content"><div class="ulist"><ul><li><p>The alternative approach is to acknowledge the lack of knowledge about past events and explicitly model it as an event.</p></li><li><p>Instead of recovering the events that may have led to the current state, define a migration event and use it to initialize the event streams of existing aggregate instances</p></li><li><p>This makes the lack of past data explicit. At no stage can someone mistakenly assume that the event stream captures all of the domain events that happened during the aggregate instance’s lifecycle.</p></li></ul></div></div></section><section id="_migration_event_example"><h2>Migration Event Example</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
    "lead-id": 12,
    "event-id": 0,
    "event-type": "migrated-from-legacy",
    "first-name": "Shauna",
    "last-name": "Mercia",
    "phone-number": "555-4753",
    "status": "converted",
    "last-contacted-on": "2020-05-27T12:02:12.51Z",
    "order-placed-on": "2020-05-27T12:02:12.51Z",
    "converted-on": "2020-05-27T12:38:44.12Z",
    "followup-on": null
}</code></pre></div></div></div></section><section id="_organizational_changes"><h2>Organizational Changes</h2><div class="slide-content"><div class="ulist"><ul><li><p>Another change is the organization</p></li><li><p>Changes in the organization’s structure can affect teams’ communication and collaboration levels and, as a result, the ways the bounded contexts should be integrated.</p></li></ul></div>
<div class="imageblock"><img src="./images/migrating_to_new_team.png" alt="migrating to new team"></div></div></section><section id="_geographical_migration"><h2>Geographical Migration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Moreover, the organization’s development centers are often located in different geographical locations.</p></li><li><p>When the work on the existing bounded contexts is shifted to another location, it may negatively impact the teams’ collaboration.</p></li><li><p>As a result, the bounded contexts’ integration patterns have to evolve accordingly</p></li></ul></div></div></section><section id="_partnership_to_customersupplier"><h2>Partnership to Customer–Supplier</h2><div class="slide-content"><div class="ulist"><ul><li><p>The partnership pattern assumes there is strong communication and collaboration among teams.</p></li><li><p>As time goes by, that might cease to be the case; for example, when work on one of the bounded contexts is moved to a distant development center</p></li><li><p>Such a change will negatively affect the teams’ communication, and it may make sense to move away from the partnership pattern toward a customer–supplier relationship.</p></li></ul></div></div></section><section id="_customersupplier_to_separate_ways"><h2>Customer–Supplier to Separate Ways</h2><div class="slide-content"><div class="ulist"><ul><li><p>Unfortunately, it’s not uncommon for teams to have severe communication problems.</p></li><li><p>The issues might be caused by geographical distance or organizational politics.</p></li><li><p>Such teams may experience more and more integration issues over time.</p></li><li><p>At some point, it may become more cost-effective to duplicate the functionality instead of continuously chasing one another’s tails.</p></li></ul></div></div></section><section id="_domain_knowledge"><h2>Domain Knowledge</h2><div class="slide-content"><div class="ulist"><ul><li><p>From a strategic design standpoint, it’s a useful heuristic to design the bounded contexts’ boundaries according to the level of domain knowledge.</p></li><li><p>The cost of decomposing a system into bounded contexts that, over time, turn out to be incorrect can be high.</p></li><li><p>Therefore, when the domain logic is unclear and changes often, it makes sense to design the bounded contexts with <strong>broader boundaries</strong>.</p></li><li><p>Then, as domain knowledge is discovered over time and changes to the business logic stabilize, those broad bounded contexts can be decomposed into contexts with narrower boundaries, or microservices</p></li></ul></div></div></section><section id="_growth"><h2>Growth</h2><div class="slide-content"><div class="ulist"><ul><li><p>Growth will happen, regardless, and unplanned growth can lead back into a big ball of mud</p></li><li><p>Growth blows up the components’ boundaries, increasingly extending their functionality.</p></li><li><p>It’s crucial to examine the effects of growth on design decisions, especially since many domain-driven design tools are all about setting boundaries: business building blocks (subdomains), model (bounded contexts), immutability (value objects), or consistency (aggregates).</p></li></ul></div></div></section><section id="_growth_in_subdomains"><h2>Growth in subdomains</h2><div class="slide-content"><div class="ulist"><ul><li><p>As the business domain grows, the subdomains’ boundaries can become even more blurred, making it harder to identify cases of a subdomain spanning multiple, finer-grained subdomains.</p></li><li><p>Hence, it’s important to revisit the identified subdomains and follow the heuristic of coherent use cases (sets of use cases working on the same set of data) to try to identify where to split a subdomain</p></li><li><p>Identify finer-grained subdomains of different types, this is an important insight that will allow you to manage the business domain’s essential complexity, especially for core subdomains where you will want to focus on competitive advantage</p></li></ul></div>
<div class="imageblock"><img src="./images/splitting_subdomains.png" alt="splitting subdomains"></div></div></section><section id="_growth_in_bounded_contexts"><h2>Growth in Bounded Contexts</h2><div class="slide-content"><div class="ulist"><ul><li><p>It’s not uncommon for the bounded contexts to lose their focus and accumulate logic related to different problems. That’s accidental complexity</p></li><li><p>Revisit the bounded contexts’ boundaries from time to time</p></li><li><p>Bounded contexts that are chatty with one another may be a sign that it requires revisiting</p></li></ul></div></div></section><section id="_growth_in_aggregates"><h2>Growth in Aggregates</h2><div class="slide-content"><div class="ulist"><ul><li><p>Reminder: "Keep the aggregates as small as possible and include only objects that are required to be in a strongly consistent state by the business domain"</p></li><li><p>If an aggregate grows to include data that is not needed to be strongly consistent by all of its business logic, again, that’s accidental complexity that has to be eliminated</p></li><li><p>Extracting business functionality into a dedicated aggregate not only simplifies the original aggregate, but potentially can simplify the bounded context it belongs to</p></li></ul></div></div></section></section>
<section><section id="_microservices_application"><h2>Microservices [Application]</h2></section><section id="_service"><h2>Service</h2><div class="slide-content"><div class="ulist"><ul><li><p>A service is a mechanism that enables access to one or more capabilities, where the access is provided using a prescribed interface</p></li><li><p>The prescribed interface is any mechanism for getting data in or out of a service.</p></li><li><p>It can be synchronous, such as a request/response model, or asynchronous, such as a model that is producing and consuming events.</p></li></ul></div>
<div class="imageblock"><img src="./images/service_communication.png" alt="service communication"></div></div></section><section id="_describing_a_service"><h2>Describing a Service</h2><div class="slide-content"><div class="paragraph"><p>A well-expressed interface is enough to describe the functionality implemented by a service</p></div>
<div class="imageblock"><img src="./images/well_described_service.png" alt="well described service"></div></div></section><section id="_microservice"><h2>Microservice</h2><div class="slide-content"><div class="ulist"><ul><li><p>Smaller scale of a service</p></li><li><p>Smaller interface makes it easier to understand both the function of a single service and its integration with other system components.</p></li><li><p>Reducing a service’s functionality also limits its reasons for change and makes the service more autonomous for development, management, and scale</p></li></ul></div></div></section><section id="_microservice_encapsulates_databases"><h2>Microservice encapsulates databases</h2><div class="slide-content"><div class="ulist"><ul><li><p>Hence, microservices encapsulate their databases.</p></li><li><p>The data can only be accessed through a much more compact, integration-oriented public interface.</p></li></ul></div></div></section><section id="_decomposition_to_microservices"><h2>Decomposition to Microservices</h2><div class="slide-content"><div class="ulist"><ul><li><p>Decomposing is taking large service and decomposing into more fine-grained services</p></li><li><p>Decomposing is difficult, but you can use business cases, domains, and bounded contexts to guide how to decompose</p></li></ul></div></div></section><section id="_too_small_decomposition"><h2>Too Small Decomposition</h2><div class="slide-content"><div class="paragraph"><p>Given the following decomposition, what would the end result be?</p></div>
<div class="imageblock"><img src="./images/naive_decomposition.png" alt="naive decomposition"></div></div></section><section id="_the_result_of_going_too_small"><h2>The Result of going too small</h2><div class="slide-content"><div class="imageblock"><img src="./images/big_ball_mud_microservices.png" alt="big ball mud microservices" width="40%" height="40%"></div></div></section><section id="_the_problem_with_too_small_microservices"><h2>The Problem with too small microservices</h2><div class="slide-content"><div class="ulist"><ul><li><p>You would need to offer an exposition of "database" calls since databases are not exposed</p></li><li><p>That exposition causes many "backdoors" to implement</p></li></ul></div></div></section><section id="_microservice_goals"><h2>Microservice Goals</h2><div class="slide-content"><div class="ulist"><ul><li><p>With the big ball of mud: Each service ended up being much simpler than the original design, however the resultant system became orders of magnitude more complex.</p></li><li><p>The goal of the microservices architecture is to produce a flexible system.</p></li><li><p>In a proper microservices-based system, however decoupled, the services still have to be integrated and communicate with each other.</p></li></ul></div></div></section><section id="_local_vs_global_complexity"><h2>Local vs. Global Complexity</h2><div class="slide-content"><div class="ulist"><ul><li><p><em>Local complexity</em> is the complexity of each individual microservice</p></li><li><p><em>Global complexity</em> is the complexity of the whole system.</p></li></ul></div></div></section><section id="_local_vs_global_tradeoff"><h2>Local vs. Global Tradeoff</h2><div class="slide-content"><div class="paragraph"><p>To design a proper microservices-based system, we have to optimize both global and local complexities. Setting the design goal of optimizing either one individually is a local optima. The global optima balances both complexities</p></div>
<div class="imageblock"><img src="./images/local_global_tradeoff.png" alt="local global tradeoff"></div></div></section><section id="_deep_microservices"><h2>Deep Microservices</h2><div class="slide-content"><div class="ulist"><ul><li><p>A <em>function</em> is what the module is supposed to do—its business functionality.</p></li><li><p>The <em>logic</em> is the module’s business logic—how the module implements its business functionality</p></li></ul></div>
<div class="imageblock"><img src="./images/deep_modularity.png" alt="deep modularity"></div></div></section><section id="_microservices_and_modularity"><h2>Microservices and Modularity</h2><div class="slide-content"><div class="ulist"><ul><li><p>Shallow services are also the reason why so many microservices-oriented projects fail</p></li><li><p>If we decompose a monolith into services, the cost of introducing a change goes down. It is minimized when the system is decomposed into microservices</p></li><li><p>However, if you keep decomposing past the microservices threshold, the deep services will become more and more shallow. Their interfaces will grow back up</p></li><li><p>This time, due to integration needs, the cost of introducing a change will go up as well, and the overall system’s architecture will turn into the dreaded distributed big ball of mud</p></li></ul></div></div></section><section id="_cost_of_change"><h2>Cost of Change</h2><div class="slide-content"><div class="imageblock"><img src="./images/cost_of_change.png" alt="cost of change"></div></div></section><section id="_domain_driven_design_and_microservices"><h2>Domain Driven Design and Microservices</h2></section><section id="_microservices_and_bounded_contexts"><h2>Microservices and Bounded Contexts</h2><div class="slide-content"><div class="ulist"><ul><li><p>The microservices and bounded context patterns have a lot in common, so much so that the patterns are often used interchangeably.</p></li><li><p>Both microservices and bounded contexts are physical boundaries.</p></li><li><p>Microservices, as bounded contexts, are owned by a single team.</p></li><li><p>But does this relationship work the other way around? Can we say that bounded contexts are microservices?</p></li></ul></div></div></section><section id="_bounded_contexts_review"><h2>Bounded Contexts Review</h2><div class="slide-content"><div class="ulist"><ul><li><p>Bounded contexts protect the consistency of ubiquitous languages and models.</p></li><li><p>No conflicting models can be implemented in the same bounded context.</p></li><li><p>Say you are working on an advertising management system.</p></li><li><p>In the system’s business domain, the business entity <code>Lead</code> is represented by different models in the Promotions and Sales contexts.</p></li><li><p>Hence, Promotions and Sales are bounded contexts, each defining one and only one model of the Campaign entity, which is valid in its boundary</p></li></ul></div></div></section><section id="_different_lead"><h2>Different <code>Lead</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>This makes the resultant bounded contexts naturally wide—each bounded context can contain <em>multiple subdomains</em></p></li><li><p>The subdomains can be moved from one bounded context to another one.</p></li><li><p>As long as the subdomains do not imply conflicting models,</p></li></ul></div>
<div class="imageblock"><img src="./images/different_lead.png" alt="different lead"></div></div></section><section id="_alternative_decompositions"><h2>Alternative Decompositions</h2><div class="slide-content"><div class="imageblock"><img src="./images/alternative_decompositions.png" alt="alternative decompositions"></div></div></section><section id="_different_bounded_contexts"><h2>Different Bounded Contexts</h2><div class="slide-content"><div class="ulist"><ul><li><p>The different decompositions to bounded contexts attribute different requirements, such as different teams’ sizes and structures, lifecycle dependencies, and so on.</p></li><li><p><strong>But can we say that all the valid bounded contexts in this example are necessarily microservices? No</strong></p></li><li><p>Especially considering the relatively wide functionalities of the two bounded contexts in decomposition</p></li></ul></div></div></section><section id="_bounded_contexts_and_microservices"><h2>Bounded Contexts and Microservices?</h2><div class="slide-content"><div class="ulist"><ul><li><p>Therefore, the relationship between microservices and bounded contexts is not symmetric.</p></li><li><p><strong>Although microservices are bounded contexts, not every bounded context is a microservice</strong></p></li><li><p>Bounded contexts, on the other hand, denote the boundaries of the largest valid monolith (not be confused with big ball of mud)</p></li></ul></div></div></section><section id="_are_aggregates_better_for_microservices"><h2>Are aggregates better for microservices?</h2><div class="slide-content"><div class="ulist"><ul><li><p>While bounded contexts impose limits on the widest valid boundaries, the aggregate pattern does the opposite.</p></li><li><p>The aggregate’s boundary is the narrowest boundary possible.</p></li><li><p>Decomposing an aggregate into multiple physical services, or bounded contexts, is not only suboptimal but, leads to undesired consequences</p></li></ul></div></div></section><section id="_are_subdomains_better_for_microservices"><h2>Are subdomains better for microservices?</h2><div class="slide-content"><div class="ulist"><ul><li><p>A more balanced heuristic for designing microservices is to align the services with the boundaries of business subdomains</p></li><li><p>Subdomains are correlated with fine-grained business capabilities.</p></li><li><p>From a technical standpoint, subdomains represent sets of coherent use cases: using the same model of the business domain, working on the same or closely related data, and having a strong functional relationship.</p></li><li><p>The subdomains’ granularity and the focus on the functionality—the “what” rather than the “how”—makes subdomains naturally deep modules.</p></li></ul></div></div></section><section id="_subdomains_and_microservices"><h2>Subdomains and microservices</h2><div class="slide-content"><div class="imageblock"><img src="./images/subdomains_microservices.png" alt="subdomains microservices"></div></div></section><section id="_open_host_service_for_microservices"><h2>Open Host Service for Microservices</h2><div class="slide-content"><div class="ulist"><ul><li><p>Introducing the integration-oriented model, the published language, reduces the system’s global complexity.</p></li><li><p>First, it allows us to evolve the service’s implementation without impacting its consumers: the new implementation model can be translated to the existing published language.</p></li><li><p>Second, the published language exposes a more restrained model. It is designed around integration needs.</p></li><li><p>It encapsulates the complexity of the implementation that is not relevant to the service’s consumers.</p></li><li><p>For example, it can expose less data and in a more convenient model for consumers.</p></li><li><p>Having a simpler public interface (function) over the same implementation (logic) makes the service “deeper” and contributes to a more effective microservice design.</p></li></ul></div></div></section><section id="_published_language_2"><h2>Published Language</h2><div class="slide-content"><div class="imageblock"><img src="./images/published_language.png" alt="published language"></div></div></section><section id="_anti_corruption_layer_2"><h2>Anti-Corruption Layer</h2><div class="slide-content"><div class="ulist"><ul><li><p>The anticorruption layer (ACL) pattern works the other way around.</p></li><li><p>It reduces the complexity of integrating the service with other bounded contexts.</p></li><li><p>The consuming bounded context’s business complexity is separated from the integration complexity.
The latter is offloaded to the ACL service. Because the consuming bounded context is working with a more convenient, integration-oriented model, its public interface is compressed</p></li></ul></div></div></section><section id="_anti_corruption_layer_3"><h2>Anti-Corruption Layer</h2><div class="slide-content"><div class="imageblock"><img src="./images/acl_microservice.png" alt="acl microservice"></div></div></section><section id="_domain_subdomain_context"><h2>Domain, Subdomain, Context</h2><div class="slide-content"><div class="imageblock"><img src="./images/domain_subdomain_context.jpeg" alt="domain subdomain context" width="70%" height="70%"></div></div></section></section>
<section><section id="_event_driven_architecture_application"><h2>Event Driven Architecture [Application]</h2></section><section id="_event_driven_architecture"><h2>Event Driven Architecture</h2><div class="slide-content"><div class="ulist"><ul><li><p>Architectural style in which a system’s components communicate with one another asynchronously by exchanging event message</p></li><li><p>Instead of calling the services’ endpoints synchronously, the components publish events to notify other system elements of changes in the system’s domain.</p></li><li><p>The components can subscribe to events raised in the system and react accordingly</p></li></ul></div>
<div class="imageblock"><img src="./images/event_driven_arch.png" alt="event driven arch"></div></div></section><section id="_event_sourcing_vs_event_driven_architecture"><h2>Event Sourcing vs. Event Driven Architecture</h2><div class="slide-content"><div class="ulist"><ul><li><p>Event Driven Architecture (EDA) refers to the communication between services</p></li><li><p>Event sourcing happens inside a service</p></li><li><p>The events designed for event sourcing represent state transitions (of aggregates in an event-sourced domain model) implemented in the service and capturing intricacies of the business domain</p></li></ul></div></div></section><section id="_two_type_of_messages"><h2>Two type of messages</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Event</dt><dd><p>A message describing a change that has already happened</p></dd><dt class="hdlist1">Command</dt><dd><p>A message describing an operation that has to be carried out</p></dd></dl></div></div></section><section id="_rules_for_the_messages"><h2>Rules for the messages</h2><div class="slide-content"><div class="ulist"><ul><li><p>Both events and commands can be communicated asynchronously as messages</p></li><li><p>A command can be rejected, and refuse to execute the command</p></li><li><p>A recipient of an event, on the other hand, cannot cancel the event</p></li></ul></div></div></section><section id="_events_are_past_tense"><h2>Events are past tense</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Since an event describes something that has already happened, an event’s name should be formulated in the past tense</dt><dd><div class="ulist"><ul><li><p>DeliveryScheduled</p></li><li><p>ShipmentCompleted</p></li><li><p>DeliveryConfirmed</p></li></ul></div></dd></dl></div></div></section><section id="_structure"><h2>Structure</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
    "type": "delivery-confirmed",
    "event-id": "14101928-4d79-4da6-9486-dbc4837bc612",
    "correlation-id": "08011958-6066-4815-8dbe-dee6d9e5ebac",
    "delivery-id": "05011927-a328-4860-a106-737b2929db4e",
    "timestamp": 1615718833,
    "payload": {
        "confirmed-by": "17bc9223-bdd6-4382-954d-f1410fd286bd",
        "delivery-time": 1615701406
    }
}</code></pre></div></div>
<div class="ulist"><ul><li><p>A typical event schema includes the event’s metadata and its payload—the information communicated by the event</p></li><li><p>An event’s payload not only describes the information conveyed by the event, but also defines the event’s type</p></li></ul></div></div></section><section id="_types_of_events"><h2>Types of Events</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Events can be categorized into one of three types</dt><dd><div class="ulist"><ul><li><p>Event notification</p></li><li><p>Event-carried state transfer</p></li><li><p>Domain events</p></li></ul></div></dd></dl></div></div></section><section id="_event_notification"><h2>Event Notification</h2><div class="slide-content"><div class="ulist"><ul><li><p>Message regarding a change in the business domain that other components will react to</p></li><li><p>Examples include:</p><div class="ulist"><ul><li><p><code>PaycheckGenerated</code></p></li><li><p><code>CampaignPublished</code></p></li></ul></div></li><li><p>Event notification should not be verbose</p></li><li><p>The goal is to notify the interested parties about the event and shouldn’t carry all the information needed for the subscribers to react to the event</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
    "type": "paycheck-generated",
    "event-id": "537ec7c2-d1a1-2005-8654-96aee1116b72",
    "delivery-id": "05011927-a328-4860-a106-737b2929db4e",
    "timestamp": 1615726445,
    "payload": {
        "employee-id": "456123",
        "link": "/paychecks/456123/2021/01"
    }
}</code></pre></div></div></div></section><section id="_event_notification_2"><h2>Event Notification</h2><div class="slide-content"><div class="ulist"><ul><li><p>Event notifies the external components of a paycheck that was generated.</p></li><li><p>It doesn’t carry all the information related to the paycheck.</p></li><li><p>Instead, the receiver can use the link to fetch more detailed information</p></li></ul></div>
<div class="imageblock"><img src="./images/paycheck_notification.png" alt="paycheck notification"></div></div></section><section id="_benefits_to_event_notification"><h2>Benefits to Event Notification</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Security</dt><dd><p>Enforcing the recipient to explicitly query for the detailed information prevents sharing sensitive information over the messaging infrastructure and requires additional authorization of the subscribers to access the data.</p></dd><dt class="hdlist1">Concurrency</dt><dd><p>If information is rendered with the message, the message content will become stale, querying it will retain up-to-date state. This can also include <em>pessimistic locking</em> where no other consumer can process the same message.</p></dd></dl></div></div></section><section id="_event_carried_state_transfer"><h2>Event Carried State Transfer</h2><div class="slide-content"><div class="ulist"><ul><li><p>Event-carried state transfer (ECST) messages notify subscribers about changes in the producer’s internal state</p></li><li><p>ECST messages on the other hand include all the data reflecting the change in the state.</p></li></ul></div></div></section><section id="_ecst_complete_data"><h2>ECST Complete Data</h2><div class="slide-content"><div class="paragraph"><p>One form of ECST is holding the complete data</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
    "type": "customer-updated",
    "event-id": "6b7ce6c6-8587-4e4f-924a-cec028000ce6",
    "customer-id": "01b18d56-b79a-4873-ac99-3d9f767dbe61",
    "timestamp": 1615728520,
    "payload": {
        "first-name": "Carolyn",
        "last-name": "Hayes",
        "phone": "555-1022",
        "status": "follow-up-set",
        "follow-up-date": "2021/05/08",
        "birthday": "1982/04/05",
        "version": 7
    }
}</code></pre></div></div></div></section><section id="_ecst_only_the_modified_data"><h2>ECST Only the Modified Data</h2><div class="slide-content"><div class="paragraph"><p>Another strategy is to only hold the data that has been modified</p></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">{
    "type": "customer-updated",
    "event-id": "6b7ce6c6-8587-4e4f-924a-cec028000ce6",
    "customer-id": "01b18d56-b79a-4873-ac99-3d9f767dbe61",
    "timestamp": 1615728520,
    "payload": {
        "status": "follow-up-set",
        "follow-up-date": "2021/05/10",
        "version": 8
    }
}</code></pre></div></div></div></section><section id="_caching_in_event_driven_architecture"><h2>Caching in Event Driven Architecture</h2><div class="slide-content"><div class="ulist"><ul><li><p>Whether ECST messages include complete snapshots or only the updated fields, a stream of such events allows consumers to hold a local cache of the entities’ states and work with it</p></li><li><p>Conceptually, using event-carried state transfer messages is an asynchronous data replication mechanism.</p></li><li><p>This approach makes the system more fault tolerant, meaning that the consumers can continue functioning even if the producer is not available</p></li></ul></div></div></section><section id="_example_of_caching_in_event_driven_architecture"><h2>Example of Caching in Event Driven Architecture</h2><div class="slide-content"><div class="imageblock"><img src="./images/ecst_caching.png" alt="ecst caching"></div></div></section><section id="_domain_events_2"><h2>Domain Events</h2><div class="slide-content"><div class="ulist"><ul><li><p>Halfway between event notifications and ECST messages</p></li><li><p>Both domain events and event notifications describe changes in the producer’s business domain</p></li><li><p><em>Domain events include all the information describing the event</em></p></li><li><p>Domain events are intended to model and describe the business domain</p></li><li><p>In event-sourced systems, domain events are used to model all possible state transitions</p></li></ul></div></div></section><section id="_event_carried_state_transfer_vs_domain_events"><h2>Event-Carried State Transfer vs Domain Events</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">Event-Carried State Transfer</dt><dd><p>Sufficient Information to hold in a local cache and is often the aggregate</p></dd><dt class="hdlist1">Domain-Events</dt><dd><p>Not intended to describe any aggregate state, but the event that just happened</p></dd></dl></div></div></section><section id="_event_comparison_event_notification"><h2>Event Comparison : Event Notification</h2><div class="slide-content"><div class="ulist"><ul><li><p>Event notification message.</p></li><li><p>It contains no information except the fact that the person with the specified ID got married.</p></li><li><p>It contains minimal information about the event</p></li><li><p>Consumers interested in more details will have to follow the link in the details field.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">eventNotification = {
    "type": "marriage-recorded",
    "person-id": "01b9a761",
    "payload": {
        "person-id": "126a7b61",
        "details": "/01b9a761/marriage-data"
    }
};</code></pre></div></div></div></section><section id="_event_comparison_event_carried_state_transfer_message"><h2>Event Comparison : Event Carried State Transfer Message</h2><div class="slide-content"><div class="ulist"><ul><li><p>Event Carried State Transfer Message</p></li><li><p>Describes the changes in the person’s personal details (last name)</p></li><li><p>Message doesn&#8217;t describe the reason for the change</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">ecst = {
    "type": "personal-details-changed",
    "person-id": "01b9a761",
    "payload": {
        "new-last-name": "Williams"
    }
};</code></pre></div></div></div></section><section id="_event_comparison_domain_event"><h2>Event Comparison: Domain Event</h2><div class="slide-content"><div class="ulist"><ul><li><p>Domain Event</p></li><li><p>Modeled as close as possible to the nature of the event in the business domain.</p></li><li><p>It includes the person’s ID and a flag indicating whether the person assumed their partner’s name.</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-noescape="true" data-lang="json">domainEvent = {
    "type": "married",
    "person-id": "01b9a761",
    "payload": {
        "person-id": "126a7b61",
        "assumed-partner-last-name": true
    }
};</code></pre></div></div></div></section><section id="_designing_event_driven_integration"><h2>Designing Event Driven Integration</h2><div class="slide-content"><div class="ulist"><ul><li><p>The events in an EDA-based system are first-class design elements</p></li><li><p>They affect both how the components are integrated and the components’ boundaries themselves.</p></li><li><p>Choosing the correct type of event message is what makes (decouples) or breaks (couples) a distributed system</p></li></ul></div></div></section><section id="_refactoring_a_big_ball_of_mud"><h2>Refactoring a Big Ball of Mud</h2><div class="slide-content"><div class="imageblock"><img src="./images/strong_ball_of_mud.png" alt="strong ball of mud"></div></div></section><section id="_issues_in_the_previous_image"><h2>Issues in the previous image</h2><div class="slide-content"><div class="ulist"><ul><li><p><strong>Marketing</strong> bounded context ingests a <em>domain event</em> which is heavy, and has to create a projection or enrichment</p></li><li><p><strong>AdsOptimization</strong> bounded context ingests a <em>domain event</em>, and say, creates the same projection</p></li><li><p><strong>Reporting</strong> bounded context also ingests the <em>domain event</em>, but needs to wait for <strong>AdOptimization</strong> to complete after a certain time, before processing it&#8217;s payload</p></li></ul></div></div></section><section id="_three_coupling_issues"><h2>Three coupling issues</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">There are three coupling issues with this architecture</dt><dd><div class="ulist"><ul><li><p>Temporal Coupling</p></li><li><p>Functional Coupling</p></li><li><p>Implementation Coupling</p></li></ul></div></dd></dl></div></div></section><section id="_temporal_coupling"><h2>Temporal Coupling</h2><div class="slide-content"><div class="ulist"><ul><li><p>AdsOptimization and Reporting bounded contexts are temporally coupled</p></li><li><p>They depend on strict order of execution</p></li><li><p>AdsOptimization has to <em>finish before</em> the Reporting module is triggered</p></li><li><p>If reporting triggers first then there is inconsistent data, particularly if AdsOptimization is backed up</p></li><li><p>The delay may not work all the time, given a 5-minute delay:</p><div class="ulist"><ul><li><p>AdsOptimization may be overloaded and unable to finish</p></li><li><p>A network issue may delay the delivery of incoming messages to the AdsOptimization service</p></li><li><p>AdsOptimization component can experience an outage and stop processing incoming messages.</p></li></ul></div></li></ul></div></div></section><section id="_functional_coupling"><h2>Functional Coupling</h2><div class="slide-content"><div class="ulist"><ul><li><p>Marketing and AdsOptimization bounded contexts both subscribed to the CRM’s domain events and ended up implementing the same projection or enrichment of the customers’ data! This is a <strong>duplication</strong>!</p></li><li><p><strong>If the projection was changed in one of the components, the change had to be replicated in the second bounded context!</strong></p></li></ul></div></div></section><section id="_implementation_coupling"><h2>Implementation Coupling</h2><div class="slide-content"><div class="ulist"><ul><li><p>The Marketing and AdsOptimization bounded contexts are subscribed to all the domain events generated by the CRM’s event-sourced model</p></li><li><p>Consequently, a change in the CRM’s implementation, such as:</p><div class="ulist"><ul><li><p>Adding a new domain event</p></li><li><p>Changing the schema of an existing one</p></li><li><p>Changes has to be reflected in both, Marketing and AdOptimization bounded context</p></li></ul></div></li><li><p>Ignoring changes can lead to inconsistent data and state</p></li></ul></div></div></section><section id="_refactoring_event_driven_integration"><h2>Refactoring Event Driven Integration</h2><div class="slide-content"><div class="imageblock"><img src="./images/refactored_architecture.png" alt="refactored architecture"></div></div></section><section id="_refactoring_event_driven_integration_2"><h2>Refactoring Event Driven Integration</h2><div class="slide-content"><div class="ulist"><ul><li><p>Encapsulated the projection/enrichment in the producer, the CRM bounded context</p></li><li><p>Message type changed from a <em>domain event</em> to a <em>event carried state transfer</em> message</p></li><li><p>Reporting Bounded Context now receives an event notification where it can fetch the state</p></li></ul></div></div></section><section id="_event_driven_design_heuristics"><h2>Event Driven Design Heuristics</h2><div class="slide-content"><div class="ulist"><ul><li><p>Matching appropriate types of events to the tasks at hand makes the resultant design orders of magnitude less coupled, more flexible, and fault tolerant.</p></li><li><p>Some basic heuristics:</p><div class="ulist"><ul><li><p>Assume the worst</p></li><li><p>Use public and private events</p></li><li><p>Evaluated consistency requirements</p></li></ul></div></li></ul></div></div></section><section id="_assume_the_worst"><h2>Assume the Worst</h2><div class="slide-content"><div class="ulist"><ul><li><p>The network is going to be slow.</p></li><li><p>Servers will fail at the most inconvenient moment.</p></li><li><p>Events will arrive out of order.</p></li><li><p>Events will be duplicated.</p></li></ul></div></div></section><section id="_avoid_the_worst"><h2>Avoid the Worst</h2><div class="slide-content"><div class="ulist"><ul><li><p>Use the <a href="https://microservices.io/patterns/data/transactional-outbox.html" target="_blank">outbox pattern</a> to publish messages reliably.</p></li><li><p>When publishing messages, ensure that the subscribers will be able to deduplicate the messages and identify and reorder out-of-order messages.</p></li><li><p>Leverage the <a href="https://microservices.io/patterns/data/saga.html" target="_blank">saga</a> and <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/ProcessManager.html" target="_blank">process manager</a> patterns when orchestrating cross-bounded context processes that require issuing compensating actions.</p></li></ul></div></div></section><section id="_use_public_and_private_events"><h2>Use Public and Private Events</h2><div class="slide-content"><div class="ulist"><ul><li><p>Be wary of exposing implementation details when publishing domain events, especially in event-sourced aggregates</p></li><li><p>Event-carried state transfer messages compress the implementation model into a more compact model that communicates only the information the consumers need</p></li><li><p>Event notification messages can be used to further minimize the public interface</p></li><li><p>Sparingly use domain events for communication with external bounded contexts</p></li></ul></div></div></section><section id="_evaluate_consistency_requirements"><h2>Evaluate Consistency Requirements</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">When designing event-driven communication, evaluate the bounded contexts’ consistency requirements as an additional heuristic for choosing the event type</dt><dd><div class="ulist"><ul><li><p>If the components can settle for eventually consistent data, use the event-carried state transfer message.</p></li><li><p>If the consumer needs to read the last write in the producer’s state, issue an event notification message, with a subsequent query to fetch the producer’s up-to-date state.</p></li></ul></div></dd></dl></div></div></section></section>
<section><section id="_data_mesh_application"><h2>Data Mesh [Application]</h2></section><section id="_olap_erd"><h2>OLAP ERD</h2><div class="slide-content"><div class="imageblock"><img src="./images/OLAP_erd.png" alt="OLAP erd"></div></div></section><section id="_operational_vs_analytical"><h2>Operational vs. Analytical</h2><div class="slide-content"><div class="ulist"><ul><li><p>Operational models are built around the various entities from the system’s business domain, implementing their lifecycles and orchestrating their interactions with one another.</p></li><li><p>Analytical models are designed to provide different insights into the operational systems aims to provide insights into the performance of business activities and, more importantly, how the business can optimize its operations to achieve greater value.</p></li></ul></div></div></section><section id="_fact_table"><h2>Fact Table</h2><div class="slide-content"><div class="ulist"><ul><li><p>Facts represent business activities that have already happened. Facts are similar to the notion of domain events in the sense that both describe things that happened in the past</p></li><li><p>However, contrary to domain events, there is no stylistic requirement to name facts as verbs in the past tense</p></li></ul></div></div></section><section id="_fact_table_2"><h2>Fact Table</h2><div class="slide-content"><div class="imageblock"><img src="./images/fact_table.png" alt="fact table" width="50%" height="50%"></div></div></section><section id="_fact_records"><h2>Fact Records</h2><div class="slide-content"><div class="ulist"><ul><li><p>Fact records are never deleted or modified: analytical data is append-only data: the only way to express that current data is outdated is to append a new record with the current state</p></li><li><p>Another significant difference between the OLAP and OLTP models is the granularity of the data. Operational systems require the most precise data to handle business transactions. For analytical models, aggregated data is more efficient in many use cases.</p></li><li><p>The following table is an aggregate of every 30 seconds</p></li></ul></div>
<div class="imageblock"><img src="./images/fact_table_data.png" alt="fact table data"></div></div></section><section id="_dimension_table"><h2>Dimension Table</h2><div class="slide-content"><div class="ulist"><ul><li><p>Another essential building block of an analytical model is a dimension.</p></li><li><p>If a fact represents a business process or action (a verb), a dimension describes the fact (an adjective).</p></li><li><p>The dimensions are designed to describe the facts’ attributes and are referenced as a foreign key from a fact table to a dimension table.</p></li><li><p>The attributes modeled as dimensions are any measurements or data that is repeated across different fact records and cannot fit in a single column</p></li></ul></div></div></section><section id="_dimensions"><h2>Dimensions</h2><div class="slide-content"><div class="imageblock"><img src="./images/star_dimensions.png" alt="star dimensions"></div></div></section><section id="_why_organize_it_as_such"><h2>Why organize it as such?</h2><div class="slide-content"><div class="ulist"><ul><li><p>The reason for the high normalization of the dimensions is the analytical system’s need to support flexible querying.</p></li><li><p>The data analysts need flexible ways of looking at the data, and it’s hard to predict what queries will be executed in the future.</p></li><li><p>As a result, the normalization supports dynamic querying and filtering, and grouping the facts data across the different dimensions.</p></li></ul></div></div></section><section id="_star_schema"><h2>Star Schema</h2><div class="slide-content"><div class="ulist"><ul><li><p>This structure is known as a <em>star schema</em></p></li><li><p>It is based on the many-to-one relationships between the facts and their dimensions: each dimension record is used by many facts; a fact’s foreign key points to a single dimension record.</p></li></ul></div>
<div class="imageblock"><img src="./images/star_schema.png" alt="star schema" width="50%" height="50%"></div></div></section><section id="_snowflake_schema"><h2>Snowflake Schema</h2><div class="slide-content"><div class="ulist"><ul><li><p>Another predominant analytical model is the snowflake schema.</p></li><li><p>The snowflake schema is based on the same building blocks: facts and dimensions.</p></li><li><p>However, in the snowflake schema, the dimensions are multilevel: each dimension is further normalized into more fine-grained dimensions</p></li><li><p>Snowflake schema will use less space to store the dimension data and is easier to maintain</p></li><li><p>Querying the facts’ data will require joining more tables, and therefore, more computational resources are needed.</p></li></ul></div></div></section><section id="_snowflake_schema_2"><h2>Snowflake Schema</h2><div class="slide-content"><div class="imageblock"><img src="./images/snowflake_schema.png" alt="snowflake schema"></div></div></section><section id="_analytical_data_platforms"><h2>Analytical Data Platforms</h2></section><section id="_data_warehouse"><h2>Data Warehouse</h2><div class="slide-content"><div class="ulist"><ul><li><p>Extract data from all of the enterprise’s operational systems, transform the source data into an analytical model, and load the resultant data into a data analysis–oriented database.</p></li><li><p>This database is the data warehouse</p></li></ul></div></div></section><section id="_where_does_the_data_come_from"><h2>Where does the data come from?</h2><div class="slide-content"><div class="ulist"><ul><li><p>This data management architecture is based primarily on the extract-transform-load (ETL) scripts.</p></li><li><p>The data can come from various sources: operational databases, streaming events, logs, and so on.</p></li><li><p>In addition to translating the source data into a facts/dimensions-based model, the transformation step may include additional operations such as removing sensitive data, deduplicating records, reordering events, aggregating fine-grained events, and more.</p></li><li><p>In some cases, the transformation may require temporary storage for the incoming data. This is known as the staging area.</p></li></ul></div></div></section><section id="_data_warehouse_2"><h2>Data Warehouse</h2><div class="slide-content"><div class="imageblock"><img src="./images/data_warehouse.png" alt="data warehouse"></div></div></section><section id="_disadvantage_to_the_data_warehouse"><h2>Disadvantage to the Data Warehouse</h2><div class="slide-content"><div class="ulist"><ul><li><p>The warehouse can become bloated and too over-encompassing</p></li><li><p>The analytical models are used and can be used for a variety of purposes</p></li><li><p>Designing a model for the task at hand, such as building reports or training ML models, is a much more effective and scalable approach.</p></li></ul></div></div></section><section id="_data_marts"><h2>Data Marts</h2><div class="slide-content"><div class="ulist"><ul><li><p>A data mart is a database that holds data relevant for well-defined analytical needs, such as analysis of a single business department.</p></li><li><p>In the data mart model shown:</p><div class="ulist"><ul><li><p>One mart is populated directly by an ETL process from an operational system</p></li><li><p>While another mart extracts its data from the data warehouse.</p></li></ul></div></li></ul></div></div></section><section id="_data_marts_2"><h2>Data Marts</h2><div class="slide-content"><div class="imageblock"><img src="./images/data_mart.png" alt="data mart"></div></div></section><section id="_data_warehouse_challenges"><h2>Data warehouse challenges</h2><div class="slide-content"><div class="ulist"><ul><li><p>Another challenging aspect of the data warehouse architecture is that the ETL processes create a strong coupling between the analytical (OLAP) and the operational (OLTP) systems.</p></li><li><p>The data consumed by the ETL scripts is not necessarily exposed through the system’s public interfaces.</p></li><li><p>Often, DWH systems simply fetch all the data residing in the operational systems’ databases.</p></li><li><p>The schema used in the operational database is not a public interface, but rather an internal implementation detail.</p></li><li><p>As a result, a slight change in the schema is destined to break the data warehouse’s ETL scripts.</p></li><li><p>This can cause friction between teams</p></li></ul></div></div></section><section id="_friction_communication"><h2>Friction Communication</h2><div class="slide-content"><div class="paragraph"><p>The operational data can be broken for the ETL</p></div>
<div class="imageblock"><img src="./images/warehouse_challenges.png" alt="warehouse challenges"></div></div></section><section id="_data_lake"><h2>Data Lake</h2><div class="slide-content"><div class="ulist"><ul><li><p>A data lake–based system ingests the operational systems’ data.</p></li><li><p>However, instead of being transformed right away into an analytical model, the data is persisted in its raw form, that is, in the original operational model.</p></li><li><p>Eventually, the raw data cannot fit the needs of data analysts</p></li><li><p>It is the job of the data engineers, data scientists, and the BI engineers to make sense of the data in the lake and implement the ETL scripts that will generate analytical models and feed them into a data warehouse.</p></li></ul></div></div></section><section id="_data_lake_2"><h2>Data Lake</h2><div class="slide-content"><div class="imageblock"><img src="./images/data_lake.png" alt="data lake"></div></div></section><section id="_disadvantages_of_data_lakes"><h2>Disadvantages of Data Lakes</h2><div class="slide-content"><div class="ulist"><ul><li><p>It’s not uncommon for data engineers to implement and support multiple versions of the same ETL script to accommodate different versions of the operational model</p></li><li><p>No schemas present in data-lake</p></li><li><p>No control of the data, leads it to being a <em>data swamp</em></p></li></ul></div>
<div class="imageblock"><img src="./images/multiple_etl_datalake.png" alt="multiple etl datalake"></div></div></section><section id="_challenges_to_both_warehousing_and_lakes"><h2>Challenges to both warehousing and lakes</h2><div class="slide-content"><div class="ulist"><ul><li><p>The transformation of operational to analytical models converges to thousands of unmaintainable, ad hoc ETL scripts at scale.</p></li><li><p>Both architectures trespass the boundaries of the operational systems and create dependencies on their implementation details.</p></li><li><p>Data analysts and data engineers belong to a separate organizational unit, they often lack the deep knowledge of the business domain possessed by the operational systems’ development teams</p></li><li><p>No adaption to change, DDD&#8217;s emphasis is on continuously evolving and improving the business domain’s models</p></li></ul></div></div></section><section id="_data_mesh"><h2>Data Mesh</h2><div class="slide-content"><div class="ulist"><ul><li><p>Instead of building a monolithic analytical model, the data mesh architecture calls for leveraging the same solution for operational data: use multiple analytical models and align them with the origin of the data.</p></li><li><p>This naturally aligns the ownership boundaries of the analytical models with the bounded contexts’ boundaries</p></li><li><p>When the analysis model is decomposed according to the system’s bounded contexts, the generation of the analysis data becomes the responsibility of the corresponding product teams.</p></li></ul></div></div></section><section id="_data_mesh_2"><h2>Data Mesh</h2><div class="slide-content"><div class="imageblock"><img src="./images/datamesh.png" alt="datamesh" width="30%" height="30%"></div></div></section><section id="_data_as_a_product"><h2>Data as a Product</h2><div class="slide-content"><div class="ulist"><ul><li><p>The data as a product principle calls for treating the analytical data as a first-class citizen.</p></li><li><p>Instead of the analytical systems having to get the operational data from dubious sources (internal database, logfiles, etc.), in a data mesh–based system the bounded contexts serve the analytical data through well-defined output ports</p></li></ul></div>
<div class="imageblock"><img src="./images/datamesh_outports.png" alt="datamesh outports"></div></div></section><section id="_analytic_data_is_treated_like_any_api"><h2>Analytic Data is treated like any API</h2><div class="slide-content"><div class="ulist"><ul><li><p>It should be easy to discover the necessary endpoints: the data output ports.</p></li><li><p>The analytical endpoints should have a well-defined schema describing the served data and its format.</p></li><li><p>The analytical data should be trustworthy, and as with any API, it should have defined and monitored service-level agreements (SLAs).</p></li><li><p>The analytical model should be versioned as a regular API and correspondingly manage integration-breaking changes in the model.</p></li></ul></div></div></section><section id="_consumer_demands"><h2>Consumer Demands</h2><div class="slide-content"><div class="ulist"><ul><li><p>Different consumers may require the analytical data in different forms. Some may prefer to execute SQL queries, others to fetch analytical data from an object storage service, and so on.</p></li><li><p>As a result, the data products have to be polyglot, serving the data in formats that suit different consumers’ needs</p></li></ul></div></div></section><section id="_teams_are_more_cohesive"><h2>Teams are more cohesive</h2><div class="slide-content"><div class="ulist"><ul><li><p>Data specialists are now part of the product teams and bounded context</p></li><li><p>The product teams should be able to both create their own data products and consume data products served by other bounded contexts</p></li></ul></div></div></section><section id="_create_a_platform_team_in_your_bounded_context"><h2>Create a Platform Team in your bounded context</h2><div class="slide-content"><div class="ulist"><ul><li><p>It would be wasteful, inefficient, and hard to integrate if each team builds their own solution for serving analytical data.</p></li><li><p>To prevent this from happening, a platform is needed to abstract the complexity of building, executing, and maintaining interoperable data products.</p></li><li><p>Designing and building such a platform is a considerable undertaking and requires a dedicated <em>data infrastructure platform team</em>.</p></li></ul></div></div></section><section id="_what_would_the_platform_team_do"><h2>What would the Platform Team do?</h2><div class="slide-content"><div class="dlist"><dl><dt class="hdlist1">The data infrastructure platform team should be in charge of</dt><dd><div class="ulist"><ul><li><p>Defining the data product blueprints</p></li><li><p>Unified access patterns</p></li><li><p>Access control</p></li><li><p>Polyglot storage that can be leveraged by product teams</p></li><li><p>Monitoring the platform and ensuring that the SLAs and objectives are met</p></li></ul></div></dd></dl></div></div></section><section id="_creating_a_federated_governance"><h2>Creating a Federated Governance</h2><div class="slide-content"><div class="ulist"><ul><li><p>The final step to creating a data mesh system is to appoint a federated governance body to enable interoperability and ecosystem thinking in the domain of the analytical data.</p></li><li><p>Typically, that would be a group consisting of the bounded contexts’ data and product owners and representatives of the data infrastructure platform team</p></li></ul></div></div></section><section id="_federated_governances_duty"><h2>Federated Governances' Duty</h2><div class="slide-content"><div class="ulist"><ul><li><p>The governance group is in charge of defining the rules to ensure a healthy and interoperable ecosystem.</p></li><li><p>The rules have to be applied to all data products and their interfaces, and it’s the group’s responsibility to ensure adherence to the rules throughout the enterprise.</p></li></ul></div></div></section><section id="_federated_governance"><h2>Federated Governance</h2><div class="slide-content"><div class="imageblock"><img src="./images/federated_governance.png" alt="federated governance"></div></div></section><section id="_data_mesh_with_domain_driven_design"><h2>Data Mesh with Domain Driven Design</h2><div class="slide-content"><div class="ulist"><ul><li><p>Data mesh architecture is based on the same reasoning as domain-driven design</p></li><li><p>Ubiquitous language and the resultant domain knowledge are essential for designing analytical models</p></li><li><p>Exposing a bounded context’s data in a model that is different from its operational model is the open-host pattern</p></li><li><p>The CQRS pattern makes it easy to generate multiple models of the same data. It can be leveraged to transform the operational model into an analytical model.</p></li></ul></div></div></section><section id="_data_mesh_analytical_model"><h2>Data Mesh Analytical Model</h2><div class="slide-content"><div class="imageblock"><img src="./images/datamesh_analytic_model.png" alt="datamesh analytic model"></div></div></section></section>
<section><section id="_resources"><h2>Resources</h2></section><section id="_domain_driven_design_2" class="columns"><h2>Domain Driven Design</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="./images/resource_domain_driven_design.jpeg" alt="resource domain driven design"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Eric Evans
Published by Addison-Wesley Professional</p></div></div></div></div></section><section id="_learning_domain_driven_design" class="columns"><h2>Learning Domain Driven Design</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="./images/resource_learning_domain_driven_design.jpeg" alt="resource learning domain driven design"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Vlad Khononov
Published by O&#8217;Reilly Media, Inc.</p></div></div></div></div></section><section id="_microservices_patterns" class="columns"><h2>Microservices Patterns</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="./images/resource_microservices_patterns.jpeg" alt="resource microservices patterns"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Chris Richardson
Published by Manning Publications</p></div></div></div></div></section><section id="_implementing_domain_driven_design" class="columns"><h2>Implementing Domain-Driven Design</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="./images/resource_implementing_domain_driven_design.jpeg" alt="resource implementing domain driven design"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Vaughn Vernon
Published by Addison-Wesley Professional</p></div></div></div></div></section><section id="_domain_driven_design_distilled" class="columns"><h2>Domain Driven Design Distilled</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="./images/domain_driven_design_distilled.jpeg" alt="domain driven design distilled"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Vaughn Vernon
Published by Addison-Wesley Professional</p></div></div></div></div></section><section id="_enterprise_integration_patterns" class="columns"><h2>Enterprise Integration Patterns</h2><div class="slide-content"><div class="openblock column"><div class="content"><div class="imageblock"><img src="./images/resource_enterprise_integration_patterns.jpeg" alt="resource enterprise integration patterns"></div></div></div>
<div class="openblock column"><div class="content"><div class="paragraph"><p>Enterprise Integration Patterns: Designing, Building, and Deploying Messaging Solutions
Gregor Hohpe, Bobby Woolf
Published by Addison-Wesley Professional</p></div></div></div></div></section><section id="_how_agile_can_cripple_effective_design_work_and_what_to_do_about_it"><h2>How Agile Can Cripple Effective Design Work (and what to do about it)</h2><div class="slide-content"><div class="videoblock stretch"><iframe width="100%" height="100%" src="https://www.youtube.com/embed/Bl30X0MvT0I?rel=0" frameborder="0" allowfullscreen></iframe></div></div></section><section id="_microservices_io"><h2>Microservices.io</h2><div class="slide-content"><div class="paragraph"><p>Visit the <a href="https://microservices.io" target="_blank">https://microservices.io/</a> website</p></div></div></section></section></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: false,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: true,
  // Push each slide change to the browser history. Implies `hash: true`
  history: false,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'slide',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 960,
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/plugin/zoom-js/zoom.js', async: true },
      { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.9.2/plugin/notes/notes.js', async: true }
  ],

  

});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(960, 700)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(960, 700)
});</script><link rel="stylesheet" href="color-brewer.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/java.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/yaml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/toml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/json.min.js"></script>

<script>

/* highlightjs-line-numbers.js 2.6.0 | (C) 2018 Yauheni Pakala | MIT License | github.com/wcoder/highlightjs-line-numbers.js */
/* Edited by Hakim for reveal.js; removed async timeout */
!function(n,e){"use strict";function t(){var n=e.createElement("style");n.type="text/css",n.innerHTML=g(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,L,b]),e.getElementsByTagName("head")[0].appendChild(n)}function r(t){"interactive"===e.readyState||"complete"===e.readyState?i(t):n.addEventListener("DOMContentLoaded",function(){i(t)})}function i(t){try{var r=e.querySelectorAll("code.hljs,code.nohighlight");for(var i in r)r.hasOwnProperty(i)&&l(r[i],t)}catch(o){n.console.error("LineNumbers error: ",o)}}function l(n,e){"object"==typeof n&&f(function(){n.innerHTML=s(n,e)})}function o(n,e){if("string"==typeof n){var t=document.createElement("code");return t.innerHTML=n,s(t,e)}}function s(n,e){e=e||{singleLine:!1};var t=e.singleLine?0:1;return c(n),a(n.innerHTML,t)}function a(n,e){var t=u(n);if(""===t[t.length-1].trim()&&t.pop(),t.length>e){for(var r="",i=0,l=t.length;i<l;i++)r+=g('<tr><td class="{0}"><div class="{1} {2}" {3}="{5}"></div></td><td class="{4}"><div class="{1}">{6}</div></td></tr>',[j,m,L,b,p,i+1,t[i].length>0?t[i]:" "]);return g('<table class="{0}">{1}</table>',[v,r])}return n}function c(n){var e=n.childNodes;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];h(r.textContent)>0&&(r.childNodes.length>0?c(r):d(r.parentNode))}}function d(n){var e=n.className;if(/hljs-/.test(e)){for(var t=u(n.innerHTML),r=0,i="";r<t.length;r++){var l=t[r].length>0?t[r]:" ";i+=g('<span class="{0}">{1}</span>\n',[e,l])}n.innerHTML=i.trim()}}function u(n){return 0===n.length?[]:n.split(y)}function h(n){return(n.trim().match(y)||[]).length}function f(e){e()}function g(n,e){return n.replace(/{(\d+)}/g,function(n,t){return e[t]?e[t]:n})}var v="hljs-ln",m="hljs-ln-line",p="hljs-ln-code",j="hljs-ln-numbers",L="hljs-ln-n",b="data-line-number",y=/\r\n|\r|\n/g;n.hljs?(n.hljs.initLineNumbersOnLoad=r,n.hljs.lineNumbersBlock=l,n.hljs.lineNumbersValue=o,t()):n.console.error("highlight.js not detected!")}(window,document);

/**
 * This reveal.js plugin is wrapper around the highlight.js
 * syntax highlighting library.
 */
(function( root, factory ) {
  if (typeof define === 'function' && define.amd) {
    root.RevealHighlight = factory();
  } else if( typeof exports === 'object' ) {
    module.exports = factory();
  } else {
    // Browser globals (root is window)
    root.RevealHighlight = factory();
  }
}( this, function() {

  // Function to perform a better "data-trim" on code snippets
  // Will slice an indentation amount on each line of the snippet (amount based on the line having the lowest indentation length)
  function betterTrim(snippetEl) {
    // Helper functions
    function trimLeft(val) {
      // Adapted from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/Trim#Polyfill
      return val.replace(/^[\s\uFEFF\xA0]+/g, '');
    }
    function trimLineBreaks(input) {
      var lines = input.split('\n');

      // Trim line-breaks from the beginning
      for (var i = 0; i < lines.length; i++) {
        if (lines[i].trim() === '') {
          lines.splice(i--, 1);
        } else break;
      }

      // Trim line-breaks from the end
      for (var i = lines.length-1; i >= 0; i--) {
        if (lines[i].trim() === '') {
          lines.splice(i, 1);
        } else break;
      }

      return lines.join('\n');
    }

    // Main function for betterTrim()
    return (function(snippetEl) {
      var content = trimLineBreaks(snippetEl.innerHTML);
      var lines = content.split('\n');
      // Calculate the minimum amount to remove on each line start of the snippet (can be 0)
      var pad = lines.reduce(function(acc, line) {
        if (line.length > 0 && trimLeft(line).length > 0 && acc > line.length - trimLeft(line).length) {
          return line.length - trimLeft(line).length;
        }
        return acc;
      }, Number.POSITIVE_INFINITY);
      // Slice each line with this amount
      return lines.map(function(line, index) {
        return line.slice(pad);
      })
        .join('\n');
    })(snippetEl);
  }

  var RevealHighlight = {

    HIGHLIGHT_STEP_DELIMITER: '|',
    HIGHLIGHT_LINE_DELIMITER: ',',
    HIGHLIGHT_LINE_RANGE_DELIMITER: '-',

    init: function() {

      // Read the plugin config options and provide fallbacks
      var config = Reveal.getConfig().highlight || {};
      config.highlightOnLoad = typeof config.highlightOnLoad === 'boolean' ? config.highlightOnLoad : true;
      config.escapeHTML = typeof config.escapeHTML === 'boolean' ? config.escapeHTML : true;

      [].slice.call( document.querySelectorAll( '.reveal pre code' ) ).forEach( function( block ) {

        // Trim whitespace if the "data-trim" attribute is present
        if( block.hasAttribute( 'data-trim' ) && typeof block.innerHTML.trim === 'function' ) {
          block.innerHTML = betterTrim( block );
        }

        // Escape HTML tags unless the "data-noescape" attrbute is present
        if( config.escapeHTML && !block.hasAttribute( 'data-noescape' )) {
          block.innerHTML = block.innerHTML.replace( /</g,"&lt;").replace(/>/g, '&gt;' );
        }

        // Re-highlight when focus is lost (for contenteditable code)
        block.addEventListener( 'focusout', function( event ) {
          hljs.highlightBlock( event.currentTarget );
        }, false );

        if( config.highlightOnLoad ) {
          RevealHighlight.highlightBlock( block );
        }
      } );

    },

    /**
     * Highlights a code block. If the <code> node has the
     * 'data-line-numbers' attribute we also generate slide
     * numbers.
     *
     * If the block contains multiple line highlight steps,
     * we clone the block and create a fragment for each step.
     */
    highlightBlock: function( block ) {

      hljs.highlightBlock( block );

      // Don't generate line numbers for empty code blocks
      if( block.innerHTML.trim().length === 0 ) return;

      if( block.hasAttribute( 'data-line-numbers' ) ) {
        hljs.lineNumbersBlock( block, { singleLine: true } );

        // If there is at least one highlight step, generate
        // fragments
        var highlightSteps = RevealHighlight.deserializeHighlightSteps( block.getAttribute( 'data-line-numbers' ) );
        if( highlightSteps.length > 1 ) {

          // If the original code block has a fragment-index,
          // each clone should follow in an incremental sequence
          var fragmentIndex = parseInt( block.getAttribute( 'data-fragment-index' ), 10 );
          if( typeof fragmentIndex !== 'number' || isNaN( fragmentIndex ) ) {
            fragmentIndex = null;
          }

          // Generate fragments for all steps except the original block
          highlightSteps.slice(1).forEach( function( highlight ) {

            var fragmentBlock = block.cloneNode( true );
            fragmentBlock.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlight ] ) );
            fragmentBlock.classList.add( 'fragment' );
            block.parentNode.appendChild( fragmentBlock );
            RevealHighlight.highlightLines( fragmentBlock );

            if( typeof fragmentIndex === 'number' ) {
              fragmentBlock.setAttribute( 'data-fragment-index', fragmentIndex );
              fragmentIndex += 1;
            }
            else {
              fragmentBlock.removeAttribute( 'data-fragment-index' );
            }

          } );

          block.removeAttribute( 'data-fragment-index' )
          block.setAttribute( 'data-line-numbers', RevealHighlight.serializeHighlightSteps( [ highlightSteps[0] ] ) );

        }

        RevealHighlight.highlightLines( block );

      }

    },

    /**
     * Visually emphasize specific lines within a code block.
     * This only works on blocks with line numbering turned on.
     *
     * @param {HTMLElement} block a <code> block
     * @param {String} [linesToHighlight] The lines that should be
     * highlighted in this format:
     * "1" 		= highlights line 1
     * "2,5"	= highlights lines 2 & 5
     * "2,5-7"	= highlights lines 2, 5, 6 & 7
     */
    highlightLines: function( block, linesToHighlight ) {

      var highlightSteps = RevealHighlight.deserializeHighlightSteps( linesToHighlight || block.getAttribute( 'data-line-numbers' ) );

      if( highlightSteps.length ) {

        highlightSteps[0].forEach( function( highlight ) {

          var elementsToHighlight = [];

          // Highlight a range
          if( typeof highlight.end === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child(n+'+highlight.start+'):nth-child(-n+'+highlight.end+')' ) );
          }
          // Highlight a single line
          else if( typeof highlight.start === 'number' ) {
            elementsToHighlight = [].slice.call( block.querySelectorAll( 'table tr:nth-child('+highlight.start+')' ) );
          }

          if( elementsToHighlight.length ) {
            elementsToHighlight.forEach( function( lineElement ) {
              lineElement.classList.add( 'highlight-line' );
            } );

            block.classList.add( 'has-highlights' );
          }

        } );

      }

    },

    /**
     * Parses and formats a user-defined string of line
     * numbers to highlight.
     *
     * @example
     * RevealHighlight.deserializeHighlightSteps( '1,2|3,5-10' )
     * // [
     * //   [ { start: 1 }, { start: 2 } ],
     * //   [ { start: 3 }, { start: 5, end: 10 } ]
     * // ]
     */
    deserializeHighlightSteps: function( highlightSteps ) {

      // Remove whitespace
      highlightSteps = highlightSteps.replace( /\s/g, '' );

      // Divide up our line number groups
      highlightSteps = highlightSteps.split( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

      return highlightSteps.map( function( highlights ) {

        return highlights.split( RevealHighlight.HIGHLIGHT_LINE_DELIMITER ).map( function( highlight ) {

          // Parse valid line numbers
          if( /^[\d-]+$/.test( highlight ) ) {

            highlight = highlight.split( RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER );

            var lineStart = parseInt( highlight[0], 10 ),
              lineEnd = parseInt( highlight[1], 10 );

            if( isNaN( lineEnd ) ) {
              return {
                start: lineStart
              };
            }
            else {
              return {
                start: lineStart,
                end: lineEnd
              };
            }

          }
          // If no line numbers are provided, no code will be highlighted
          else {

            return {};

          }

        } );

      } );

    },

    /**
     * Serializes parsed line number data into a string so
     * that we can store it in the DOM.
     */
    serializeHighlightSteps: function( highlightSteps ) {

      return highlightSteps.map( function( highlights ) {

        return highlights.map( function( highlight ) {

          // Line range
          if( typeof highlight.end === 'number' ) {
            return highlight.start + RevealHighlight.HIGHLIGHT_LINE_RANGE_DELIMITER + highlight.end;
          }
          // Single line
          else if( typeof highlight.start === 'number' ) {
            return highlight.start;
          }
          // All lines
          else {
            return '';
          }

        } ).join( RevealHighlight.HIGHLIGHT_LINE_DELIMITER );

      } ).join( RevealHighlight.HIGHLIGHT_STEP_DELIMITER );

    }

  }

  Reveal.registerPlugin( 'highlight', RevealHighlight );

  return RevealHighlight;

}));
        
hljs.initHighlightingOnLoad();
</script></body></html>